<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>enterprise-approval-engine - Enterprise-grade approval workflows featuring per-group thresholds (X of N), OR logic between groups, and automatic semantic versioning tag creation.</title>
    <meta name="description" content="Enterprise-grade approval workflows featuring per-group thresholds (X of N), OR logic between groups, and automatic semantic versioning tag creation.">
    <meta name="keywords" content="enterprise-approval-engine, English, documentation, GitHub, open source">
    <meta name="author" content="OpenAiTx">
    <meta name="robots" content="index, follow">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "enterprise-approval-engine",
  "description": "Enterprise-grade approval workflows featuring per-group thresholds (X of N), OR logic between groups, and automatic semantic versioning tag creation.",
  "author": {
    "@type": "Person",
    "name": "jamengual"
  },
  "applicationCategory": "DeveloperApplication",
  "operatingSystem": "Any",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "5",
    "ratingCount": 4
  },
  "url": "https://OpenAiTx.github.io/projects/jamengual/enterprise-approval-engine/README-en.html",
  "sameAs": "https://raw.githubusercontent.com/jamengual/enterprise-approval-engine/main/README.md",
  "datePublished": "2025-12-22",
  "dateModified": "2025-12-22"
}
    </script>
    
    <!-- GitHub-style CSS -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #24292e;
            background-color: #ffffff;
            max-width: 980px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .container {
            background: #ffffff;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 24px;
            margin-bottom: 20px;
        }
        
        .header {
            border-bottom: 1px solid #e1e4e8;
            padding-bottom: 16px;
            margin-bottom: 24px;
        }
        
        .project-title {
            font-size: 2em;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .project-title a {
            color: #24292e;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: color 0.2s ease;
        }
        
        .project-title a:hover {
            color: #0366d6;
            text-decoration: none;
        }
        
        .project-title .github-icon {
            width: 1em;
            height: 1em;
            fill: currentColor;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }
        
        .project-title a:hover .github-icon {
            opacity: 1;
        }
        
        .project-meta {
            color: #586069;
            font-size: 14px;
            margin-bottom: 16px;
        }
        
        .stars {
            display: inline-block;
            margin-right: 16px;
        }
        
        .language {
            display: inline-block;
            background-color: #f1f8ff;
            color: #0366d6;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .content {
            font-size: 16px;
            line-height: 1.6;
        }
        
        h1, h2, h3, h4, h5, h6 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
            color: #24292e;
        }
        
        h1 { font-size: 2em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        h3 { font-size: 1.25em; }
        
        p {
            margin-bottom: 16px;
        }
        
        code {
            background-color: #f6f8fa;
            border-radius: 3px;
            font-size: 85%;
            margin: 0;
            padding: 0.2em 0.4em;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }
        
        pre {
            background-color: #f6f8fa;
            border-radius: 6px;
            font-size: 85%;
            line-height: 1.45;
            overflow: auto;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        pre code {
            background-color: transparent;
            border: 0;
            display: inline;
            line-height: inherit;
            margin: 0;
            overflow: visible;
            padding: 0;
            word-wrap: normal;
        }
        
        a {
            color: #0366d6;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        ul, ol {
            margin-bottom: 16px;
            padding-left: 2em;
        }
        
        li {
            margin-bottom: 0.25em;
        }
        
        blockquote {
            border-left: 4px solid #dfe2e5;
            color: #6a737d;
            margin: 0 0 16px 0;
            padding: 0 1em;
        }
        
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e1e4e8;
            color: #586069;
            font-size: 14px;
            text-align: center;
        }
        
        .footer a {
            color: #0366d6;
        }
        
        .original-link {
            margin-top: 16px;
            padding: 12px;
            background-color: #f6f8fa;
            border-radius: 6px;
            border: 1px solid #e1e4e8;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 16px;
            }
            
            .project-title {
                font-size: 1.5em;
            }
        }
    </style>
    
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <!-- Bing Count -->
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "sh95yd6uwt");
    </script>        

    <!-- Statcounter -->
    <script type="text/javascript">
        var sc_project = 13142514;
        var sc_invisible = 1;
        var sc_security = "d03a31d8"; 
    </script>
    <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script>
    <noscript>
        <div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img
                    class="statcounter" src="https://c.statcounter.com/13142514/0/d03a31d8/1/" alt="Web Analytics"
                    referrerPolicy="no-referrer-when-downgrade"></a></div>
    </noscript>    
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="project-title">
                <a href="https://github.com/jamengual/enterprise-approval-engine" target="_blank" rel="noopener noreferrer">
                    <svg class="github-icon" viewBox="0 0 16 16" aria-hidden="true">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
                    </svg>
                    enterprise-approval-engine
                </a>
            </h1>
            <div class="project-meta">
                <span class="stars">⭐ 4 stars</span>
                <span class="language">English</span>
                <span>by jamengual</span>
            </div>
        </div>
        
        <div class="content">
            <h1>Enterprise Approval Engine</h1></p><p><a href="README.md" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/lang-en-blue.svg" alt="en"></a>
<a href="ES/README.md" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/lang-es-yellow.svg" alt="es"></a></p><p>Enterprise-grade GitHub Action for policy-based approval workflows with per-group thresholds (X of N), OR logic between groups, and automatic semver tag creation.</p><h2>Features</h2></p><ul><li><strong>Flexible Approval Logic</strong>: Support for both AND (all must approve) and threshold (X of N) logic within groups</li>
<li><strong>OR Logic Between Groups</strong>: Multiple approval paths - any one group meeting requirements approves the request</li>
<li><strong>Mixed Approvers</strong>: Combine individual users and GitHub teams in the same group</li>
<li><strong>Progressive Deployment Pipelines</strong>: Single-issue tracking through multiple environments (dev → qa → stage → prod)</li>
<li><strong>Pipeline Visualization</strong>: Color-coded Mermaid flowchart diagrams showing deployment progress</li>
<li><strong>Sub-Issue Approvals</strong>: Create dedicated approval sub-issues for each stage - close to approve</li>
<li><strong>Enhanced Comments UX</strong>: Emoji reactions on approval comments, Quick Actions section with command reference</li>
<li><strong>Issue Close Protection</strong>: Prevent unauthorized users from closing approval issues (auto-reopen)</li>
<li><strong>Hybrid Approval Modes</strong>: Mix comment-based and sub-issue approvals per workflow or stage</li>
<li><strong>PR and Commit Tracking</strong>: Automatically list PRs and commits in deployment issues for release management</li>
<li><strong>Semver Tag Creation</strong>: Automatically create git tags upon approval</li>
<li><strong>Policy-Based Configuration</strong>: Define reusable approval policies in YAML</li>
<li><strong>Issue-Based Workflow</strong>: Transparent audit trail through GitHub issues</li>
<li><strong>Jira Integration</strong>: Extract issue keys from commits, display in approval issues, update Fix Versions</li>
<li><strong>Deployment Tracking</strong>: Create GitHub deployments for visibility in deployment dashboard</li>
<li><strong>External Config</strong>: Centralize approval policies in a shared repository</li>
<li><strong>Rate Limit Handling</strong>: Automatic retry with exponential backoff for GitHub API rate limits</li>
<li><strong>GitHub Enterprise Server</strong>: Full support for GHES environments</li>
<li><strong>No External Dependencies</strong>: Pure GitHub Actions, no external services required</li></p><p></ul>📋 <strong>See it in action:</strong> <a href="https://github.com/jamengual/enterprise-approval-engine/issues/7" target="_blank" rel="noopener noreferrer">Example approval issue</a></p><h2>Table of Contents</h2></p><ul><li><a href="#quick-start" target="_blank" rel="noopener noreferrer">Quick Start</a></li>
<li><a href="#action-reference" target="_blank" rel="noopener noreferrer">Action Reference</a></li>
  <li><a href="#actions" target="_blank" rel="noopener noreferrer">Actions</a></li>
  <li><a href="#inputs" target="_blank" rel="noopener noreferrer">Inputs</a></li>
  <li><a href="#outputs" target="_blank" rel="noopener noreferrer">Outputs</a></li>
<li><a href="#configuration-reference" target="_blank" rel="noopener noreferrer">Configuration Reference</a></li>
  <li><a href="#policies" target="_blank" rel="noopener noreferrer">Policies</a></li>
  <li><a href="#workflows" target="_blank" rel="noopener noreferrer">Workflows</a></li>
  <li><a href="#tagging-configuration" target="_blank" rel="noopener noreferrer">Tagging</a></li>
  <li><a href="#custom-issue-templates" target="_blank" rel="noopener noreferrer">Custom Templates</a></li>
  <li><a href="#defaults" target="_blank" rel="noopener noreferrer">Defaults</a></li>
  <li><a href="#semver" target="_blank" rel="noopener noreferrer">Semver</a></li>
<li><a href="#complete-configuration-reference" target="_blank" rel="noopener noreferrer">Complete Configuration Reference</a></li>
<li><a href="#feature-details" target="_blank" rel="noopener noreferrer">Feature Details</a></li>
  <li><a href="#approval-keywords" target="_blank" rel="noopener noreferrer">Approval Keywords</a></li>
  <li><a href="#team-support" target="_blank" rel="noopener noreferrer">Team Support</a></li>
  <li><a href="#progressive-deployment-pipelines" target="_blank" rel="noopener noreferrer">Progressive Deployment Pipelines</a></li>
  <li><a href="#release-candidate-strategies" target="_blank" rel="noopener noreferrer">Release Candidate Strategies</a></li>
  <li><a href="#jira-integration" target="_blank" rel="noopener noreferrer">Jira Integration</a></li>
  <li><a href="#deployment-tracking" target="_blank" rel="noopener noreferrer">Deployment Tracking</a></li>
  <li><a href="#external-config-repository" target="_blank" rel="noopener noreferrer">External Config Repository</a></li>
  <li><a href="#blocking-approvals" target="_blank" rel="noopener noreferrer">Blocking Approvals</a></li>
  <li><a href="#tag-deletion-on-issue-close" target="_blank" rel="noopener noreferrer">Tag Deletion</a></li>
<li><a href="#complete-examples" target="_blank" rel="noopener noreferrer">Complete Examples</a></li>
<li><a href="#schema-validation" target="_blank" rel="noopener noreferrer">Schema Validation</a></li>
<li><a href="#github-enterprise-server" target="_blank" rel="noopener noreferrer">GitHub Enterprise Server</a></li></p><p></ul><h2>Quick Start</h2></p><h3>1. Create Configuration</h3></p><p>Create <code>.github/approvals.yml</code> in your repository:</p><pre><code class="language-yaml">version: 1</p><p>policies:
  dev-team:
    approvers: [alice, bob, charlie]
    min_approvals: 2</p><p>  platform-team:
    approvers: [team:platform-engineers]
    require_all: true</p><p>workflows:
  production-deploy:
    require:
      # OR logic: either path satisfies approval
      <ul><li>policy: dev-team        # 2 of 3 developers</li>
      <li>policy: platform-team   # ALL platform engineers</li>
    </ul>on_approved:
      create_tag: true
      close_issue: true</code></pre></p><h3>2. Request Approval Workflow</h3></p><p>Create <code>.github/workflows/request-approval.yml</code>:</p><pre><code class="language-yaml">name: Request Deployment Approval</p><p>on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to deploy (e.g., v1.2.3)'
        required: true
        type: string</p><p>jobs:
  request:
    runs-on: ubuntu-latest
    steps:
      <ul><li>uses: actions/checkout@v4</li>
      <li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>id: approval
        with:
          action: request
          workflow: production-deploy
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}</p><ul><li>name: Output Results</li>
        </ul>run: |
          echo "Issue: ${{ steps.approval.outputs.issue_url }}"
          echo "Status: ${{ steps.approval.outputs.status }}"</code></pre></p><h3>3. Handle Approval Comments</h3></p><p>Create <code>.github/workflows/handle-approval.yml</code>:</p><pre><code class="language-yaml">name: Handle Approval Comments</p><p>on:
  issue_comment:
    types: [created]</p><p>jobs:
  process:
    if: contains(github.event.issue.labels.*.name, 'approval-required')
    runs-on: ubuntu-latest
    steps:
      <ul><li>uses: actions/checkout@v4</li>
      <li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>id: process
        with:
          action: process-comment
          issue_number: ${{ github.event.issue.number }}
          token: ${{ secrets.GITHUB_TOKEN }}</p><ul><li>name: Trigger Deployment</li>
        </ul>if: steps.process.outputs.status == 'approved'
        run: |
          echo "Approved by: ${{ steps.process.outputs.approvers }}"
          echo "Tag created: ${{ steps.process.outputs.tag }}"</code></pre></p><hr></p><h2>Action Reference</h2></p><h3>Actions</h3></p><p>The action supports four operation modes via the <code>action</code> input:</p><p>| Action | Description | When to Use |
|--------|-------------|-------------|
| <code>request</code> | Create a new approval request issue | When starting a deployment/release workflow |
| <code>process-comment</code> | Process an approval/denial comment | On <code>issue_comment</code> events |
| <code>check</code> | Check the current approval status | To poll for approval completion |
| <code>close-issue</code> | Handle issue close events | On <code>issues: [closed]</code> events |</p><h3>Inputs</h3></p><p>#### Core Inputs</p><p>| Input | Description | Required | Default |
|-------|-------------|----------|---------|
| <code>action</code> | Action to perform: <code>request</code>, <code>check</code>, <code>process-comment</code>, <code>close-issue</code> | Yes | - |
| <code>workflow</code> | Workflow name from config (for <code>request</code> action) | For <code>request</code> | - |
| <code>version</code> | Semver version for tag creation (e.g., <code>1.2.3</code> or <code>v1.2.3</code>) | No | - |
| <code>issue_number</code> | Issue number (for <code>check</code>, <code>process-comment</code>, <code>close-issue</code>) | For check/process/close | - |
| <code>token</code> | GitHub token for API operations | Yes | - |</p><p>#### Configuration Inputs</p><p>| Input | Description | Required | Default |
|-------|-------------|----------|---------|
| <code>config_path</code> | Path to approvals.yml config file | No | <code>.github/approvals.yml</code> |
| <code>config_repo</code> | External repository for shared config (e.g., <code>org/.github</code>) | No | - |</p><p>#### Polling Inputs (for <code>check</code> action)</p><p>| Input | Description | Required | Default |
|-------|-------------|----------|---------|
| <code>wait</code> | Wait for approval (polling) instead of returning immediately | No | <code>false</code> |
| <code>timeout</code> | Timeout for waiting (e.g., <code>24h</code>, <code>1h30m</code>, <code>30m</code>) | No | <code>72h</code> |</p><p>#### Team Support Inputs</p><p>| Input | Description | Required | Default |
|-------|-------------|----------|---------|
| <code>app_id</code> | GitHub App ID for team membership checks | No | - |
| <code>app_private_key</code> | GitHub App private key for team membership checks | No | - |</p><p>#### Jira Integration Inputs</p><p>| Input | Description | Required | Default |
|-------|-------------|----------|---------|
| <code>jira_base_url</code> | Jira Cloud base URL (e.g., <code>https://yourcompany.atlassian.net</code>) | No | - |
| <code>jira_user_email</code> | Jira user email for API authentication | No | - |
| <code>jira_api_token</code> | Jira API token for authentication | No | - |
| <code>jira_update_fix_version</code> | Update Jira issues with Fix Version on approval | No | <code>true</code> |
| <code>include_jira_issues</code> | Include Jira issues in approval request body | No | <code>true</code> |</p><p>#### Deployment Tracking Inputs</p><p>| Input | Description | Required | Default |
|-------|-------------|----------|---------|
| <code>create_deployment</code> | Create GitHub deployment for tracking | No | <code>true</code> |
| <code>deployment_environment</code> | Target environment (e.g., <code>production</code>, <code>staging</code>) | No | <code>production</code> |
| <code>deployment_environment_url</code> | URL to the deployed environment | No | - |</p><p>#### Other Inputs</p><p>| Input | Description | Required | Default |
|-------|-------------|----------|---------|
| <code>issue_action</code> | Issue event action for <code>close-issue</code> (<code>closed</code>, <code>reopened</code>) | No | - |
| <code>previous_tag</code> | Previous tag to compare commits against (auto-detected if not specified) | No | - |</p><h3>Outputs</h3></p><p>#### Core Outputs</p><p>| Output | Description | Available For |
|--------|-------------|---------------|
| <code>status</code> | Approval status: <code>pending</code>, <code>approved</code>, <code>denied</code>, <code>timeout</code>, <code>tag_deleted</code>, <code>skipped</code> | All actions |
| <code>issue_number</code> | Created or checked issue number | All actions |
| <code>issue_url</code> | URL to the approval issue | All actions |</p><p>#### Approval Outputs</p><p>| Output | Description | Available For |
|--------|-------------|---------------|
| <code>approvers</code> | Comma-separated list of users who approved | <code>process-comment</code>, <code>check</code> |
| <code>denier</code> | User who denied the request | <code>process-comment</code>, <code>check</code> |
| <code>satisfied_group</code> | Name of the group that satisfied approval | <code>process-comment</code>, <code>check</code> |
| <code>tag</code> | Created tag name | <code>process-comment</code> (on approval) |
| <code>tag_deleted</code> | Tag that was deleted | <code>close-issue</code> |</p><p>#### Jira Outputs</p><p>| Output | Description | Available For |
|--------|-------------|---------------|
| <code>jira_issues</code> | Comma-separated list of Jira issue keys in this release | <code>request</code> |
| <code>jira_issues_json</code> | JSON array of Jira issue details (key, summary, type, status) | <code>request</code> |</p><p>#### Deployment Outputs</p><p>| Output | Description | Available For |
|--------|-------------|---------------|
| <code>deployment_id</code> | GitHub deployment ID for status updates | <code>request</code> |
| <code>deployment_url</code> | URL to the deployment in GitHub | <code>request</code> |</p><p>#### Release Notes Outputs</p><p>| Output | Description | Available For |
|--------|-------------|---------------|
| <code>release_notes</code> | Auto-generated release notes from commits and Jira issues | <code>request</code> |
| <code>commits_count</code> | Number of commits in this release | <code>request</code> |</p><hr></p><h2>Configuration Reference</h2></p><h3>Policies</h3></p><p>Policies define reusable groups of approvers. There are two formats:</p><p>#### Simple Format</p><pre><code class="language-yaml">policies:
  # Threshold-based: X of N must approve
  dev-team:
    approvers: [alice, bob, charlie]
    min_approvals: 2</p><p>  # All must approve (AND logic)
  security:
    approvers: [team:security, security-lead]
    require_all: true</p><p>  # Mixed teams and individuals
  production:
    approvers:
      <ul><li>team:sre</li>
      <li>tech-lead</li>
      <li>product-owner</li>
    </ul>min_approvals: 2</code></pre></p><p>#### Advanced Format (per-source thresholds)</p><p>For complex requirements like "2 from platform AND 1 from security":</p><pre><code class="language-yaml">policies:
  # Complex AND gate
  production-gate:
    from:
      <ul><li>team: platform-engineers</li>
        </ul>min_approvals: 2        # 2 of the platform team
      <ul><li>team: security</li>
        </ul>min_approvals: 1        # 1 of the security team
      <ul><li>user: alice             # alice must also approve</li>
    </ul>logic: and                  # ALL sources must be satisfied</p><p>  # Flexible OR gate
  flexible-review:
    from:
      <ul><li>team: security</li>
        </ul>require_all: true       # All security team
      <ul><li>team: platform</li>
        </ul>min_approvals: 2        # OR 2 platform members
    logic: or                   # ANY source is enough</p><p>  # Executive approval: any one exec
  exec-approval:
    from:
      <ul><li>user: ceo</li>
      <li>user: cto</li>
      <li>user: vp-engineering</li>
    </ul>logic: or</p><p>  # User list with threshold
  leads:
    from:
      <ul><li>users: [tech-lead, product-lead, design-lead]</li>
        </ul>min_approvals: 2</code></pre></p><p><strong>Source types:</strong></p><ul><li><code>team: slug</code> - GitHub team (requires App token)</li>
<li><code>user: username</code> - Single user (implicit require_all)</li>
<li><code>users: [a, b, c]</code> - List of users</li></p><p></ul><strong>Policy-level logic:</strong></p><ul><li><code>logic: and</code> - ALL sources must be satisfied (default)</li>
<li><code>logic: or</code> - ANY source being satisfied is enough</li></p><p></ul>#### Inline Logic (mix AND/OR)</p><p>For complex expressions, use <code>logic:</code> on each source to specify how it connects to the next:</p><pre><code class="language-yaml">policies:
  # (2 security AND 2 platform) OR alice
  complex-gate:
    from:
      <ul><li>team: security</li>
        </ul>min_approvals: 2
        logic: and              # AND with next source
      <ul><li>team: platform</li>
        </ul>min_approvals: 2
        logic: or               # OR with next source
      <ul><li>user: alice            # alice alone can satisfy</li></p><p>  </ul># (security AND platform) OR (alice AND bob) OR manager
  multi-path:
    from:
      <ul><li>team: security</li>
        </ul>min_approvals: 1
        logic: and
      <ul><li>team: platform</li>
        </ul>min_approvals: 1
        logic: or               # End first AND group
      <ul><li>user: alice</li>
        </ul>logic: and
      <ul><li>user: bob</li>
        </ul>logic: or               # End second AND group
      <ul><li>user: manager          # Third path</code></pre></li></p><p></ul><strong>Operator precedence:</strong> AND binds tighter than OR (standard boolean logic).</p><p>The expression <code>A and B or C and D</code> is evaluated as <code>(A AND B) OR (C AND D)</code>.</p><h3>Workflows</h3></p><p>Workflows define approval requirements and actions:</p><pre><code class="language-yaml">workflows:
  my-workflow:
    description: "Optional description"</p><p>    # Trigger conditions (for filtering)
    trigger:
      environment: production</p><p>    # Approval requirements (OR logic between items)
    require:
      <ul><li>policy: dev-team</li>
      <li>policy: security</li>
      </ul># Or inline approvers:
      <ul><li>approvers: [alice, bob]</li>
        </ul>require_all: true</p><p>    # Issue configuration
    issue:
      title: "Approval: {{version}}"
      body: |                          # Inline custom template (optional)
        ## My Custom Approval Issue
        Version: {{.Version}}
        Requested by: @{{.Requestor}}
        {{.GroupsTable}}
      body_file: "templates/my-template.md"  # Or load from file
      labels: [production, deploy]
      assignees_from_policy: true</p><p>    # Actions on approval
    on_approved:
      create_tag: true
      tag_prefix: "v"  # Creates v1.2.3
      close_issue: true
      comment: "Approved! Tag {{version}} created."</p><p>    # Actions on denial
    on_denied:
      close_issue: true
      comment: "Denied by {{denier}}."</p><p>    # Actions when issue is manually closed
    on_closed:
      delete_tag: true   # Delete the tag if issue is closed
      comment: "Deployment cancelled. Tag {{tag}} deleted."</code></pre></p><h3>Tagging Configuration</h3></p><p>Control how tags are created per workflow:</p><pre><code class="language-yaml">workflows:
  dev-deploy:
    require:
      <ul><li>policy: dev-team</li>
    </ul>on_approved:
      tagging:
        enabled: true
        start_version: "0.1.0"      # No 'v' prefix, start at 0.1.0
        auto_increment: patch        # Auto-bump: 0.1.0 -> 0.1.1 -> 0.1.2
        env_prefix: "dev-"           # Creates: dev-0.1.0, dev-0.1.1</p><p>  staging-deploy:
    require:
      <ul><li>policy: qa-team</li>
    </ul>on_approved:
      tagging:
        enabled: true
        start_version: "v1.0.0"     # 'v' prefix (inferred from start_version)
        auto_increment: minor        # v1.0.0 -> v1.1.0 -> v1.2.0
        env_prefix: "staging-"       # Creates: staging-v1.0.0</p><p>  production-deploy:
    require:
      <ul><li>policy: prod-team</li>
    </ul>on_approved:
      tagging:
        enabled: true
        start_version: "v1.0.0"     # Manual version required (no auto_increment)</code></pre></p><p><strong>Tagging options:</strong></p><p>| Option | Description |
|--------|-------------|
| <code>enabled</code> | Enable tag creation |
| <code>start_version</code> | Starting version and format (e.g., "v1.0.0" or "1.0.0") |
| <code>prefix</code> | Version prefix (inferred from <code>start_version</code> if not set) |
| <code>auto_increment</code> | Auto-bump: <code>major</code>, <code>minor</code>, <code>patch</code>, or omit for manual |
| <code>env_prefix</code> | Environment prefix (e.g., "dev-" creates "dev-v1.0.0") |</p><h3>Custom Issue Templates</h3></p><p>You can fully customize the issue body using Go templates. Use <code>body</code> for inline templates or <code>body_file</code> to load from a file.</p><p><strong>Available template variables:</strong></p><p>| Variable | Description |
|----------|-------------|
| <code>{{.Title}}</code> | Issue title |
| <code>{{.Description}}</code> | Workflow description |
| <code>{{.Version}}</code> | Semver version |
| <code>{{.Requestor}}</code> | GitHub username who requested |
| <code>{{.Environment}}</code> | Environment name |
| <code>{{.RunURL}}</code> | Link to workflow run |
| <code>{{.RepoURL}}</code> | Repository URL |
| <code>{{.CommitSHA}}</code> | Full commit SHA |
| <code>{{.CommitURL}}</code> | Link to commit |
| <code>{{.Branch}}</code> | Branch name |
| <code>{{.GroupsTable}}</code> | Pre-rendered approval status table |
| <code>{{.Timestamp}}</code> | Request timestamp |
| <code>{{.PreviousVersion}}</code> | Previous version/tag |
| <code>{{.CommitsCount}}</code> | Number of commits in this release |
| <code>{{.HasJiraIssues}}</code> | Boolean - whether Jira issues exist |
| <code>{{.JiraIssues}}</code> | Array of Jira issue data |
| <code>{{.JiraIssuesTable}}</code> | Pre-rendered Jira issues table |
| <code>{{.PipelineTable}}</code> | Pre-rendered deployment pipeline table |
| <code>{{.PipelineMermaid}}</code> | Pre-rendered Mermaid flowchart diagram |
| <code>{{.Vars.key}}</code> | Custom variables |</p><p><strong>Template functions:</strong></p><p>| Function | Example | Description |
|----------|---------|-------------|
| <code>slice</code> | <code>{{slice .CommitSHA 0 7}}</code> | Substring (short SHA) |
| <code>title</code> | <code>{{.Environment \| title}}</code> | Title case |
| <code>upper</code> | <code>{{.Version \| upper}}</code> | Uppercase |
| <code>lower</code> | <code>{{.Version \| lower}}</code> | Lowercase |
| <code>join</code> | <code>{{join .Groups ","}}</code> | Join array |
| <code>contains</code> | <code>{{if contains .Branch "feature"}}</code> | Check substring |
| <code>replace</code> | <code>{{replace .Version "v" ""}}</code> | Replace string |
| <code>default</code> | <code>{{default "N/A" .Environment}}</code> | Default value |</p><p><strong>Example custom template file</strong> (<code>.github/templates/deploy.md</code>):</p><pre><code class="language-markdown">## {{.Title}}</p><h3>Release Information</h3></p><ul><li><strong>Version:</strong> <code>{{.Version}}</code></li>
<li><strong>Requested by:</strong> @{{.Requestor}}</li>
</ul>{{- if .CommitSHA}}
<ul><li><strong>Commit:</strong> <a href="https://raw.githubusercontent.com/jamengual/enterprise-approval-engine/main/{{.CommitURL}}" target="_blank" rel="noopener noreferrer">{{slice .CommitSHA 0 7}}</a></li>
</ul>{{- end}}
{{- if .CommitsCount}}
<ul><li><strong>Changes:</strong> {{.CommitsCount}} commits since {{.PreviousVersion}}</li>
</ul>{{- end}}</p><p>{{if .HasJiraIssues}}
<h3>Jira Issues</h3></p><p>{{.JiraIssuesTable}}
{{end}}</p><h3>Approval Status</h3></p><p>{{.GroupsTable}}</p><hr></p><p><strong>Approve:</strong> Comment <code>approve</code> | <strong>Deny:</strong> Comment <code>deny</code></code></pre></p><h3>Defaults</h3></p><p>Global defaults that apply to all workflows:</p><pre><code class="language-yaml">defaults:
  timeout: 72h                    # Default approval timeout
  allow_self_approval: false      # Whether requestors can approve their own requests
  issue_labels:                   # Labels added to all approval issues
    <ul><li>approval-required</code></pre></li></p><p></ul><h3>Semver</h3></p><p>Configure version handling:</p><pre><code class="language-yaml">semver:
  prefix: "v"              # Tag prefix (v1.2.3)
  strategy: input          # Use version from input
  validate: true           # Validate semver format
  allow_prerelease: true   # Allow prerelease versions (e.g., v1.0.0-beta.1)
  auto:                    # Label-based auto-increment (when strategy: auto)
    major_labels: [breaking, major]
    minor_labels: [feature, minor]
    patch_labels: [fix, patch, bug]</code></pre></p><hr></p><h2>Complete Configuration Reference</h2></p><p>This section documents <strong>every configuration option</strong> available in <code>approvals.yml</code>.</p><h3>Top-Level Structure</h3></p><pre><code class="language-yaml">version: 1                    # Required: config version (always 1)
defaults: { ... }             # Optional: global defaults
policies: { ... }             # Required: reusable approval policies
workflows: { ... }            # Required: approval workflows
semver: { ... }               # Optional: version handling settings</code></pre></p><h3><code>defaults</code> Options</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>timeout</code> | duration | <code>72h</code> | Timeout for blocking <code>check</code> action with <code>wait: true</code>. Use hours (e.g., <code>168h</code> for 1 week). Not needed for event-driven workflows. |
| <code>allow_self_approval</code> | bool | <code>false</code> | Whether the requestor can approve their own request |
| <code>issue_labels</code> | string[] | <code>[]</code> | Labels added to all approval issues |</p><h3><code>policies.<name></code> Options (Simple Format)</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>approvers</code> | string[] | - | List of usernames or <code>team:slug</code> references |
| <code>min_approvals</code> | int | 0 | Number of approvals required (0 = use <code>require_all</code>) |
| <code>require_all</code> | bool | <code>false</code> | If true, ALL approvers must approve |</p><h3><code>policies.<name></code> Options (Advanced Format)</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>from</code> | source[] | - | List of approver sources with individual thresholds |
| <code>logic</code> | string | <code>"and"</code> | How to combine sources: <code>"and"</code> or <code>"or"</code> |</p><p><strong>Approver Source Options (<code>from[]</code>):</strong></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>team</code> | string | - | Team slug (e.g., <code>"platform"</code> or <code>"org/platform"</code>) |
| <code>user</code> | string | - | Single username |
| <code>users</code> | string[] | - | List of usernames |
| <code>min_approvals</code> | int | 1 | Approvals required from this source |
| <code>require_all</code> | bool | <code>false</code> | All from this source must approve |
| <code>logic</code> | string | - | Logic to next source: <code>"and"</code> or <code>"or"</code> |</p><h3><code>workflows.<name></code> Options</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>description</code> | string | - | Human-readable description |
| <code>trigger</code> | map | - | Trigger conditions (for filtering) |
| <code>require</code> | requirement[] | - | <strong>Required:</strong> Approval requirements (OR logic between items) |
| <code>issue</code> | object | - | Issue creation settings |
| <code>on_approved</code> | object | - | Actions when approved |
| <code>on_denied</code> | object | - | Actions when denied |
| <code>on_closed</code> | object | - | Actions when issue is manually closed |
| <code>pipeline</code> | object | - | Progressive deployment pipeline config |</p><h3><code>workflows.<name>.require[]</code> Options</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>policy</code> | string | - | Reference to a defined policy |
| <code>approvers</code> | string[] | - | Inline approvers (alternative to policy) |
| <code>min_approvals</code> | int | - | Override policy's min_approvals |
| <code>require_all</code> | bool | - | Override policy's require_all |</p><h3><code>workflows.<name>.issue</code> Options</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>title</code> | string | <code>"Approval Required: {workflow}"</code> | Issue title (supports <code>{{version}}</code>, <code>{{environment}}</code>, <code>{{workflow}}</code>) |
| <code>body</code> | string | - | Custom issue body template (Go template syntax) |
| <code>body_file</code> | string | - | Path to template file (relative to <code>.github/</code>) |
| <code>labels</code> | string[] | <code>[]</code> | Additional labels for this workflow |
| <code>assignees_from_policy</code> | bool | <code>false</code> | Auto-assign individual users from policies (max 10) |</p><h3><code>workflows.<name>.on_approved</code> Options</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>create_tag</code> | bool | <code>false</code> | Create a git tag (uses input version) |
| <code>close_issue</code> | bool | <code>false</code> | Close the issue after approval |
| <code>comment</code> | string | - | Comment to post (supports <code>{{version}}</code>, <code>{{satisfied_group}}</code>) |
| <code>tagging</code> | object | - | Advanced tagging configuration |</p><h3><code>workflows.<name>.on_approved.tagging</code> Options</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>enabled</code> | bool | <code>false</code> | Enable tag creation |
| <code>start_version</code> | string | <code>"0.0.0"</code> | Initial version (e.g., <code>"v1.0.0"</code> or <code>"1.0.0"</code>) |
| <code>prefix</code> | string | (inferred) | Version prefix (inferred from <code>start_version</code>) |
| <code>auto_increment</code> | string | - | Auto-bump: <code>"major"</code>, <code>"minor"</code>, <code>"patch"</code>, or omit for manual |
| <code>env_prefix</code> | string | - | Environment prefix (e.g., <code>"dev-"</code> creates <code>"dev-v1.0.0"</code>) |</p><h3><code>workflows.<name>.on_denied</code> Options</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>close_issue</code> | bool | <code>false</code> | Close the issue after denial |
| <code>comment</code> | string | - | Comment to post (supports <code>{{denier}}</code>) |</p><h3><code>workflows.<name>.on_closed</code> Options</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>delete_tag</code> | bool | <code>false</code> | Delete the associated tag when issue is closed |
| <code>comment</code> | string | - | Comment to post (supports <code>{{tag}}</code>, <code>{{version}}</code>) |</p><h3><code>workflows.<name>.pipeline</code> Options</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>stages</code> | stage[] | - | <strong>Required:</strong> Ordered list of deployment stages |
| <code>track_prs</code> | bool | <code>false</code> | Include merged PRs in issue body |
| <code>track_commits</code> | bool | <code>false</code> | Include commits in issue body |
| <code>compare_from_tag</code> | string | - | Tag pattern to compare from (e.g., <code>"v*"</code>) |
| <code>show_mermaid_diagram</code> | bool | <code>true</code> | Show visual Mermaid flowchart of pipeline stages |
| <code>release_strategy</code> | object | - | Release candidate selection strategy |</p><h3><code>workflows.<name>.pipeline.stages[]</code> Options</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>name</code> | string | - | <strong>Required:</strong> Stage name (e.g., <code>"dev"</code>, <code>"prod"</code>) |
| <code>environment</code> | string | - | GitHub environment name |
| <code>policy</code> | string | - | Approval policy for this stage |
| <code>approvers</code> | string[] | - | Inline approvers (alternative to policy) |
| <code>on_approved</code> | string | - | Comment to post when stage is approved |
| <code>create_tag</code> | bool | <code>false</code> | Create a git tag at this stage |
| <code>is_final</code> | bool | <code>false</code> | Close issue after this stage |
| <code>auto_approve</code> | bool | <code>false</code> | Automatically approve without human intervention |</p><h3><code>workflows.<name>.pipeline.release_strategy</code> Options</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>type</code> | string | <code>"tag"</code> | Strategy: <code>"tag"</code>, <code>"branch"</code>, <code>"label"</code>, <code>"milestone"</code> |
| <code>branch</code> | object | - | Branch strategy settings |
| <code>label</code> | object | - | Label strategy settings |
| <code>milestone</code> | object | - | Milestone strategy settings |
| <code>auto_create</code> | object | - | Auto-create next release artifact |</p><h3><code>release_strategy.branch</code> Options</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>pattern</code> | string | <code>"release/{{version}}"</code> | Branch naming pattern |
| <code>base_branch</code> | string | <code>"main"</code> | Branch to compare against |
| <code>delete_after_release</code> | bool | <code>false</code> | Delete branch after prod deployment |</p><h3><code>release_strategy.label</code> Options</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>pattern</code> | string | <code>"release:{{version}}"</code> | Label naming pattern |
| <code>pending_label</code> | string | - | Label for PRs awaiting release assignment |
| <code>remove_after_release</code> | bool | <code>false</code> | Remove labels after prod deployment |</p><h3><code>release_strategy.milestone</code> Options</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>pattern</code> | string | <code>"v{{version}}"</code> | Milestone naming pattern |
| <code>close_after_release</code> | bool | <code>false</code> | Close milestone after prod deployment |</p><h3><code>release_strategy.auto_create</code> Options</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>enabled</code> | bool | <code>false</code> | Enable auto-creation on final stage completion |
| <code>next_version</code> | string | <code>"patch"</code> | Version increment: <code>"patch"</code>, <code>"minor"</code>, <code>"major"</code> |
| <code>create_issue</code> | bool | <code>false</code> | Create new approval issue for next release |
| <code>comment</code> | string | - | Comment to post about next release |</p><h3><code>semver</code> Options</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>prefix</code> | string | <code>"v"</code> | Tag prefix |
| <code>strategy</code> | string | <code>"input"</code> | Version strategy: <code>"input"</code>, <code>"auto"</code> |
| <code>validate</code> | bool | <code>false</code> | Validate semver format |
| <code>allow_prerelease</code> | bool | <code>false</code> | Allow prerelease versions (e.g., <code>v1.0.0-beta.1</code>) |
| <code>auto</code> | object | - | Label-based auto-increment settings |</p><h3><code>semver.auto</code> Options</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>major_labels</code> | string[] | <code>[]</code> | PR labels that trigger major bump |
| <code>minor_labels</code> | string[] | <code>[]</code> | PR labels that trigger minor bump |
| <code>patch_labels</code> | string[] | <code>[]</code> | PR labels that trigger patch bump |</p><hr></p><h2>Feature Details</h2></p><h3>Approval Keywords</h3></p><p>Users can approve or deny requests by commenting on the issue:</p><p><strong>Approval keywords:</strong> <code>approve</code>, <code>approved</code>, <code>lgtm</code>, <code>yes</code>, <code>/approve</code></p><p><strong>Denial keywords:</strong> <code>deny</code>, <code>denied</code>, <code>reject</code>, <code>rejected</code>, <code>no</code>, <code>/deny</code></p><h3>Team Support</h3></p><p>To use GitHub team-based approvers, you need elevated permissions. The standard <code>GITHUB_TOKEN</code> cannot list team members. Use a GitHub App token:</p><pre><code class="language-yaml">jobs:
  process:
    runs-on: ubuntu-latest
    steps:
      <ul><li>uses: actions/checkout@v4</li></p><p>      </ul># Generate GitHub App token
      <ul><li>uses: actions/create-github-app-token@v2</li>
        </ul>id: app-token
        with:
          app-id: ${{ vars.APP_ID }}
          private-key: ${{ secrets.APP_PRIVATE_KEY }}</p><p>      # Use the app token for team membership checks
      <ul><li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>with:
          action: process-comment
          issue_number: ${{ github.event.issue.number }}
          token: ${{ steps.app-token.outputs.token }}</code></pre></p><p><strong>Required GitHub App permissions:</strong></p><ul><li><code>Organization > Members: Read</code> - To list team members</li></p><p></ul><h3>Progressive Deployment Pipelines</h3></p><p>Track deployments through multiple environments with a single approval issue. As each stage is approved, the issue updates to show progress and automatically advances to the next stage.</p><p>#### Pipeline Configuration</p><pre><code class="language-yaml"># .github/approvals.yml or external config
version: 1</p><p>policies:
  developers:
    approvers: [dev1, dev2, dev3]
    min_approvals: 1</p><p>  qa-team:
    approvers: [qa1, qa2]
    min_approvals: 1</p><p>  tech-leads:
    approvers: [lead1, lead2]
    min_approvals: 1</p><p>  production-approvers:
    approvers: [sre1, sre2, security-lead]
    require_all: true</p><p>workflows:
  deploy:
    description: "Deploy through all environments (dev → qa → stage → prod)"
    require:
      <ul><li>policy: developers  # Initial approval to start pipeline</li>
    </ul>pipeline:
      track_prs: true       # Include PRs in the issue body
      track_commits: true   # Include commits in the issue body
      stages:
        <ul><li>name: dev</li>
          </ul>environment: development
          policy: developers
          on_approved: "✅ <strong>DEV</strong> deployment approved! Proceeding to QA..."
        <ul><li>name: qa</li>
          </ul>environment: qa
          policy: qa-team
          on_approved: "✅ <strong>QA</strong> deployment approved! Proceeding to STAGING..."
        <ul><li>name: stage</li>
          </ul>environment: staging
          policy: tech-leads
          on_approved: "✅ <strong>STAGING</strong> deployment approved! Ready for PRODUCTION..."
        <ul><li>name: prod</li>
          </ul>environment: production
          policy: production-approvers
          on_approved: "🚀 <strong>PRODUCTION</strong> deployment complete!"
          create_tag: true   # Create tag when PROD is approved
          is_final: true     # Close issue after this stage
    on_approved:
      close_issue: true
      comment: |
        🎉 <strong>Deployment Complete!</strong></p><p>        Version <code>{{version}}</code> has been deployed to all environments.</code></pre></p><p>#### Pipeline Workflow Example</p><pre><code class="language-yaml"># .github/workflows/request-pipeline.yml
name: Request Pipeline Deployment</p><p>on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to deploy'
        required: true
        type: string</p><p>permissions:
  contents: write
  issues: write
  pull-requests: read  # Required for PR tracking</p><p>jobs:
  request:
    runs-on: ubuntu-latest
    steps:
      <ul><li>uses: actions/checkout@v4</li>
        </ul>with:
          fetch-depth: 0  # Needed for commit/PR comparison</p><ul><li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>id: approval
        with:
          action: request
          workflow: deploy
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}</p><ul><li>name: Output Results</li>
        </ul>run: |
          echo "## Pipeline Deployment Started" >> $GITHUB_STEP_SUMMARY
          echo "- <strong>Issue:</strong> #${{ steps.approval.outputs.issue_number }}" >> $GITHUB_STEP_SUMMARY
          echo "- <strong>URL:</strong> ${{ steps.approval.outputs.issue_url }}" >> $GITHUB_STEP_SUMMARY</code></pre></p><p>#### How It Works</p><ul><li><strong>Issue Creation</strong>: When triggered, creates a single issue showing all stages with a visual Mermaid diagram and progress table:</li></p><p></ul><pre><code class="language-markdown">## 🚀 Deployment Pipeline: v1.2.0</p><h3>Pipeline Flow</h3></p><p>​``<code>mermaid
flowchart LR
    DEV(⏳ DEV)
    QA(⬜ QA)
    STAGE(⬜ STAGE)
    PROD(⬜ PROD)
    DEV --> QA --> STAGE --> PROD</p><p>    classDef completed fill:#28a745,stroke:#1e7e34,color:#fff
    classDef current fill:#ffc107,stroke:#d39e00,color:#000
    classDef pending fill:#6c757d,stroke:#545b62,color:#fff
    class DEV current
    class QA,STAGE,PROD pending
​</code>`<code></p><h3>Deployment Progress</h3></p><p>| Stage | Status | Approver | Time |
|-------|--------|----------|------|
| DEV | ⏳ Awaiting | - | - |
| QA | ⬜ Pending | - | - |
| STAGE | ⬜ Pending | - | - |
| PROD | ⬜ Pending | - | - |</p><p><strong>Current Stage:</strong> DEV</code></pre></p><p>The Mermaid diagram provides an at-a-glance view with color-coded nodes:
<ul><li>🟢 <strong>Green</strong> - Completed stages</li>
<li>🟡 <strong>Yellow</strong> - Current stage awaiting approval</li>
<li>⚪ <strong>Gray</strong> - Pending stages</li>
<li>🔵 <strong>Cyan</strong> - Auto-approve stages</li></p><p></ul>To disable the Mermaid diagram, set </code>show_mermaid_diagram: false<code> in the pipeline config.</p><ul><li><strong>Stage Progression</strong>: Comment </code>approve<code> to advance to the next stage. Both the diagram and table update automatically:</li></p><p></ul><pre><code class="language-markdown">| Stage | Status | Approver | Time |
|-------|--------|----------|------|
| DEV | ✅ Deployed | @developer1 | Dec 9 10:30 |
| QA | ✅ Deployed | @qa-lead | Dec 9 14:15 |
| STAGE | ⏳ Awaiting | - | - |
| PROD | ⬜ Pending | - | - |</p><p><strong>Current Stage:</strong> STAGE</code></pre>
<ul><li><strong>PR and Commit Tracking</strong>: Release managers see exactly what's being deployed:</li></p><p>
</ul><pre><code class="language-markdown">### Pull Requests in this Release</p><p>| PR | Title | Author |
|----|-------|--------|
| <a href="https://..." target="_blank" rel="noopener noreferrer">#42</a> | Add user authentication | @alice |
| <a href="https://..." target="_blank" rel="noopener noreferrer">#45</a> | Fix payment processing bug | @bob |</p><h3>Commits</h3></p><ul><li><a href="https://..." target="_blank" rel="noopener noreferrer"></code>abc1234<code></a> feat: add OAuth2 support</li>
<li><a href="https://..." target="_blank" rel="noopener noreferrer"></code>def5678<code></a> fix: handle null payments</code></pre></li>
<li><strong>Completion</strong>: When the final stage is approved:</li>
   <li>Tag is created (if </code>create_tag: true<code>)</li>
   <li>Completion comment is posted</li>
   <li>Issue is automatically closed</li></p><p></ul>#### Pipeline Stage Options</p><p>| Option | Description |
|--------|-------------|
| </code>name<code> | Stage name (displayed in table) |
| </code>environment<code> | GitHub environment name |
| </code>policy<code> | Approval policy for this stage |
| </code>approvers<code> | Inline approvers (alternative to policy) |
| </code>on_approved<code> | Message to post when stage is approved |
| </code>create_tag<code> | Create a git tag at this stage |
| </code>is_final<code> | Close the issue after this stage |
| </code>auto_approve<code> | Automatically approve this stage without human intervention |
| </code>approval_mode<code> | Override workflow approval mode for this stage |</p><p>#### Approval Modes</p><p>Choose how approvers interact with approval requests:</p><p>| Mode | Description |
|------|-------------|
| </code>comments<code> | (Default) Approvers comment </code>/approve<code> or </code>approve<code> on the issue |
| </code>sub_issues<code> | Creates a sub-issue for each stage - close to approve |
| </code>hybrid<code> | Mix modes per stage - use </code>approval_mode<code> on each stage |</p><p><strong>Sub-Issue Approval Example:</strong></p><pre><code class="language-yaml">workflows:
  deploy:
    approval_mode: sub_issues
    sub_issue_settings:
      title_template: "⏳ Approve: {{stage}} for {{version}}"  # Changes to ✅ when approved
      labels: [approval-stage]
      protection:
        only_assignee_can_close: true   # Prevents unauthorized approvals
        prevent_parent_close: true       # Parent can't close until all approved
    pipeline:
      stages:
        <ul><li>name: dev</li>
          </ul>policy: developers
        <ul><li>name: prod</li>
          </ul>policy: production-approvers</code></pre>
With sub-issues, the parent issue shows a table of approval sub-issues:</p><pre><code class="language-markdown">### 📋 Approval Sub-Issues</p><p>| Stage | Sub-Issue | Status | Assignees |
|-------|-----------|--------|----------|
| DEV | #124 | ⏳ Awaiting | @alice, @bob |
| PROD | #125 | ⏳ Awaiting | @sre1, @sre2 |</code></pre></p><p><strong>Hybrid Mode (per-stage override):</strong></p><pre><code class="language-yaml">workflows:
  deploy:
    approval_mode: comments  # Default for this workflow
    pipeline:
      stages:
        <ul><li>name: dev</li>
          </ul>policy: developers
          # Uses comments (workflow default)
        <ul><li>name: prod</li>
          </ul>policy: production-approvers
          approval_mode: sub_issues  # Override for production only</code></pre></p><p>#### Enhanced Comments UX</p><p>The action includes enhanced comment-based approval UX:</p><ul><li><strong>Emoji Reactions</strong>: Automatic reactions on approval comments</li>
  <li>👍 Approved</li>
  <li>👎 Denied</li>
  <li>👀 Seen (processing)</li></p><p><li><strong>Quick Actions Section</strong>: Issue body includes a command reference table:</li></p><p></ul><pre><code class="language-markdown">### ⚡ Quick Actions</p><p>| Action | Command | Description |
|--------|---------|-------------|
| ✅ Approve | </code>/approve<code> | Approve the <strong>DEV</strong> stage |
| ❌ Deny | </code>/deny [reason]<code> | Deny with optional reason |
| 📊 Status | </code>/status<code> | Show current approval status |</code></pre></p><p><strong>Configure via </code>comment_settings<code>:</strong></p><pre><code class="language-yaml">workflows:
  deploy:
    comment_settings:
      react_to_comments: true     # Add emoji reactions (default: true)
      show_quick_actions: true    # Show Quick Actions section (default: true)</code></pre></p><p>#### Auto-Approve for Lower Environments</p><p>Use </code>auto_approve: true<code> on pipeline stages that should be automatically approved without human intervention. This is ideal for lower environments like </code>dev<code> or </code>integration<code> where you want to speed up the pipeline while still maintaining approval gates for production.</p><p><strong>Example with auto-approve:</strong></p><pre><code class="language-yaml">workflows:
  deploy:
    description: "Deploy through environments"
    pipeline:
      stages:
        <ul><li>name: dev</li>
          </ul>environment: development
          auto_approve: true              # Automatically approved
          on_approved: "🤖 DEV auto-deployed"
        <ul><li>name: integration</li>
          </ul>environment: integration
          auto_approve: true              # Automatically approved
          on_approved: "🤖 INTEGRATION auto-deployed"
        <ul><li>name: staging</li>
          </ul>environment: staging
          policy: qa-team                 # Requires manual approval
          on_approved: "✅ STAGING approved"
        <ul><li>name: production</li>
          </ul>environment: production
          policy: production-approvers    # Requires manual approval
          create_tag: true
          is_final: true</code></pre></p><p><strong>How it works:</strong></p><ul><li>When a pipeline issue is created, all initial </code>auto_approve: true<code> stages are automatically completed</li>
<li>When a stage is manually approved, any consecutive </code>auto_approve: true<code> stages that follow are also automatically completed</li>
<li>Auto-approved stages show with 🤖 indicator in the pipeline table</li>
<li>The approver is recorded as </code>[auto]<code> in the stage history</li></p><p></ul><strong>Use cases:</strong></p><ul><li><strong>Development environments</strong>: Deploy immediately without waiting for approval</li>
<li><strong>Integration testing</strong>: Let CI/CD pipeline progress automatically through test environments</li>
<li><strong>Canary deployments</strong>: Auto-approve canary stage, require approval for full rollout</li></p><p></ul>#### Pipeline Config Options</p><p>| Option | Default | Description |
|--------|---------|-------------|
| </code>track_prs<code> | </code>false<code> | Include merged PRs in the issue body |
| </code>track_commits<code> | </code>false<code> | Include commits since last tag |
| </code>compare_from_tag<code> | - | Custom tag pattern to compare from |
| </code>show_mermaid_diagram<code> | </code>true<code> | Show visual Mermaid flowchart of pipeline stages |</p><p><strong>Note:</strong> PR tracking requires </code>pull-requests: read<code> permission in your workflow.</p><h3>Release Candidate Strategies</h3></p><p>In enterprise environments, PRs merged to main aren't always immediate release candidates. The approval engine supports three strategies for selecting which PRs belong to a release:</p><p>#### Strategy Types</p><p>| Strategy | Description | Use Case |
|----------|-------------|----------|
| </code>tag<code> | PRs between two git tags (default) | Simple releases, trunk-based development |
| </code>branch<code> | PRs merged to a release branch | GitFlow, release branches |
| </code>label<code> | PRs with a specific release label | Flexible selection, batched releases |
| </code>milestone<code> | PRs assigned to a GitHub milestone | Roadmap-aligned releases |</p><p>#### Configuration</p><pre><code class="language-yaml"># .github/approvals.yml
workflows:
  deploy:
    description: "Production deployment pipeline"
    pipeline:
      track_prs: true
      track_commits: true</p><p>      # Configure release selection strategy
      release_strategy:
        type: milestone  # or: tag, branch, label</p><p>        # Milestone strategy settings
        milestone:
          pattern: "v{{version}}"        # e.g., "v1.2.0"
          close_after_release: true       # Close milestone on prod completion</p><p>        # Auto-create next release artifact on completion
        auto_create:
          enabled: true
          next_version: patch             # or: minor, major
          create_issue: true              # Create new approval issue</p><p>      stages:
        <ul><li>name: dev</li>
          </ul>policy: developers
        <ul><li>name: prod</li>
          </ul>policy: production-approvers
          is_final: true</code></pre></p><p>#### Branch Strategy</p><p>Use release branches for GitFlow-style development:</p><pre><code class="language-yaml">release_strategy:
  type: branch
  branch:
    pattern: "release/{{version}}"  # Creates release/v1.2.0
    base_branch: main               # Compare against main
    delete_after_release: true      # Cleanup after prod deploy</p><p>  auto_create:
    enabled: true
    next_version: minor</code></pre></p><p><strong>How it works:</strong>
<ul><li>Create a release branch: </code>release/v1.2.0<code></li>
<li>PRs merged to the branch are release candidates</li>
<li>Request approval for that version</li>
<li>Approval issue shows all PRs in the release branch</li>
<li>After prod, branch is deleted (optional) and next branch is created</li></p><p></ul>#### Label Strategy</p><p>Use labels for flexible PR selection:</p><pre><code class="language-yaml">release_strategy:
  type: label
  label:
    pattern: "release:{{version}}"      # e.g., "release:v1.2.0"
    pending_label: "pending-release"    # Applied to merged PRs awaiting release
    remove_after_release: true          # Remove label after prod deploy</p><p>  auto_create:
    enabled: true
    next_version: patch</code></pre></p><p><strong>How it works:</strong>
<ul><li>PRs merged to main get the </code>pending-release<code> label</li>
<li>Release manager applies </code>release:v1.2.0<code> to selected PRs</li>
<li>Request approval for v1.2.0</li>
<li>Approval issue shows only PRs with that label</li>
<li>After prod, labels are removed and next release label is created</li></p><p></ul>#### Milestone Strategy</p><p>Use milestones for roadmap-aligned releases:</p><pre><code class="language-yaml">release_strategy:
  type: milestone
  milestone:
    pattern: "Release {{version}}"       # e.g., "Release 1.2.0"
    close_after_release: true            # Close milestone on completion</p><p>  auto_create:
    enabled: true
    next_version: minor
    create_issue: true                   # Auto-create next approval issue</code></pre></p><p><strong>How it works:</strong>
<ul><li>Create milestone: "Release 1.2.0"</li>
<li>Assign PRs to the milestone during development</li>
<li>Request approval for v1.2.0</li>
<li>Approval issue shows all PRs in the milestone</li>
<li>After prod, milestone is closed and next milestone is created</li></p><p></ul>#### Auto-Creation on Completion</p><p>When the final stage (prod) is approved, automatically prepare for the next release:</p><pre><code class="language-yaml">auto_create:
  enabled: true
  next_version: patch      # Calculate next: patch, minor, or major
  create_issue: true       # Create new approval issue immediately
  comment: |               # Custom message (optional)
    🚀 <strong>Next release prepared:</strong> {{version}}</code></pre></p><p>This creates:
<ul><li><strong>Branch strategy:</strong> New release branch from main</li>
<li><strong>Label strategy:</strong> New release label</li>
<li><strong>Milestone strategy:</strong> New milestone</li></p><p></ul>#### Cleanup Options</p><p>Each strategy has optional cleanup actions that run when the final stage (prod) is approved. <strong>All cleanup options default to </code>false<code></strong> - cleanup is opt-in:</p><p>| Strategy | Cleanup Option | Description |
|----------|----------------|-------------|
| Branch | </code>delete_after_release<code> | Delete the release branch |
| Label | </code>remove_after_release<code> | Remove release labels from PRs |
| Milestone | </code>close_after_release<code> | Close the milestone |</p><pre><code class="language-yaml">release_strategy:
  type: branch
  branch:
    pattern: "release/{{version}}"
    delete_after_release: false   # Keep branch for reference (default)</p><p>  type: milestone
  milestone:
    pattern: "v{{version}}"
    close_after_release: true     # Close milestone when done</code></pre></p><p>#### Hotfix Deployments</p><p>For emergency hotfixes that need to bypass normal release workflows, create a separate workflow:</p><pre><code class="language-yaml"># .github/approvals.yml
workflows:
  # Standard releases - full pipeline with milestone tracking
  deploy:
    description: "Standard release pipeline (dev → qa → stage → prod)"
    pipeline:
      release_strategy:
        type: milestone
        milestone:
          pattern: "v{{version}}"
          close_after_release: true
        auto_create:
          enabled: true
          next_version: minor
      stages:
        <ul><li>name: dev</li>
          </ul>policy: developers
        <ul><li>name: qa</li>
          </ul>policy: qa-team
        <ul><li>name: stage</li>
          </ul>policy: tech-leads
        <ul><li>name: prod</li>
          </ul>policy: production-approvers
          is_final: true</p><p>  # Hotfixes - skip stages, direct to prod
  hotfix:
    description: "Emergency hotfix - direct to production"
    pipeline:
      release_strategy:
        type: tag              # Simple tag-based, no cleanup needed
        # No auto_create - hotfixes are one-off
      stages:
        <ul><li>name: prod</li>
          </ul>policy: production-approvers
          create_tag: true
          is_final: true
    on_approved:
      close_issue: true
      comment: "🚨 Hotfix {{version}} deployed to production"</code></pre></p><p><strong>Trigger hotfix vs regular release:</strong></p><pre><code class="language-bash"># Regular release - goes through all stages
gh workflow run request-approval.yml -f workflow_name=deploy -f version=v1.3.0</p><h1>Hotfix - goes straight to prod</h1>
gh workflow run request-approval.yml -f workflow_name=hotfix -f version=v1.2.1</code></pre></p><p><strong>Hotfix patterns:</strong></p><p>| Scenario | Strategy | Cleanup | Auto-Create |
|----------|----------|---------|-------------|
| Emergency fix | </code>tag<code> | None | Disabled |
| Patch release | </code>milestone<code> | </code>close_after_release: false<code> | Disabled |
| Multiple hotfixes | </code>branch<code> | </code>delete_after_release: false<code> | Disabled |</p><p>#### Release Strategy Benefits</p><p>| Strategy | Pros | Cons |
|----------|------|------|
| <strong>Tag</strong> | Simple, no extra workflow | All merged PRs included |
| <strong>Branch</strong> | Clear release scope, isolation | Branch management overhead |
| <strong>Label</strong> | Flexible selection, easy to change | Manual labeling required |
| <strong>Milestone</strong> | Roadmap visibility, planning integration | Requires milestone discipline |</p><p><strong>Recommendation:</strong></p><ul><li>Use <strong>tag</strong> for simple projects with continuous deployment</li>
<li>Use <strong>branch</strong> for regulated environments needing release isolation</li>
<li>Use <strong>label</strong> for batched releases with flexible scope</li>
<li>Use <strong>milestone</strong> for roadmap-driven development with clear release planning</li></p><p></ul><h3>Jira Integration</h3></p><p>Automatically extract Jira issues from commits and branch names. The action supports two modes:</p><p>#### Links-Only Mode (No Auth Required)</p><p>Just provide </code>jira_base_url<code> to extract issue keys and display them as clickable links:</p><pre><code class="language-yaml">- uses: jamengual/enterprise-approval-engine@v1
  with:
    action: request
    workflow: production-deploy
    version: v1.2.0
    token: ${{ secrets.GITHUB_TOKEN }}
    jira_base_url: https://yourcompany.atlassian.net  # That's it!</code></pre></p><p>This extracts issue keys (e.g., </code>PROJ-123<code>) from commit messages and branch names, displaying them as links in the approval issue:</p><pre><code class="language-markdown">### Jira Issues
<ul><li><a href="https://yourcompany.atlassian.net/browse/PROJ-123" target="_blank" rel="noopener noreferrer">PROJ-123</a></li>
<li><a href="https://yourcompany.atlassian.net/browse/PROJ-456" target="_blank" rel="noopener noreferrer">PROJ-456</a></code></pre></li></p><p></ul>#### Full Mode (With API Access)</p><p>Add credentials to also fetch issue details and update Fix Versions:</p><pre><code class="language-yaml">- uses: jamengual/enterprise-approval-engine@v1
  with:
    action: request
    workflow: production-deploy
    version: v1.2.0
    token: ${{ secrets.GITHUB_TOKEN }}
    # Jira configuration
    jira_base_url: https://yourcompany.atlassian.net
    jira_user_email: ${{ secrets.JIRA_EMAIL }}
    jira_api_token: ${{ secrets.JIRA_API_TOKEN }}
    jira_update_fix_version: 'true'</code></pre></p><p>This displays rich issue information:</p><pre><code class="language-markdown">### Jira Issues in this Release</p><p>| Key | Summary | Type | Status |
|-----|---------|------|--------|
| <a href="https://..." target="_blank" rel="noopener noreferrer">PROJ-123</a> | Fix login bug | Bug | Done |
| <a href="https://..." target="_blank" rel="noopener noreferrer">PROJ-456</a> | Add dark mode | Feature | In Progress |</code></pre></p><p><strong>Comparison of modes:</strong></p><p>| Mode | Auth Required | Features |
|------|---------------|----------|
| Links-only | No | Issue keys as clickable links |
| Full | Yes | Links + summary, status, type emojis, Fix Version updates |</p><p><strong>Jira outputs:</strong></p><pre><code class="language-yaml">- name: Use Jira Outputs
  run: |
    echo "Issues: ${{ steps.approval.outputs.jira_issues }}"
    # Output: PROJ-123,PROJ-456</p><p>    echo "Details: ${{ steps.approval.outputs.jira_issues_json }}"
    # Output: [{"key":"PROJ-123","summary":"Fix login bug",...}]</code></pre></p><h3>Deployment Tracking</h3></p><p>Create GitHub deployments for visibility in GitHub's deployment dashboard. This works independently of the </code>environment:<code> key in workflow YAML.</p><pre><code class="language-yaml">- uses: jamengual/enterprise-approval-engine@v1
  id: approval
  with:
    action: request
    workflow: production-deploy
    version: v1.2.0
    token: ${{ secrets.GITHUB_TOKEN }}
    # Deployment tracking
    create_deployment: 'true'
    deployment_environment: production
    deployment_environment_url: https://myapp.example.com</p><ul><li>name: Update Deployment Status</li>
  </ul>if: steps.approval.outputs.status == 'approved'
  run: |
    # Use the deployment_id to update status after actual deployment
    echo "Deployment ID: ${{ steps.approval.outputs.deployment_id }}"</code></pre></p><p><strong>Where deployments appear:</strong></p><ul><li>Repository's <strong>Deployments</strong> tab</li>
<li>Environment status badges on the repo page</li>
<li>GitHub for Jira integration (if configured)</li>
<li>GitHub API for CI/CD tooling</li></p><p></ul><strong>Note:</strong> This creates deployments via the GitHub Deployments API, which is separate from GitHub's native Environment Protection Rules. You can use both together or independently.</p><h3>External Config Repository</h3></p><p>Store approval configs in a shared repository for centralized policy management:</p><pre><code class="language-yaml">- uses: jamengual/enterprise-approval-engine@v1
  with:
    action: request
    workflow: production-deploy
    token: ${{ secrets.GITHUB_TOKEN }}
    config_repo: myorg/.github  # Shared config repo</code></pre></p><p><strong>Config resolution order:</strong></p><ul><li></code>{repo-name}_approvals.yml<code> in the external repo (e.g., </code>myapp_approvals.yml<code>)</li>
<li></code>approvals.yml<code> in the external repo (shared default)</li>
<li></code>.github/approvals.yml<code> in the current repo (local fallback)</li></p><p></ul><strong>Example organization structure:</strong></p><pre><code class="language-text">myorg/.github/
├── myapp_approvals.yml      # App-specific config
├── backend_approvals.yml    # Backend repos config
└── approvals.yml            # Default for all repos</code></pre></p><h3>Blocking Approvals</h3></p><p>For workflows that require waiting for approval before continuing:</p><pre><code class="language-yaml">name: Deploy with Blocking Approval</p><p>on:
  workflow_dispatch:
    inputs:
      version:
        required: true
        type: string</p><p>jobs:
  request-approval:
    runs-on: ubuntu-latest
    outputs:
      issue_number: ${{ steps.request.outputs.issue_number }}
    steps:
      <ul><li>uses: actions/checkout@v4</li>
      <li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>id: request
        with:
          action: request
          workflow: production-deploy
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}</p><p>  wait-for-approval:
    needs: request-approval
    runs-on: ubuntu-latest
    outputs:
      status: ${{ steps.check.outputs.status }}
      tag: ${{ steps.check.outputs.tag }}
    steps:
      <ul><li>uses: actions/checkout@v4</li>
      <li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>id: check
        with:
          action: check
          issue_number: ${{ needs.request-approval.outputs.issue_number }}
          wait: 'true'           # Poll until approved/denied
          timeout: '4h'          # Max wait time
          token: ${{ secrets.GITHUB_TOKEN }}</p><p>  deploy:
    needs: [request-approval, wait-for-approval]
    if: needs.wait-for-approval.outputs.status == 'approved'
    runs-on: ubuntu-latest
    steps:
      <ul><li>name: Deploy</li>
        </ul>run: |
          echo "Deploying ${{ needs.wait-for-approval.outputs.tag }}"</code></pre></p><p><strong>Note:</strong> Blocking workflows keep the runner active, which consumes GitHub Actions minutes. For cost-sensitive scenarios, use the event-driven approach (separate </code>process-comment<code> workflow).</p><h3>Tag Deletion on Issue Close</h3></p><p>Optionally delete tags when approval issues are manually closed:</p><pre><code class="language-yaml">workflows:
  dev-deploy:
    on_closed:
      delete_tag: true   # Delete tag when issue is closed
      comment: "Cancelled. Tag {{tag}} deleted."</p><p>  production-deploy:
    on_closed:
      delete_tag: false  # NEVER delete production tags</code></pre></p><p><strong>Handle close events:</strong></p><pre><code class="language-yaml"># .github/workflows/handle-close.yml
name: Handle Issue Close</p><p>on:
  issues:
    types: [closed]</p><p>jobs:
  handle:
    if: contains(github.event.issue.labels.*.name, 'approval-required')
    runs-on: ubuntu-latest
    steps:
      <ul><li>uses: actions/checkout@v4</li>
      <li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>id: close
        with:
          action: close-issue
          issue_number: ${{ github.event.issue.number }}
          issue_action: ${{ github.event.action }}
          token: ${{ secrets.GITHUB_TOKEN }}</p><ul><li>name: Report</li>
        </ul>run: |
          echo "Status: ${{ steps.close.outputs.status }}"
          echo "Deleted tag: ${{ steps.close.outputs.tag_deleted }}"</code></pre></p><hr></p><h2>Complete Examples</h2></p><h3>Full-Featured Request Workflow</h3></p><pre><code class="language-yaml">name: Request Production Deployment</p><p>on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to deploy'
        required: true
        type: string
      environment:
        description: 'Target environment'
        required: true
        type: choice
        options: [staging, production]</p><p>permissions:
  contents: write
  issues: write
  deployments: write</p><p>jobs:
  request:
    runs-on: ubuntu-latest
    outputs:
      issue_number: ${{ steps.approval.outputs.issue_number }}
      issue_url: ${{ steps.approval.outputs.issue_url }}
      deployment_id: ${{ steps.approval.outputs.deployment_id }}
      jira_issues: ${{ steps.approval.outputs.jira_issues }}
    steps:
      <ul><li>uses: actions/checkout@v4</li>
        </ul>with:
          fetch-depth: 0  # Needed for commit comparison</p><ul><li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>id: approval
        with:
          action: request
          workflow: ${{ inputs.environment }}-deploy
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}
          # Jira integration
          jira_base_url: https://mycompany.atlassian.net
          jira_user_email: ${{ secrets.JIRA_EMAIL }}
          jira_api_token: ${{ secrets.JIRA_API_TOKEN }}
          # Deployment tracking
          create_deployment: 'true'
          deployment_environment: ${{ inputs.environment }}
          deployment_environment_url: https://${{ inputs.environment }}.myapp.com</p><ul><li>name: Summary</li>
        </ul>run: |
          echo "## Approval Request Created" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- <strong>Issue:</strong> #${{ steps.approval.outputs.issue_number }}" >> $GITHUB_STEP_SUMMARY
          echo "- <strong>URL:</strong> ${{ steps.approval.outputs.issue_url }}" >> $GITHUB_STEP_SUMMARY
          echo "- <strong>Jira Issues:</strong> ${{ steps.approval.outputs.jira_issues }}" >> $GITHUB_STEP_SUMMARY
          echo "- <strong>Commits:</strong> ${{ steps.approval.outputs.commits_count }}" >> $GITHUB_STEP_SUMMARY</code></pre>
<h3>Process Comments with Team Support</h3></p><pre><code class="language-yaml">name: Handle Approval Comments</p><p>on:
  issue_comment:
    types: [created]</p><p>permissions:
  contents: write
  issues: write</p><p>jobs:
  process:
    if: |
      github.event.issue.pull_request == null &&
      contains(github.event.issue.labels.*.name, 'approval-required')
    runs-on: ubuntu-latest
    steps:
      <ul><li>uses: actions/checkout@v4</li></p><p>      </ul># Generate GitHub App token for team membership checks
      <ul><li>uses: actions/create-github-app-token@v2</li>
        </ul>id: app-token
        with:
          app-id: ${{ vars.APP_ID }}
          private-key: ${{ secrets.APP_PRIVATE_KEY }}</p><ul><li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>id: process
        with:
          action: process-comment
          issue_number: ${{ github.event.issue.number }}
          token: ${{ steps.app-token.outputs.token }}
          # Jira integration to update Fix Version on approval
          jira_base_url: https://mycompany.atlassian.net
          jira_user_email: ${{ secrets.JIRA_EMAIL }}
          jira_api_token: ${{ secrets.JIRA_API_TOKEN }}</p><ul><li>name: Trigger Deployment</li>
        </ul>if: steps.process.outputs.status == 'approved'
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'deploy.yml',
              ref: 'main',
              inputs: { version: '${{ steps.process.outputs.tag }}' }
            });</code></pre></p><h3>Multi-Environment Promotion</h3></p><pre><code class="language-yaml"># .github/approvals.yml
version: 1</p><p>policies:
  dev-team:
    approvers: [dev1, dev2, dev3]
    min_approvals: 1</p><p>  qa-team:
    approvers: [qa1, qa2]
    min_approvals: 1</p><p>  prod-team:
    approvers: [team:sre, tech-lead]
    min_approvals: 2</p><p>workflows:
  dev-deploy:
    require:
      <ul><li>policy: dev-team</li>
    </ul>on_approved:
      tagging:
        enabled: true
        auto_increment: patch
        env_prefix: "dev-"
      close_issue: true</p><p>  staging-deploy:
    require:
      <ul><li>policy: qa-team</li>
    </ul>on_approved:
      tagging:
        enabled: true
        auto_increment: minor
        env_prefix: "staging-"
      close_issue: true</p><p>  production-deploy:
    require:
      <ul><li>policy: prod-team</li>
    </ul>on_approved:
      create_tag: true
      close_issue: true
    on_closed:
      delete_tag: false  # Never delete production tags</code></pre></p><h3>Using Outputs in Subsequent Jobs</h3></p><pre><code class="language-yaml">name: Deploy with Approval</p><p>on:
  workflow_dispatch:
    inputs:
      version:
        required: true</p><p>jobs:
  approval:
    runs-on: ubuntu-latest
    outputs:
      status: ${{ steps.check.outputs.status }}
      tag: ${{ steps.check.outputs.tag }}
      approvers: ${{ steps.check.outputs.approvers }}
      jira_issues: ${{ steps.request.outputs.jira_issues }}
    steps:
      <ul><li>uses: actions/checkout@v4</li></p><p>      <li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>id: request
        with:
          action: request
          workflow: production-deploy
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}
          jira_base_url: https://mycompany.atlassian.net</p><ul><li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>id: check
        with:
          action: check
          issue_number: ${{ steps.request.outputs.issue_number }}
          wait: 'true'
          timeout: '2h'
          token: ${{ secrets.GITHUB_TOKEN }}</p><p>  deploy:
    needs: approval
    if: needs.approval.outputs.status == 'approved'
    runs-on: ubuntu-latest
    environment: production
    steps:
      <ul><li>name: Deploy</li>
        </ul>run: |
          echo "Deploying ${{ needs.approval.outputs.tag }}"
          echo "Approved by: ${{ needs.approval.outputs.approvers }}"
          echo "Jira Issues: ${{ needs.approval.outputs.jira_issues }}"</p><p>  notify:
    needs: [approval, deploy]
    if: always()
    runs-on: ubuntu-latest
    steps:
      <ul><li>name: Notify Slack</li>
        </ul>run: |
          if [ "${{ needs.approval.outputs.status }}" == "approved" ]; then
            echo "Deployment of ${{ needs.approval.outputs.tag }} completed!"
          else
            echo "Deployment was ${{ needs.approval.outputs.status }}"
          fi</code></pre></p><hr></p><h2>Schema Validation</h2></p><p>Validate your configuration using the JSON schema:</p><pre><code class="language-yaml"># .github/approvals.yml
<h1>yaml-language-server: $schema=https://raw.githubusercontent.com/jamengual/enterprise-approval-engine/main/schema.json</h1></p><p>version: 1</p><p>policies:
  # ... your config</code></pre>
Or validate in CI:</p><pre><code class="language-yaml">- name: Validate Config
  run: |
    npm install -g ajv-cli
    ajv validate -s schema.json -d .github/approvals.yml</code></pre></p><hr></p><h2>GitHub Enterprise Server</h2></p><p>The action fully supports GitHub Enterprise Server. It automatically detects GHES environments using the </code>GITHUB_SERVER_URL<code> and </code>GITHUB_API_URL` environment variables.</p><p>No additional configuration is required - the action will automatically use the correct API endpoints.</p><p><strong>Rate Limiting:</strong></p><p>The action includes automatic retry with exponential backoff for rate limit errors. Configuration:</p><ul><li>Initial delay: 1 second</li>
<li>Max delay: 60 seconds</li>
<li>Max retries: 5</li>
<li>Jitter: Random 0-500ms added to prevent thundering herd</li></p><p></ul>---</p><h2>License</h2></p><p>MIT License</p><p>
---

Tranlated By <a href="https://github.com/OpenAiTx/OpenAiTx" target="_blank" rel="noopener noreferrer">Open Ai Tx</a> | Last indexed: 2025-12-22

---</p>
        </div>
        
        <div class="original-link">
            <strong>Original README:</strong> <a href="https://raw.githubusercontent.com/jamengual/enterprise-approval-engine/main/README.md" target="_blank" rel="noopener noreferrer">View on GitHub</a>
        </div>
    </div>
    
    <div class="footer">
        <p>Translated by <a href="https://github.com/OpenAiTx/OpenAiTx" target="_blank" rel="noopener noreferrer">OpenAiTx</a> | 
        Last updated: 2025-12-22 
    </div>
    
</body>
</html>