<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>enterprise-approval-engine - グループごとの閾値（N中X）、グループ間のORロジック、および自動semverタグ作成を備えたエンタープライズグレードの承認ワークフロー</title>
    <meta name="description" content="グループごとの閾値（N中X）、グループ間のORロジック、および自動semverタグ作成を備えたエンタープライズグレードの承認ワークフロー">
    <meta name="keywords" content="enterprise-approval-engine, Japanese, documentation, GitHub, open source">
    <meta name="author" content="OpenAiTx">
    <meta name="robots" content="index, follow">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "enterprise-approval-engine",
  "description": "グループごとの閾値（N中X）、グループ間のORロジック、および自動semverタグ作成を備えたエンタープライズグレードの承認ワークフロー",
  "author": {
    "@type": "Person",
    "name": "jamengual"
  },
  "applicationCategory": "DeveloperApplication",
  "operatingSystem": "Any",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "5",
    "ratingCount": 4
  },
  "url": "https://OpenAiTx.github.io/projects/jamengual/enterprise-approval-engine/README-ja.html",
  "sameAs": "https://raw.githubusercontent.com/jamengual/enterprise-approval-engine/main/README.md",
  "datePublished": "2025-12-22",
  "dateModified": "2025-12-22"
}
    </script>
    
    <!-- GitHub-style CSS -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #24292e;
            background-color: #ffffff;
            max-width: 980px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .container {
            background: #ffffff;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 24px;
            margin-bottom: 20px;
        }
        
        .header {
            border-bottom: 1px solid #e1e4e8;
            padding-bottom: 16px;
            margin-bottom: 24px;
        }
        
        .project-title {
            font-size: 2em;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .project-title a {
            color: #24292e;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: color 0.2s ease;
        }
        
        .project-title a:hover {
            color: #0366d6;
            text-decoration: none;
        }
        
        .project-title .github-icon {
            width: 1em;
            height: 1em;
            fill: currentColor;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }
        
        .project-title a:hover .github-icon {
            opacity: 1;
        }
        
        .project-meta {
            color: #586069;
            font-size: 14px;
            margin-bottom: 16px;
        }
        
        .stars {
            display: inline-block;
            margin-right: 16px;
        }
        
        .language {
            display: inline-block;
            background-color: #f1f8ff;
            color: #0366d6;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .content {
            font-size: 16px;
            line-height: 1.6;
        }
        
        h1, h2, h3, h4, h5, h6 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
            color: #24292e;
        }
        
        h1 { font-size: 2em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        h3 { font-size: 1.25em; }
        
        p {
            margin-bottom: 16px;
        }
        
        code {
            background-color: #f6f8fa;
            border-radius: 3px;
            font-size: 85%;
            margin: 0;
            padding: 0.2em 0.4em;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }
        
        pre {
            background-color: #f6f8fa;
            border-radius: 6px;
            font-size: 85%;
            line-height: 1.45;
            overflow: auto;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        pre code {
            background-color: transparent;
            border: 0;
            display: inline;
            line-height: inherit;
            margin: 0;
            overflow: visible;
            padding: 0;
            word-wrap: normal;
        }
        
        a {
            color: #0366d6;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        ul, ol {
            margin-bottom: 16px;
            padding-left: 2em;
        }
        
        li {
            margin-bottom: 0.25em;
        }
        
        blockquote {
            border-left: 4px solid #dfe2e5;
            color: #6a737d;
            margin: 0 0 16px 0;
            padding: 0 1em;
        }
        
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e1e4e8;
            color: #586069;
            font-size: 14px;
            text-align: center;
        }
        
        .footer a {
            color: #0366d6;
        }
        
        .original-link {
            margin-top: 16px;
            padding: 12px;
            background-color: #f6f8fa;
            border-radius: 6px;
            border: 1px solid #e1e4e8;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 16px;
            }
            
            .project-title {
                font-size: 1.5em;
            }
        }
    </style>
    
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <!-- Bing Count -->
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "sh95yd6uwt");
    </script>        

    <!-- Statcounter -->
    <script type="text/javascript">
        var sc_project = 13142514;
        var sc_invisible = 1;
        var sc_security = "d03a31d8"; 
    </script>
    <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script>
    <noscript>
        <div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img
                    class="statcounter" src="https://c.statcounter.com/13142514/0/d03a31d8/1/" alt="Web Analytics"
                    referrerPolicy="no-referrer-when-downgrade"></a></div>
    </noscript>    
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="project-title">
                <a href="https://github.com/jamengual/enterprise-approval-engine" target="_blank" rel="noopener noreferrer">
                    <svg class="github-icon" viewBox="0 0 16 16" aria-hidden="true">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
                    </svg>
                    enterprise-approval-engine
                </a>
            </h1>
            <div class="project-meta">
                <span class="stars">⭐ 4 stars</span>
                <span class="language">Japanese</span>
                <span>by jamengual</span>
            </div>
        </div>
        
        <div class="content">
            <h1>エンタープライズ承認エンジン</h1></p><p><a href="README.md" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/lang-en-blue.svg" alt="en"></a>
<a href="ES/README.md" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/lang-es-yellow.svg" alt="es"></a></p><p>グループごとの閾値（N人中X人）によるポリシーベースの承認ワークフロー、グループ間のORロジック、および自動セマンティックバージョニングタグ作成を備えたエンタープライズ向けGitHubアクション。</p><h2>機能</h2></p><ul><li><strong>柔軟な承認ロジック</strong>：グループ内でのAND（全員承認）および閾値（N人中X人）の両方をサポート</li>
<li><strong>グループ間のORロジック</strong>：複数の承認経路 - いずれかのグループが要件を満たせば承認</li>
<li><strong>混合承認者</strong>：同じグループ内で個人ユーザーとGitHubチームを組み合わせ可能</li>
<li><strong>段階的なデプロイパイプライン</strong>：単一の課題で複数環境（dev → qa → stage → prod）を追跡</li>
<li><strong>パイプラインの可視化</strong>：デプロイ進行状況を示す色分けされたMermaidフローチャート図</li>
<li><strong>サブ課題による承認</strong>：各ステージ専用の承認サブ課題を作成し、承認時にクローズ</li>
<li><strong>強化されたコメントUX</strong>：承認コメントへの絵文字リアクション、コマンド参照付きクイックアクションセクション</li>
<li><strong>課題クローズ保護</strong>：権限のないユーザーによる承認課題のクローズを防止（自動再オープン）</li>
<li><strong>ハイブリッド承認モード</strong>：ワークフローまたはステージごとにコメントベースとサブ課題承認を混在</li>
<li><strong>PRおよびコミット追跡</strong>：デプロイ課題にPRとコミットを自動リストアップしてリリース管理</li>
<li><strong>セマンティックバージョンタグ作成</strong>：承認時に自動でgitタグを作成</li>
<li><strong>ポリシーベース設定</strong>：YAMLで再利用可能な承認ポリシーを定義</li>
<li><strong>課題ベースのワークフロー</strong>：GitHub課題を通じた透明な監査証跡</li>
<li><strong>Jira統合</strong>：コミットから課題キーを抽出し承認課題に表示、Fix Versionsを更新</li>
<li><strong>デプロイ追跡</strong>：デプロイダッシュボードで可視化するためGitHubデプロイメントを作成</li>
<li><strong>外部設定</strong>：承認ポリシーを共有リポジトリで集中管理</li>
<li><strong>レート制限処理</strong>：GitHub APIのレート制限に対し指数的バックオフで自動リトライ</li>
<li><strong>GitHub Enterprise Server対応</strong>：GHES環境を完全サポート</li>
<li><strong>外部依存なし</strong>：純粋なGitHub Actionsで外部サービス不要</li></p><p></ul>📋 <strong>動作例はこちら：</strong> <a href="https://github.com/jamengual/enterprise-approval-engine/issues/7" target="_blank" rel="noopener noreferrer">承認課題の例</a></p><h2>目次</h2></p><ul><li><a href="#quick-start" target="_blank" rel="noopener noreferrer">クイックスタート</a></li>
<li><a href="#action-reference" target="_blank" rel="noopener noreferrer">アクションリファレンス</a></li>
  <li><a href="#actions" target="_blank" rel="noopener noreferrer">アクション</a></li>
  <li><a href="#inputs" target="_blank" rel="noopener noreferrer">入力</a></li>
  <li><a href="#outputs" target="_blank" rel="noopener noreferrer">出力</a></li>
<li><a href="#configuration-reference" target="_blank" rel="noopener noreferrer">設定リファレンス</a></li>
  <li><a href="#policies" target="_blank" rel="noopener noreferrer">ポリシー</a></li>
  <li><a href="#workflows" target="_blank" rel="noopener noreferrer">ワークフロー</a></li>
  <li><a href="#tagging-configuration" target="_blank" rel="noopener noreferrer">タグ付け</a></li>
  <li><a href="#custom-issue-templates" target="_blank" rel="noopener noreferrer">カスタムテンプレート</a></li>
  <li><a href="#defaults" target="_blank" rel="noopener noreferrer">デフォルト</a></li>
  <li><a href="#semver" target="_blank" rel="noopener noreferrer">セマンティックバージョニング</a></li>
<li><a href="#complete-configuration-reference" target="_blank" rel="noopener noreferrer">完全な設定リファレンス</a></li>
<li><a href="#feature-details" target="_blank" rel="noopener noreferrer">機能の詳細</a></li>
  <li><a href="#approval-keywords" target="_blank" rel="noopener noreferrer">承認キーワード</a></li>
  <li><a href="#team-support" target="_blank" rel="noopener noreferrer">チームサポート</a></li>
  <li><a href="#progressive-deployment-pipelines" target="_blank" rel="noopener noreferrer">段階的デプロイパイプライン</a></li>
  <li><a href="#release-candidate-strategies" target="_blank" rel="noopener noreferrer">リリース候補戦略</a></li>
  <li><a href="#jira-integration" target="_blank" rel="noopener noreferrer">Jira統合</a></li>
  <li><a href="#deployment-tracking" target="_blank" rel="noopener noreferrer">デプロイ追跡</a></li>
  <li><a href="#external-config-repository" target="_blank" rel="noopener noreferrer">外部設定リポジトリ</a></li>
  <li><a href="#blocking-approvals" target="_blank" rel="noopener noreferrer">承認のブロック</a></li>
  <li><a href="#tag-deletion-on-issue-close" target="_blank" rel="noopener noreferrer">タグ削除</a></li>
<li><a href="#complete-examples" target="_blank" rel="noopener noreferrer">完全な例</a></li>
<li><a href="#schema-validation" target="_blank" rel="noopener noreferrer">スキーマ検証</a></li>
<li><a href="#github-enterprise-server" target="_blank" rel="noopener noreferrer">GitHub Enterprise Server</a></li></p><p></ul><h2>クイックスタート</h2></p><h3>1. 設定の作成</h3></p><p>リポジトリ内に <code>.github/approvals.yml</code> を作成してください:</p><pre><code class="language-yaml">version: 1</p><p>policies:
  dev-team:
    approvers: [alice, bob, charlie]
    min_approvals: 2</p><p>  platform-team:
    approvers: [team:platform-engineers]
    require_all: true</p><p>workflows:
  production-deploy:
    require:
      # OR logic: either path satisfies approval
      <ul><li>policy: dev-team        # 2 of 3 developers</li>
      <li>policy: platform-team   # ALL platform engineers</li>
    </ul>on_approved:
      create_tag: true
      close_issue: true</code></pre></p><h3>2. リクエスト承認ワークフロー</h3></p><p><code>.github/workflows/request-approval.yml</code> を作成します：</p><pre><code class="language-yaml">name: Request Deployment Approval</p><p>on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to deploy (e.g., v1.2.3)'
        required: true
        type: string</p><p>jobs:
  request:
    runs-on: ubuntu-latest
    steps:
      <ul><li>uses: actions/checkout@v4</li>
      <li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>id: approval
        with:
          action: request
          workflow: production-deploy
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}</p><ul><li>name: Output Results</li>
        </ul>run: |
          echo "Issue: ${{ steps.approval.outputs.issue_url }}"
          echo "Status: ${{ steps.approval.outputs.status }}"</code></pre></p><h3>3. 承認コメントの処理</h3></p><p><code>.github/workflows/handle-approval.yml</code> を作成します:</p><pre><code class="language-yaml">name: Handle Approval Comments</p><p>on:
  issue_comment:
    types: [created]</p><p>jobs:
  process:
    if: contains(github.event.issue.labels.*.name, 'approval-required')
    runs-on: ubuntu-latest
    steps:
      <ul><li>uses: actions/checkout@v4</li>
      <li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>id: process
        with:
          action: process-comment
          issue_number: ${{ github.event.issue.number }}
          token: ${{ secrets.GITHUB_TOKEN }}</p><ul><li>name: Trigger Deployment</li>
        </ul>if: steps.process.outputs.status == 'approved'
        run: |
          echo "Approved by: ${{ steps.process.outputs.approvers }}"
          echo "Tag created: ${{ steps.process.outputs.tag }}"</code></pre></p><hr></p><h2>アクションリファレンス</h2></p><h3>アクション</h3></p><p>このアクションは、<code>action</code> 入力を通じて4つの動作モードをサポートします：</p><p>| アクション | 説明 | 使用タイミング |
|--------|-------------|-------------|
| <code>request</code> | 新しい承認リクエストのイシューを作成する | デプロイ／リリースワークフロー開始時 |
| <code>process-comment</code> | 承認・拒否コメントを処理する | <code>issue_comment</code> イベント時 |
| <code>check</code> | 現在の承認状態をチェックする | 承認完了をポーリングするため |
| <code>close-issue</code> | イシューのクローズイベントを処理する | <code>issues: [closed]</code> イベント時 |</p><h3>入力</h3></p><p>#### コア入力</p><p>| 入力 | 説明 | 必須 | デフォルト |
|-------|-------------|----------|---------|
| <code>action</code> | 実行するアクション：<code>request</code>, <code>check</code>, <code>process-comment</code>, <code>close-issue</code> | はい | - |
| <code>workflow</code> | 設定からのワークフロー名（<code>request</code> アクション用） | <code>request</code> の場合 | - |
| <code>version</code> | タグ作成用のセマンティックバージョン（例：<code>1.2.3</code> または <code>v1.2.3</code>） | いいえ | - |
| <code>issue_number</code> | イシュー番号（<code>check</code>, <code>process-comment</code>, <code>close-issue</code> 用） | check/process/close の場合 | - |
| <code>token</code> | API操作用GitHubトークン | はい | - |</p><p>#### 設定入力</p><p>| 入力 | 説明 | 必須 | デフォルト |
|-------|-------------|----------|---------|
| <code>config_path</code> | approvals.yml設定ファイルのパス | いいえ | <code>.github/approvals.yml</code> |
| <code>config_repo</code> | 共有設定用の外部リポジトリ（例：<code>org/.github</code>） | いいえ | - |</p><p>#### ポーリング入力（<code>check</code>アクション用）</p><p>| 入力 | 説明 | 必須 | デフォルト |
|-------|-------------|----------|---------|
| <code>wait</code> | すぐに戻らず承認完了まで待つ（ポーリング） | いいえ | <code>false</code> |
| <code>timeout</code> | 待機タイムアウト（例：<code>24h</code>、<code>1h30m</code>、<code>30m</code>） | いいえ | <code>72h</code> |</p><p>#### チームサポート入力</p><p>| 入力 | 説明 | 必須 | デフォルト |
|-------|-------------|----------|---------|
| <code>app_id</code> | チームメンバーシップチェック用のGitHubアプリID | いいえ | - |
| <code>app_private_key</code> | チームメンバーシップチェック用のGitHubアプリ秘密鍵 | いいえ | - |</p><p>#### Jira統合入力</p><p>| 入力 | 説明 | 必須 | デフォルト |
|-------|-------------|----------|---------|
| <code>jira_base_url</code> | Jira CloudのベースURL（例：<code>https://yourcompany.atlassian.net</code>） | いいえ | - |
| <code>jira_user_email</code> | API認証用のJiraユーザーのメールアドレス | いいえ | - |
| <code>jira_api_token</code> | 認証用のJira APIトークン | いいえ | - |
| <code>jira_update_fix_version</code> | 承認時にFix VersionでJira課題を更新するか | いいえ | <code>true</code> |
| <code>include_jira_issues</code> | 承認リクエスト本文にJira課題を含めるか | いいえ | <code>true</code> |</p><p>#### デプロイトラッキング入力</p><p>| 入力 | 説明 | 必須 | デフォルト |
|-------|-------------|----------|---------|
| <code>create_deployment</code> | トラッキング用にGitHubデプロイメントを作成するか | いいえ | <code>true</code> |
| <code>deployment_environment</code> | 対象環境（例：<code>production</code>、<code>staging</code>） | いいえ | <code>production</code> |
| <code>deployment_environment_url</code> | デプロイ済み環境のURL | いいえ | - |</p><p>#### その他の入力</p><p>| 入力 | 説明 | 必須 | デフォルト |
|-------|-------------|----------|---------|
| <code>issue_action</code> | <code>close-issue</code>用のIssueイベントアクション（<code>closed</code>、<code>reopened</code>） | いいえ | - |
| <code>previous_tag</code> | コミット比較対象の前のタグ（指定がない場合は自動検出） | いいえ | - |</p><h3>出力</h3></p><p>#### コア出力</p><p>| 出力 | 説明 | 利用可能対象 |
|--------|-------------|---------------|
| <code>status</code> | 承認ステータス：<code>pending</code>、<code>approved</code>、<code>denied</code>、<code>timeout</code>、<code>tag_deleted</code>、<code>skipped</code> | すべてのアクション |
| <code>issue_number</code> | 作成またはチェックされた課題番号 | すべてのアクション |
| <code>issue_url</code> | 承認課題のURL | すべてのアクション |</p><p>#### 承認アウトプット</p><p>| 出力 | 説明 | 利用可能なアクション |
|--------|-------------|---------------|
| <code>approvers</code> | 承認したユーザーのカンマ区切りリスト | <code>process-comment</code>、<code>check</code> |
| <code>denier</code> | リクエストを拒否したユーザー | <code>process-comment</code>、<code>check</code> |
| <code>satisfied_group</code> | 承認条件を満たしたグループ名 | <code>process-comment</code>、<code>check</code> |
| <code>tag</code> | 作成されたタグ名 | <code>process-comment</code>（承認時） |
| <code>tag_deleted</code> | 削除されたタグ | <code>close-issue</code> |</p><p>#### Jira アウトプット</p><p>| 出力 | 説明 | 利用可能なアクション |
|--------|-------------|---------------|
| <code>jira_issues</code> | 本リリースに含まれるJira課題キーのカンマ区切りリスト | <code>request</code> |
| <code>jira_issues_json</code> | Jira課題の詳細（キー、概要、タイプ、ステータス）を含むJSON配列 | <code>request</code> |</p><p>#### デプロイメントアウトプット</p><p>| 出力 | 説明 | 利用可能なアクション |
|--------|-------------|---------------|
| <code>deployment_id</code> | ステータス更新用のGitHubデプロイメントID | <code>request</code> |
| <code>deployment_url</code> | GitHub上のデプロイメントURL | <code>request</code> |</p><p>#### リリースノートアウトプット</p><p>| 出力 | 説明 | 利用可能なアクション |
|--------|-------------|---------------|
| <code>release_notes</code> | コミットとJira課題から自動生成されたリリースノート | <code>request</code> |
| <code>commits_count</code> | 本リリースのコミット数 | <code>request</code> |</p><hr></p><h2>設定リファレンス</h2></p><h3>ポリシー</h3></p><p>ポリシーは再利用可能な承認者グループを定義します。フォーマットは2つあります：</p><p>#### シンプルフォーマット</p><pre><code class="language-yaml">policies:
  # Threshold-based: X of N must approve
  dev-team:
    approvers: [alice, bob, charlie]
    min_approvals: 2</p><p>  # All must approve (AND logic)
  security:
    approvers: [team:security, security-lead]
    require_all: true</p><p>  # Mixed teams and individuals
  production:
    approvers:
      <ul><li>team:sre</li>
      <li>tech-lead</li>
      <li>product-owner</li>
    </ul>min_approvals: 2</code></pre></p><p>#### 高度なフォーマット（ソースごとのしきい値）</p><p>「プラットフォームから2つかつセキュリティから1つ」のような複雑な要件の場合：</p><pre><code class="language-yaml">policies:
  # Complex AND gate
  production-gate:
    from:
      <ul><li>team: platform-engineers</li>
        </ul>min_approvals: 2        # 2 of the platform team
      <ul><li>team: security</li>
        </ul>min_approvals: 1        # 1 of the security team
      <ul><li>user: alice             # alice must also approve</li>
    </ul>logic: and                  # ALL sources must be satisfied</p><p>  # Flexible OR gate
  flexible-review:
    from:
      <ul><li>team: security</li>
        </ul>require_all: true       # All security team
      <ul><li>team: platform</li>
        </ul>min_approvals: 2        # OR 2 platform members
    logic: or                   # ANY source is enough</p><p>  # Executive approval: any one exec
  exec-approval:
    from:
      <ul><li>user: ceo</li>
      <li>user: cto</li>
      <li>user: vp-engineering</li>
    </ul>logic: or</p><p>  # User list with threshold
  leads:
    from:
      <ul><li>users: [tech-lead, product-lead, design-lead]</li>
        </ul>min_approvals: 2</code></pre></p><p><strong>ソースタイプ：</strong></p><ul><li><code>team: slug</code> - GitHubチーム（Appトークンが必要）</li>
<li><code>user: username</code> - 単一ユーザー（暗黙的にrequire_all）</li>
<li><code>users: [a, b, c]</code> - ユーザーのリスト</li></p><p></ul><strong>ポリシーレベルのロジック：</strong></p><ul><li><code>logic: and</code> - すべてのソースを満たす必要がある（デフォルト）</li>
<li><code>logic: or</code> - いずれかのソースを満たせば十分</li></p><p></ul>#### インラインロジック（AND/ORの混合）</p><p>複雑な式の場合、各ソースに<code>logic:</code>を使用して次のソースとの接続方法を指定：</p><pre><code class="language-yaml">policies:
  # (2 security AND 2 platform) OR alice
  complex-gate:
    from:
      <ul><li>team: security</li>
        </ul>min_approvals: 2
        logic: and              # AND with next source
      <ul><li>team: platform</li>
        </ul>min_approvals: 2
        logic: or               # OR with next source
      <ul><li>user: alice            # alice alone can satisfy</li></p><p>  </ul># (security AND platform) OR (alice AND bob) OR manager
  multi-path:
    from:
      <ul><li>team: security</li>
        </ul>min_approvals: 1
        logic: and
      <ul><li>team: platform</li>
        </ul>min_approvals: 1
        logic: or               # End first AND group
      <ul><li>user: alice</li>
        </ul>logic: and
      <ul><li>user: bob</li>
        </ul>logic: or               # End second AND group
      <ul><li>user: manager          # Third path</code></pre></li></p><p></ul><strong>演算子の優先順位:</strong> AND は OR よりも結合力が強い（標準的なブール論理）。</p><p>式 <code>A and B or C and D</code> は <code>(A AND B) OR (C AND D)</code> と評価されます。</p><h3>ワークフロー</h3></p><p>ワークフローは承認要件とアクションを定義します：</p><pre><code class="language-yaml">workflows:
  my-workflow:
    description: "Optional description"</p><p>    # Trigger conditions (for filtering)
    trigger:
      environment: production</p><p>    # Approval requirements (OR logic between items)
    require:
      <ul><li>policy: dev-team</li>
      <li>policy: security</li>
      </ul># Or inline approvers:
      <ul><li>approvers: [alice, bob]</li>
        </ul>require_all: true</p><p>    # Issue configuration
    issue:
      title: "Approval: {{version}}"
      body: |                          # Inline custom template (optional)
        ## My Custom Approval Issue
        Version: {{.Version}}
        Requested by: @{{.Requestor}}
        {{.GroupsTable}}
      body_file: "templates/my-template.md"  # Or load from file
      labels: [production, deploy]
      assignees_from_policy: true</p><p>    # Actions on approval
    on_approved:
      create_tag: true
      tag_prefix: "v"  # Creates v1.2.3
      close_issue: true
      comment: "Approved! Tag {{version}} created."</p><p>    # Actions on denial
    on_denied:
      close_issue: true
      comment: "Denied by {{denier}}."</p><p>    # Actions when issue is manually closed
    on_closed:
      delete_tag: true   # Delete the tag if issue is closed
      comment: "Deployment cancelled. Tag {{tag}} deleted."</code></pre></p><h3>タギング設定</h3></p><p>ワークフローごとにタグの作成方法を制御します:</p><pre><code class="language-yaml">workflows:
  dev-deploy:
    require:
      <ul><li>policy: dev-team</li>
    </ul>on_approved:
      tagging:
        enabled: true
        start_version: "0.1.0"      # No 'v' prefix, start at 0.1.0
        auto_increment: patch        # Auto-bump: 0.1.0 -> 0.1.1 -> 0.1.2
        env_prefix: "dev-"           # Creates: dev-0.1.0, dev-0.1.1</p><p>  staging-deploy:
    require:
      <ul><li>policy: qa-team</li>
    </ul>on_approved:
      tagging:
        enabled: true
        start_version: "v1.0.0"     # 'v' prefix (inferred from start_version)
        auto_increment: minor        # v1.0.0 -> v1.1.0 -> v1.2.0
        env_prefix: "staging-"       # Creates: staging-v1.0.0</p><p>  production-deploy:
    require:
      <ul><li>policy: prod-team</li>
    </ul>on_approved:
      tagging:
        enabled: true
        start_version: "v1.0.0"     # Manual version required (no auto_increment)</code></pre>
<strong>タグ付けオプション:</strong></p><p>| オプション | 説明 |
|--------|-------------|
| <code>enabled</code> | タグ作成を有効にする |
| <code>start_version</code> | 開始バージョンと形式（例："v1.0.0" または "1.0.0"） |
| <code>prefix</code> | バージョン接頭辞（未設定の場合は <code>start_version</code> から推測） |
| <code>auto_increment</code> | 自動インクリメント：<code>major</code>、<code>minor</code>、<code>patch</code>、または手動の場合は省略 |
| <code>env_prefix</code> | 環境接頭辞（例："dev-" は "dev-v1.0.0" を作成） |</p><h3>カスタム課題テンプレート</h3></p><p>Goテンプレートを使用して課題本文を完全にカスタマイズできます。インラインテンプレートには <code>body</code>、ファイルから読み込む場合は <code>body_file</code> を使用します。</p><p><strong>利用可能なテンプレート変数:</strong></p><p>| 変数 | 説明 |
|----------|-------------|
| <code>{{.Title}}</code> | 課題タイトル |
| <code>{{.Description}}</code> | ワークフローディスクリプション |
| <code>{{.Version}}</code> | セマンティックバージョン |
| <code>{{.Requestor}}</code> | リクエストしたGitHubユーザー名 |
| <code>{{.Environment}}</code> | 環境名 |
| <code>{{.RunURL}}</code> | ワークフロー実行へのリンク |
| <code>{{.RepoURL}}</code> | リポジトリURL |
| <code>{{.CommitSHA}}</code> | 完全なコミットSHA |
| <code>{{.CommitURL}}</code> | コミットへのリンク |
| <code>{{.Branch}}</code> | ブランチ名 |
| <code>{{.GroupsTable}}</code> | 事前レンダリング済み承認状態テーブル |
| <code>{{.Timestamp}}</code> | リクエストタイムスタンプ |
| <code>{{.PreviousVersion}}</code> | 以前のバージョン／タグ |
| <code>{{.CommitsCount}}</code> | このリリースのコミット数 |
| <code>{{.HasJiraIssues}}</code> | ブール値 - Jira課題の有無 |
| <code>{{.JiraIssues}}</code> | Jira課題データの配列 |
| <code>{{.JiraIssuesTable}}</code> | 事前レンダリング済みJira課題テーブル |
| <code>{{.PipelineTable}}</code> | 事前レンダリング済みデプロイパイプラインテーブル |
| <code>{{.PipelineMermaid}}</code> | 事前レンダリング済みMermaidフローチャート図 |
| <code>{{.Vars.key}}</code> | カスタム変数 |</p><p>
<strong>テンプレート関数:</strong></p><p>| 関数 | 例 | 説明 |
|----------|---------|-------------|
| <code>slice</code> | <code>{{slice .CommitSHA 0 7}}</code> | サブストリング（短縮SHA） |
| <code>title</code> | <code>{{.Environment \| title}}</code> | タイトルケース |
| <code>upper</code> | <code>{{.Version \| upper}}</code> | 大文字変換 |
| <code>lower</code> | <code>{{.Version \| lower}}</code> | 小文字変換 |
| <code>join</code> | <code>{{join .Groups ","}}</code> | 配列を結合 |
| <code>contains</code> | <code>{{if contains .Branch "feature"}}</code> | 部分文字列の確認 |
| <code>replace</code> | <code>{{replace .Version "v" ""}}</code> | 文字列の置換 |
| <code>default</code> | <code>{{default "N/A" .Environment}}</code> | デフォルト値 |</p><p><strong>カスタムテンプレートファイルの例</strong> (<code>.github/templates/deploy.md</code>):</p><pre><code class="language-markdown">## {{.Title}}</p><h3>Release Information</h3></p><ul><li><strong>Version:</strong> <code>{{.Version}}</code></li>
<li><strong>Requested by:</strong> @{{.Requestor}}</li>
</ul>{{- if .CommitSHA}}
<ul><li><strong>Commit:</strong> <a href="https://raw.githubusercontent.com/jamengual/enterprise-approval-engine/main/{{.CommitURL}}" target="_blank" rel="noopener noreferrer">{{slice .CommitSHA 0 7}}</a></li>
</ul>{{- end}}
{{- if .CommitsCount}}
<ul><li><strong>Changes:</strong> {{.CommitsCount}} commits since {{.PreviousVersion}}</li>
</ul>{{- end}}</p><p>{{if .HasJiraIssues}}
<h3>Jira Issues</h3></p><p>{{.JiraIssuesTable}}
{{end}}</p><h3>Approval Status</h3></p><p>{{.GroupsTable}}</p><hr></p><p><strong>Approve:</strong> Comment <code>approve</code> | <strong>Deny:</strong> Comment <code>deny</code></code></pre></p><h3>デフォルト</h3></p><p>すべてのワークフローに適用されるグローバルデフォルト：</p><pre><code class="language-yaml">defaults:
  timeout: 72h                    # Default approval timeout
  allow_self_approval: false      # Whether requestors can approve their own requests
  issue_labels:                   # Labels added to all approval issues
    <ul><li>approval-required</code></pre></li></p><p></ul><h3>セムバー</h3></p><p>バージョン管理の設定:</p><pre><code class="language-yaml">semver:
  prefix: "v"              # Tag prefix (v1.2.3)
  strategy: input          # Use version from input
  validate: true           # Validate semver format
  allow_prerelease: true   # Allow prerelease versions (e.g., v1.0.0-beta.1)
  auto:                    # Label-based auto-increment (when strategy: auto)
    major_labels: [breaking, major]
    minor_labels: [feature, minor]
    patch_labels: [fix, patch, bug]</code></pre></p><hr></p><h2>完全な設定リファレンス</h2></p><p>このセクションでは、<code>approvals.yml</code>で利用可能な<strong>すべての設定オプション</strong>を文書化します。</p><h3>トップレベルの構造</h3></p><pre><code class="language-yaml">version: 1                    # Required: config version (always 1)
defaults: { ... }             # Optional: global defaults
policies: { ... }             # Required: reusable approval policies
workflows: { ... }            # Required: approval workflows
semver: { ... }               # Optional: version handling settings</code></pre>
<h3><code>defaults</code> オプション</h3></p><p>| Key | Type | Default | 説明 |
|-----|------|---------|-------------|
| <code>timeout</code> | duration | <code>72h</code> | <code>wait: true</code> のブロッキング <code>check</code> アクションのタイムアウト。時間単位を使用（例: 1週間は <code>168h</code>）。イベント駆動型ワークフローでは不要。 |
| <code>allow_self_approval</code> | bool | <code>false</code> | リクエスターが自身のリクエストを承認できるかどうか |
| <code>issue_labels</code> | string[] | <code>[]</code> | すべての承認イシューに追加されるラベル |</p><h3><code>policies.<name></code> オプション（シンプル形式）</h3></p><p>| Key | Type | Default | 説明 |
|-----|------|---------|-------------|
| <code>approvers</code> | string[] | - | ユーザー名または <code>team:slug</code> 参照のリスト |
| <code>min_approvals</code> | int | 0 | 必要な承認数（0 = <code>require_all</code> を使用） |
| <code>require_all</code> | bool | <code>false</code> | true の場合、すべての承認者が承認する必要がある |</p><h3><code>policies.<name></code> オプション（高度な形式）</h3></p><p>| Key | Type | Default | 説明 |
|-----|------|---------|-------------|
| <code>from</code> | source[] | - | 個別の閾値を持つ承認者ソースのリスト |
| <code>logic</code> | string | <code>"and"</code> | ソースを結合する方法: <code>"and"</code> または <code>"or"</code> |</p><p><strong>承認者ソースオプション（<code>from[]</code>）:</strong></p><p>| Key | Type | Default | 説明 |
|-----|------|---------|-------------|
| <code>team</code> | string | - | チームスラッグ（例: <code>"platform"</code> または <code>"org/platform"</code>） |
| <code>user</code> | string | - | 単一のユーザー名 |
| <code>users</code> | string[] | - | ユーザー名のリスト |
| <code>min_approvals</code> | int | 1 | このソースから必要な承認数 |
| <code>require_all</code> | bool | <code>false</code> | このソースの全員が承認する必要がある |
| <code>logic</code> | string | - | 次のソースへの論理: <code>"and"</code> または <code>"or"</code> |</p><h3><code>workflows.<name></code> オプション</h3></p><p>| Key | Type | Default | 説明 |
|-----|------|---------|-------------|
| <code>description</code> | string | - | 人間が読める説明 |</p><p>| <code>trigger</code> | map | - | トリガー条件（フィルタリング用） |
| <code>require</code> | requirement[] | - | <strong>必須:</strong> 承認要件（アイテム間はORロジック） |
| <code>issue</code> | object | - | イシュー作成設定 |
| <code>on_approved</code> | object | - | 承認時のアクション |
| <code>on_denied</code> | object | - | 否認時のアクション |
| <code>on_closed</code> | object | - | イシューが手動でクローズされた時のアクション |
| <code>pipeline</code> | object | - | 段階的デプロイパイプライン設定 |</p><h3><code>workflows.<name>.require[]</code> オプション</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>policy</code> | string | - | 定義済みポリシーの参照 |
| <code>approvers</code> | string[] | - | インライン承認者（ポリシーの代替） |
| <code>min_approvals</code> | int | - | ポリシーのmin_approvalsを上書き |
| <code>require_all</code> | bool | - | ポリシーのrequire_allを上書き |</p><h3><code>workflows.<name>.issue</code> オプション</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>title</code> | string | <code>"Approval Required: {workflow}"</code> | イシュータイトル（<code>{{version}}</code>、<code>{{environment}}</code>、<code>{{workflow}}</code>対応） |
| <code>body</code> | string | - | カスタムイシューボディテンプレート（Goテンプレート構文） |
| <code>body_file</code> | string | - | テンプレートファイルパス（<code>.github/</code>からの相対パス） |
| <code>labels</code> | string[] | <code>[]</code> | このワークフロー用の追加ラベル |
| <code>assignees_from_policy</code> | bool | <code>false</code> | ポリシーから個別ユーザーを自動アサイン（最大10人） |</p><h3><code>workflows.<name>.on_approved</code> オプション</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>create_tag</code> | bool | <code>false</code> | gitタグを作成（入力バージョンを使用） |
| <code>close_issue</code> | bool | <code>false</code> | 承認後にイシューをクローズ |
| <code>comment</code> | string | - | 投稿するコメント（<code>{{version}}</code>、<code>{{satisfied_group}}</code>対応） |
| <code>tagging</code> | object | - | 詳細なタグ付け設定 |</p><h3><code>workflows.<name>.on_approved.tagging</code> オプション</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>enabled</code> | bool | <code>false</code> | タグ作成を有効にする |
| <code>start_version</code> | string | <code>"0.0.0"</code> | 初期バージョン（例：<code>"v1.0.0"</code> または <code>"1.0.0"</code>） |
| <code>prefix</code> | string | (推測) | バージョン接頭辞（<code>start_version</code>から推測） |
| <code>auto_increment</code> | string | - | 自動インクリメント：<code>"major"</code>、<code>"minor"</code>、<code>"patch"</code>、または手動の場合は省略 |
| <code>env_prefix</code> | string | - | 環境接頭辞（例：<code>"dev-"</code> で <code>"dev-v1.0.0"</code> を作成） |</p><h3><code>workflows.<name>.on_denied</code> オプション</h3></p><p>| Key | Type | Default | 説明 |
|-----|------|---------|-------------|
| <code>close_issue</code> | bool | <code>false</code> | 拒否後にIssueをクローズする |
| <code>comment</code> | string | - | 投稿するコメント（<code>{{denier}}</code>をサポート） |</p><h3><code>workflows.<name>.on_closed</code> オプション</h3></p><p>| Key | Type | Default | 説明 |
|-----|------|---------|-------------|
| <code>delete_tag</code> | bool | <code>false</code> | Issueクローズ時に関連タグを削除する |
| <code>comment</code> | string | - | 投稿するコメント（<code>{{tag}}</code>、<code>{{version}}</code>をサポート） |</p><h3><code>workflows.<name>.pipeline</code> オプション</h3></p><p>| Key | Type | Default | 説明 |
|-----|------|---------|-------------|
| <code>stages</code> | stage[] | - | <strong>必須:</strong> デプロイステージの順序付きリスト |
| <code>track_prs</code> | bool | <code>false</code> | Issue本文にマージされたPRを含める |
| <code>track_commits</code> | bool | <code>false</code> | Issue本文にコミットを含める |
| <code>compare_from_tag</code> | string | - | 比較開始タグパターン（例：<code>"v*"</code>） |
| <code>show_mermaid_diagram</code> | bool | <code>true</code> | パイプラインステージのMermaidフローチャートを表示 |
| <code>release_strategy</code> | object | - | リリース候補選択戦略 |</p><h3><code>workflows.<name>.pipeline.stages[]</code> オプション</h3></p><p>| Key | Type | Default | 説明 |
|-----|------|---------|-------------|
| <code>name</code> | string | - | <strong>必須:</strong> ステージ名（例：<code>"dev"</code>、<code>"prod"</code>） |
| <code>environment</code> | string | - | GitHub環境名 |
| <code>policy</code> | string | - | このステージの承認ポリシー |
| <code>approvers</code> | string[] | - | インライン承認者（ポリシーの代替） |
| <code>on_approved</code> | string | - | ステージ承認時に投稿するコメント |
| <code>create_tag</code> | bool | <code>false</code> | このステージでgitタグを作成する |
| <code>is_final</code> | bool | <code>false</code> | このステージの後にイシューをクローズする |
| <code>auto_approve</code> | bool | <code>false</code> | 人間の介入なしに自動承認する |</p><h3><code>workflows.<name>.pipeline.release_strategy</code> オプション</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>type</code> | string | <code>"tag"</code> | 戦略: <code>"tag"</code>, <code>"branch"</code>, <code>"label"</code>, <code>"milestone"</code> |
| <code>branch</code> | object | - | ブランチ戦略の設定 |
| <code>label</code> | object | - | ラベル戦略の設定 |
| <code>milestone</code> | object | - | マイルストーン戦略の設定 |
| <code>auto_create</code> | object | - | 次のリリース成果物を自動作成 |</p><h3><code>release_strategy.branch</code> オプション</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>pattern</code> | string | <code>"release/{{version}}"</code> | ブランチ命名パターン |
| <code>base_branch</code> | string | <code>"main"</code> | 比較対象のブランチ |
| <code>delete_after_release</code> | bool | <code>false</code> | 本番デプロイ後にブランチを削除 |</p><h3><code>release_strategy.label</code> オプション</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>pattern</code> | string | <code>"release:{{version}}"</code> | ラベル命名パターン |
| <code>pending_label</code> | string | - | リリース割り当て待ちのPR用ラベル |
| <code>remove_after_release</code> | bool | <code>false</code> | 本番デプロイ後にラベルを削除 |</p><h3><code>release_strategy.milestone</code> オプション</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>pattern</code> | string | <code>"v{{version}}"</code> | マイルストーン命名パターン |
| <code>close_after_release</code> | bool | <code>false</code> | 本番デプロイ後にマイルストーンをクローズ |</p><h3><code>release_strategy.auto_create</code> オプション</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>enabled</code> | bool | <code>false</code> | 最終ステージ完了時に自動作成を有効化 |
| <code>next_version</code> | string | <code>"patch"</code> | バージョン増分: <code>"patch"</code>、<code>"minor"</code>、<code>"major"</code> |
| <code>create_issue</code> | bool | <code>false</code> | 次のリリース用の新規承認イシューを作成 |
| <code>comment</code> | string | - | 次のリリースについて投稿するコメント |</p><h3><code>semver</code> オプション</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>prefix</code> | string | <code>"v"</code> | タグのプレフィックス |
| <code>strategy</code> | string | <code>"input"</code> | バージョン戦略: <code>"input"</code>、<code>"auto"</code> |
| <code>validate</code> | bool | <code>false</code> | semver形式を検証 |
| <code>allow_prerelease</code> | bool | <code>false</code> | プレリリースバージョンを許可（例: <code>v1.0.0-beta.1</code>） |
| <code>auto</code> | object | - | ラベルベースの自動インクリメント設定 |</p><h3><code>semver.auto</code> オプション</h3></p><p>| Key | Type | Default | Description |
|-----|------|---------|-------------|
| <code>major_labels</code> | string[] | <code>[]</code> | メジャーバンプをトリガーするPRラベル |
| <code>minor_labels</code> | string[] | <code>[]</code> | マイナーバンプをトリガーするPRラベル |
| <code>patch_labels</code> | string[] | <code>[]</code> | パッチバンプをトリガーするPRラベル |</p><hr></p><h2>機能詳細</h2></p><h3>承認キーワード</h3></p><p>ユーザーはイシューにコメントすることでリクエストを承認または拒否できます:</p><p><strong>承認キーワード:</strong> <code>approve</code>、<code>approved</code>、<code>lgtm</code>、<code>yes</code>、<code>/approve</code></p><p><strong>拒否キーワード:</strong> <code>deny</code>、<code>denied</code>、<code>reject</code>、<code>rejected</code>、<code>no</code>、<code>/deny</code></p><h3>チームサポート</h3></p><p>GitHubのチームベースの承認者を使用するには、昇格された権限が必要です。標準の<code>GITHUB_TOKEN</code>ではチームメンバーの一覧を取得できません。GitHub Appトークンを使用してください:</p><pre><code class="language-yaml">jobs:
  process:
    runs-on: ubuntu-latest
    steps:
      <ul><li>uses: actions/checkout@v4</li></p><p>      </ul># Generate GitHub App token
      <ul><li>uses: actions/create-github-app-token@v2</li>
        </ul>id: app-token
        with:
          app-id: ${{ vars.APP_ID }}
          private-key: ${{ secrets.APP_PRIVATE_KEY }}</p><p>      # Use the app token for team membership checks
      <ul><li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>with:
          action: process-comment
          issue_number: ${{ github.event.issue.number }}
          token: ${{ steps.app-token.outputs.token }}</code></pre></p><p><strong>必要なGitHubアプリの権限：</strong></p><ul><li><code>Organization > Members: Read</code> - チームメンバーを一覧表示するため</li></p><p></ul><h3>プログレッシブデプロイメントパイプライン</h3></p><p>単一の承認イシューで複数の環境へのデプロイを追跡します。各ステージが承認されると、イシューが進捗を表示するように更新され、自動的に次のステージに進みます。</p><p>#### パイプライン設定</p><pre><code class="language-yaml"># .github/approvals.yml or external config
version: 1</p><p>policies:
  developers:
    approvers: [dev1, dev2, dev3]
    min_approvals: 1</p><p>  qa-team:
    approvers: [qa1, qa2]
    min_approvals: 1</p><p>  tech-leads:
    approvers: [lead1, lead2]
    min_approvals: 1</p><p>  production-approvers:
    approvers: [sre1, sre2, security-lead]
    require_all: true</p><p>workflows:
  deploy:
    description: "Deploy through all environments (dev → qa → stage → prod)"
    require:
      <ul><li>policy: developers  # Initial approval to start pipeline</li>
    </ul>pipeline:
      track_prs: true       # Include PRs in the issue body
      track_commits: true   # Include commits in the issue body
      stages:
        <ul><li>name: dev</li>
          </ul>environment: development
          policy: developers
          on_approved: "✅ <strong>DEV</strong> deployment approved! Proceeding to QA..."
        <ul><li>name: qa</li>
          </ul>environment: qa
          policy: qa-team
          on_approved: "✅ <strong>QA</strong> deployment approved! Proceeding to STAGING..."
        <ul><li>name: stage</li>
          </ul>environment: staging
          policy: tech-leads
          on_approved: "✅ <strong>STAGING</strong> deployment approved! Ready for PRODUCTION..."
        <ul><li>name: prod</li>
          </ul>environment: production
          policy: production-approvers
          on_approved: "🚀 <strong>PRODUCTION</strong> deployment complete!"
          create_tag: true   # Create tag when PROD is approved
          is_final: true     # Close issue after this stage
    on_approved:
      close_issue: true
      comment: |
        🎉 <strong>Deployment Complete!</strong></p><p>        Version <code>{{version}}</code> has been deployed to all environments.</code></pre></p><p>#### パイプラインワークフローの例</p><pre><code class="language-yaml"># .github/workflows/request-pipeline.yml
name: Request Pipeline Deployment</p><p>on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to deploy'
        required: true
        type: string</p><p>permissions:
  contents: write
  issues: write
  pull-requests: read  # Required for PR tracking</p><p>jobs:
  request:
    runs-on: ubuntu-latest
    steps:
      <ul><li>uses: actions/checkout@v4</li>
        </ul>with:
          fetch-depth: 0  # Needed for commit/PR comparison</p><ul><li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>id: approval
        with:
          action: request
          workflow: deploy
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}</p><ul><li>name: Output Results</li>
        </ul>run: |
          echo "## Pipeline Deployment Started" >> $GITHUB_STEP_SUMMARY
          echo "- <strong>Issue:</strong> #${{ steps.approval.outputs.issue_number }}" >> $GITHUB_STEP_SUMMARY
          echo "- <strong>URL:</strong> ${{ steps.approval.outputs.issue_url }}" >> $GITHUB_STEP_SUMMARY</code></pre></p><p>#### 仕組み</p><ul><li><strong>課題作成</strong>：トリガーが発動すると、すべてのステージを示す視覚的なMermaid図と進捗表を含む単一の課題を作成します：</li></p><p></ul><pre><code class="language-markdown">## 🚀 デプロイメントパイプライン: v1.2.0</p><h3>パイプラインフロー</h3></p><p>​``<code>mermaid
flowchart LR
    DEV(⏳ DEV)
    QA(⬜ QA)
    STAGE(⬜ STAGE)
    PROD(⬜ PROD)
    DEV --> QA --> STAGE --> PROD</p><p>    classDef completed fill:#28a745,stroke:#1e7e34,color:#fff
    classDef current fill:#ffc107,stroke:#d39e00,color:#000
    classDef pending fill:#6c757d,stroke:#545b62,color:#fff
    class DEV current
    class QA,STAGE,PROD pending
​</code>`<code></p><h3>Deployment Progress</h3></p><p>| Stage | Status | Approver | Time |
|-------|--------|----------|------|
| DEV | ⏳ Awaiting | - | - |
| QA | ⬜ Pending | - | - |
| STAGE | ⬜ Pending | - | - |
| PROD | ⬜ Pending | - | - |</p><p><strong>Current Stage:</strong> DEV</code></pre></p><p>Mermaidダイアグラムは、色分けされたノードで一目で状況を把握できます：
<ul><li>🟢 <strong>緑</strong> - 完了したステージ</li>
<li>🟡 <strong>黄</strong> - 承認待ちの現在のステージ</li>
<li>⚪ <strong>灰色</strong> - 保留中のステージ</li>
<li>🔵 <strong>シアン</strong> - 自動承認ステージ</li></p><p></ul>Mermaidダイアグラムを無効にするには、パイプライン設定で</code>show_mermaid_diagram: false<code>を設定します。</p><ul><li><strong>ステージの進行</strong>：コメントに</code>approve<code>と記入すると次のステージへ進みます。ダイアグラムと表は自動的に更新されます：</li></p><p></ul><pre><code class="language-markdown">| Stage | Status | Approver | Time |
|-------|--------|----------|------|
| DEV | ✅ Deployed | @developer1 | Dec 9 10:30 |
| QA | ✅ Deployed | @qa-lead | Dec 9 14:15 |
| STAGE | ⏳ Awaiting | - | - |
| PROD | ⬜ Pending | - | - |</p><p><strong>Current Stage:</strong> STAGE</code></pre></p><ul><li><strong>PRおよびコミット追跡</strong>: リリースマネージャーは何がデプロイされているかを正確に把握できます:</li></p><p></ul><pre><code class="language-markdown">### Pull Requests in this Release</p><p>| PR | Title | Author |
|----|-------|--------|
| <a href="https://..." target="_blank" rel="noopener noreferrer">#42</a> | Add user authentication | @alice |
| <a href="https://..." target="_blank" rel="noopener noreferrer">#45</a> | Fix payment processing bug | @bob |</p><h3>Commits</h3></p><ul><li><a href="https://..." target="_blank" rel="noopener noreferrer"></code>abc1234<code></a> feat: add OAuth2 support</li>
<li><a href="https://..." target="_blank" rel="noopener noreferrer"></code>def5678<code></a> fix: handle null payments</code></pre></li>
<li><strong>完了</strong>: 最終段階が承認されると:</li>
   <li>タグが作成される（</code>create_tag: true<code>の場合）</li>
   <li>完了コメントが投稿される</li>
   <li>イシューが自動的にクローズされる</li></p><p></ul>#### パイプラインステージオプション</p><p>| オプション | 説明 |
|------------|------|
| </code>name<code> | ステージ名（テーブルに表示） |
| </code>environment<code> | GitHub環境名 |
| </code>policy<code> | このステージの承認ポリシー |
| </code>approvers<code> | インライン承認者（ポリシーの代替） |
| </code>on_approved<code> | ステージ承認時に投稿するメッセージ |
| </code>create_tag<code> | このステージでgitタグを作成 |
| </code>is_final<code> | このステージ後にイシューをクローズ |
| </code>auto_approve<code> | 人間の介入なしで自動的にこのステージを承認 |
| </code>approval_mode<code> | このステージのワークフロー承認モードを上書き |</p><p>#### 承認モード</p><p>承認者が承認リクエストとどのようにやり取りするかを選択:</p><p>| モード | 説明 |
|--------|------|
| </code>comments<code> | （デフォルト）承認者がイシューに</code>/approve<code>または</code>approve<code>とコメントする |
| </code>sub_issues<code> | 各ステージごとにサブイシューを作成 - クローズで承認 |
| </code>hybrid<code> | ステージごとにモードを混在させる - 各ステージの</code>approval_mode<code>を使用 |</p><p><strong>サブイシュー承認の例:</strong></p><pre><code class="language-yaml">workflows:
  deploy:
    approval_mode: sub_issues
    sub_issue_settings:
      title_template: "⏳ Approve: {{stage}} for {{version}}"  # Changes to ✅ when approved
      labels: [approval-stage]
      protection:
        only_assignee_can_close: true   # Prevents unauthorized approvals
        prevent_parent_close: true       # Parent can't close until all approved
    pipeline:
      stages:
        <ul><li>name: dev</li>
          </ul>policy: developers
        <ul><li>name: prod</li>
          </ul>policy: production-approvers</code></pre>
サブ課題がある場合、親課題には承認されたサブ課題の表が表示されます：</p><pre><code class="language-markdown">### 📋 Approval Sub-Issues</p><p>| Stage | Sub-Issue | Status | Assignees |
|-------|-----------|--------|----------|
| DEV | #124 | ⏳ Awaiting | @alice, @bob |
| PROD | #125 | ⏳ Awaiting | @sre1, @sre2 |</code></pre></p><p><strong>ハイブリッドモード（ステージごとのオーバーライド）：</strong></p><pre><code class="language-yaml">workflows:
  deploy:
    approval_mode: comments  # Default for this workflow
    pipeline:
      stages:
        <ul><li>name: dev</li>
          </ul>policy: developers
          # Uses comments (workflow default)
        <ul><li>name: prod</li>
          </ul>policy: production-approvers
          approval_mode: sub_issues  # Override for production only</code></pre></p><p>#### 強化されたコメントUX</p><p>このアクションには強化されたコメントベースの承認UXが含まれています：</p><ul><li><strong>絵文字リアクション</strong>：承認コメントに自動リアクション</li>
  <li>👍 承認済み</li>
  <li>👎 拒否済み</li>
  <li>👀 確認済み（処理中）</li></p><p><li><strong>クイックアクションセクション</strong>：Issue本文にコマンド参照表を含む：</li></p><p></ul><pre><code class="language-markdown">### ⚡ Quick Actions</p><p>| Action | Command | Description |
|--------|---------|-------------|
| ✅ Approve | </code>/approve<code> | Approve the <strong>DEV</strong> stage |
| ❌ Deny | </code>/deny [reason]<code> | Deny with optional reason |
| 📊 Status | </code>/status<code> | Show current approval status |</code></pre></p><p><strong></code>comment_settings<code>を通じて設定：</strong></p><pre><code class="language-yaml">workflows:
  deploy:
    comment_settings:
      react_to_comments: true     # Add emoji reactions (default: true)
      show_quick_actions: true    # Show Quick Actions section (default: true)</code></pre></p><p>#### 低環境向けの自動承認</p><p></code>auto_approve: true<code> を、手動の承認なしで自動的に承認されるべきパイプラインステージに使用します。これは、</code>dev<code> や </code>integration<code> のような低環境で、プロダクションの承認ゲートを維持しつつパイプラインの速度を上げたい場合に最適です。</p><p><strong>自動承認の例：</strong></p><pre><code class="language-yaml">workflows:
  deploy:
    description: "Deploy through environments"
    pipeline:
      stages:
        <ul><li>name: dev</li>
          </ul>environment: development
          auto_approve: true              # Automatically approved
          on_approved: "🤖 DEV auto-deployed"
        <ul><li>name: integration</li>
          </ul>environment: integration
          auto_approve: true              # Automatically approved
          on_approved: "🤖 INTEGRATION auto-deployed"
        <ul><li>name: staging</li>
          </ul>environment: staging
          policy: qa-team                 # Requires manual approval
          on_approved: "✅ STAGING approved"
        <ul><li>name: production</li>
          </ul>environment: production
          policy: production-approvers    # Requires manual approval
          create_tag: true
          is_final: true</code></pre>
<strong>仕組み：</strong></p><ul><li>パイプラインの問題が作成されると、すべての初期の </code>auto_approve: true<code> ステージが自動的に完了します</li>
<li>ステージが手動で承認されると、その後に続く連続した </code>auto_approve: true<code> ステージも自動的に完了します</li>
<li>自動承認されたステージはパイプライン表で🤖アイコンが表示されます</li>
<li>承認者はステージ履歴に </code>[auto]<code> として記録されます</li></p><p></ul><strong>ユースケース：</strong></p><ul><li><strong>開発環境</strong>：承認を待たずに即時デプロイ</li>
<li><strong>統合テスト</strong>：テスト環境を通じてCI/CDパイプラインを自動的に進行</li>
<li><strong>カナリアデプロイメント</strong>：カナリアステージを自動承認し、完全展開には承認を要求</li></p><p></ul>#### パイプライン設定オプション</p><p>| オプション | デフォルト | 説明 |
|------------|------------|------|
| </code>track_prs<code> | </code>false<code> | マージされたPRを問題本文に含める |
| </code>track_commits<code> | </code>false<code> | 最後のタグ以降のコミットを含める |
| </code>compare_from_tag<code> | - | 比較元のカスタムタグパターン |
| </code>show_mermaid_diagram<code> | </code>true<code> | パイプラインステージのMermaidフローチャートを表示 |</p><p><strong>注意：</strong> PRトラッキングにはワークフロー内での </code>pull-requests: read<code> 権限が必要です。</p><h3>リリース候補戦略</h3></p><p>エンタープライズ環境では、mainにマージされたPRが必ずしも即リリース候補になるとは限りません。承認エンジンは、どのPRがリリースに属するかを選択するための3つの戦略をサポートしています。</p><p>#### 戦略タイプ</p><p>| 戦略 | 説明 | ユースケース |
|------|-------|--------------|
| </code>tag<code> | 2つのgitタグ間のPR（デフォルト） | シンプルなリリース、トランクベース開発 |
| </code>branch<code> | リリースブランチにマージされたPR | GitFlow、リリースブランチ |
| </code>label<code> | 特定のリリースラベルが付いたPR | 柔軟な選択、一括リリース |
| </code>milestone<code> | GitHubマイルストーンに割り当てられたPR | ロードマップに沿ったリリース |</p><p>#### 設定</p><pre><code class="language-yaml"># .github/approvals.yml
workflows:
  deploy:
    description: "Production deployment pipeline"
    pipeline:
      track_prs: true
      track_commits: true</p><p>      # Configure release selection strategy
      release_strategy:
        type: milestone  # or: tag, branch, label</p><p>        # Milestone strategy settings
        milestone:
          pattern: "v{{version}}"        # e.g., "v1.2.0"
          close_after_release: true       # Close milestone on prod completion</p><p>        # Auto-create next release artifact on completion
        auto_create:
          enabled: true
          next_version: patch             # or: minor, major
          create_issue: true              # Create new approval issue</p><p>      stages:
        <ul><li>name: dev</li>
          </ul>policy: developers
        <ul><li>name: prod</li>
          </ul>policy: production-approvers
          is_final: true</code></pre></p><p>#### ブランチ戦略</p><p>GitFlowスタイルの開発にはリリースブランチを使用します：</p><pre><code class="language-yaml">release_strategy:
  type: branch
  branch:
    pattern: "release/{{version}}"  # Creates release/v1.2.0
    base_branch: main               # Compare against main
    delete_after_release: true      # Cleanup after prod deploy</p><p>  auto_create:
    enabled: true
    next_version: minor</code></pre></p><p><strong>仕組み:</strong>
<ul><li>リリースブランチを作成します: </code>release/v1.2.0<code></li>
<li>ブランチにマージされたPRはリリース候補です</li>
<li>そのバージョンの承認を依頼します</li>
<li>承認用のIssueにリリースブランチ内のすべてのPRが表示されます</li>
<li>本番適用後、ブランチは削除されます（任意）次のブランチを作成します</li></p><p></ul>#### ラベル戦略</p><p>柔軟なPR選択のためにラベルを使用します:</p><pre><code class="language-yaml">release_strategy:
  type: label
  label:
    pattern: "release:{{version}}"      # e.g., "release:v1.2.0"
    pending_label: "pending-release"    # Applied to merged PRs awaiting release
    remove_after_release: true          # Remove label after prod deploy</p><p>  auto_create:
    enabled: true
    next_version: patch</code></pre></p><p><strong>動作の仕組み:</strong>
<ul><li>main にマージされたPRに </code>pending-release<code> ラベルが付く</li>
<li>リリースマネージャーが選択したPRに </code>release:v1.2.0<code> を適用する</li>
<li>v1.2.0 の承認をリクエストする</li>
<li>承認用のIssueにはそのラベルが付いたPRのみが表示される</li>
<li>本番リリース後、ラベルは削除され、次のリリースラベルが作成される</li></p><p></ul>#### マイルストーン戦略</p><p>ロードマップに沿ったリリースにはマイルストーンを使用する:</p><pre><code class="language-yaml">release_strategy:
  type: milestone
  milestone:
    pattern: "Release {{version}}"       # e.g., "Release 1.2.0"
    close_after_release: true            # Close milestone on completion</p><p>  auto_create:
    enabled: true
    next_version: minor
    create_issue: true                   # Auto-create next approval issue</code></pre></p><p><strong>仕組み:</strong>
<ul><li>マイルストーンを作成: "リリース 1.2.0"</li>
<li>開発中にPRをマイルストーンに割り当てる</li>
<li>v1.2.0の承認を依頼する</li>
<li>承認用のIssueにマイルストーン内のすべてのPRが表示される</li>
<li>本番後、マイルストーンを閉じて次のマイルストーンを作成する</li></p><p></ul>#### 完了時の自動作成</p><p>最終段階（本番）が承認されると、次のリリースの準備を自動的に行う:</p><pre><code class="language-yaml">auto_create:
  enabled: true
  next_version: patch      # Calculate next: patch, minor, or major
  create_issue: true       # Create new approval issue immediately
  comment: |               # Custom message (optional)
    🚀 <strong>Next release prepared:</strong> {{version}}</code></pre>
これにより作成されます：
<ul><li><strong>ブランチ戦略:</strong> mainから新しいリリースブランチ</li>
<li><strong>ラベル戦略:</strong> 新しいリリースラベル</li>
<li><strong>マイルストーン戦略:</strong> 新しいマイルストーン</li></p><p></ul>#### クリーンアップオプション</p><p>各戦略には、最終段階（prod）が承認されたときに実行されるオプションのクリーンアップアクションがあります。<strong>すべてのクリーンアップオプションはデフォルトで</code>false<code>です</strong> - クリーンアップはオプトイン方式です：</p><p>| 戦略 | クリーンアップオプション | 説明 |
|----------|----------------|-------------|
| ブランチ | </code>delete_after_release<code> | リリースブランチを削除 |
| ラベル | </code>remove_after_release<code> | PRからリリースラベルを削除 |
| マイルストーン | </code>close_after_release<code> | マイルストーンをクローズ |</p><pre><code class="language-yaml">release_strategy:
  type: branch
  branch:
    pattern: "release/{{version}}"
    delete_after_release: false   # Keep branch for reference (default)</p><p>  type: milestone
  milestone:
    pattern: "v{{version}}"
    close_after_release: true     # Close milestone when done</code></pre></p><p>#### ホットフィックスのデプロイ</p><p>通常のリリースワークフローをバイパスする必要がある緊急ホットフィックスの場合は、別のワークフローを作成してください：</p><pre><code class="language-yaml"># .github/approvals.yml
workflows:
  # Standard releases - full pipeline with milestone tracking
  deploy:
    description: "Standard release pipeline (dev → qa → stage → prod)"
    pipeline:
      release_strategy:
        type: milestone
        milestone:
          pattern: "v{{version}}"
          close_after_release: true
        auto_create:
          enabled: true
          next_version: minor
      stages:
        <ul><li>name: dev</li>
          </ul>policy: developers
        <ul><li>name: qa</li>
          </ul>policy: qa-team
        <ul><li>name: stage</li>
          </ul>policy: tech-leads
        <ul><li>name: prod</li>
          </ul>policy: production-approvers
          is_final: true</p><p>  # Hotfixes - skip stages, direct to prod
  hotfix:
    description: "Emergency hotfix - direct to production"
    pipeline:
      release_strategy:
        type: tag              # Simple tag-based, no cleanup needed
        # No auto_create - hotfixes are one-off
      stages:
        <ul><li>name: prod</li>
          </ul>policy: production-approvers
          create_tag: true
          is_final: true
    on_approved:
      close_issue: true
      comment: "🚨 Hotfix {{version}} deployed to production"</code></pre></p><p><strong>トリガーホットフィックス vs 通常リリース:</strong></p><pre><code class="language-bash"># Regular release - goes through all stages
gh workflow run request-approval.yml -f workflow_name=deploy -f version=v1.3.0</p><h1>Hotfix - goes straight to prod</h1>
gh workflow run request-approval.yml -f workflow_name=hotfix -f version=v1.2.1</code></pre></p><p><strong>ホットフィックスパターン:</strong></p><p>| シナリオ | 戦略 | クリーンアップ | 自動作成 |
|----------|----------|---------|-------------|
| 緊急修正 | </code>tag<code> | なし | 無効 |
| パッチリリース | </code>milestone<code> | </code>close_after_release: false<code> | 無効 |
| 複数ホットフィックス | </code>branch<code> | </code>delete_after_release: false<code> | 無効 |</p><p>#### リリース戦略の利点</p><p>| 戦略 | 長所 | 短所 |
|----------|------|------|
| <strong>Tag</strong> | シンプルで追加ワークフロー不要 | マージ済みPRすべてが含まれる |
| <strong>Branch</strong> | リリース範囲が明確で隔離可能 | ブランチ管理の負荷あり |
| <strong>Label</strong> | 柔軟な選択が可能で変更容易 | 手動でのラベリングが必要 |
| <strong>Milestone</strong> | ロードマップの可視化、計画連携 | マイルストーンの規律が必要 |</p><p><strong>推奨事項:</strong></p><ul><li>継続的デプロイのシンプルなプロジェクトには <strong>tag</strong> を使用</li>
<li>リリースの隔離が必要な規制環境には <strong>branch</strong> を使用</li>
<li>柔軟な範囲でのバッチリリースには <strong>label</strong> を使用</li>
<li>明確なリリース計画があるロードマップ駆動の開発には <strong>milestone</strong> を使用</li></p><p></ul><h3>Jira連携</h3></p><p>コミットやブランチ名から自動でJira課題を抽出します。アクションは2つのモードをサポートします:</p><p>#### リンクのみモード（認証不要）</p><p></code>jira_base_url<code> を指定するだけで課題キーを抽出し、クリック可能なリンクとして表示します:</p><pre><code class="language-yaml">- uses: jamengual/enterprise-approval-engine@v1
  with:
    action: request
    workflow: production-deploy
    version: v1.2.0
    token: ${{ secrets.GITHUB_TOKEN }}
    jira_base_url: https://yourcompany.atlassian.net  # That's it!</code></pre></p><p>これはコミットメッセージやブランチ名から課題キー（例：</code>PROJ-123<code>）を抽出し、承認課題にリンクとして表示します：</p><pre><code class="language-markdown">### Jira Issues
<ul><li><a href="https://yourcompany.atlassian.net/browse/PROJ-123" target="_blank" rel="noopener noreferrer">PROJ-123</a></li>
<li><a href="https://yourcompany.atlassian.net/browse/PROJ-456" target="_blank" rel="noopener noreferrer">PROJ-456</a></code></pre></li></p><p></ul>#### フルモード（APIアクセスあり）</p><p>認証情報を追加して、課題の詳細を取得し、修正バージョンを更新します：</p><pre><code class="language-yaml">- uses: jamengual/enterprise-approval-engine@v1
  with:
    action: request
    workflow: production-deploy
    version: v1.2.0
    token: ${{ secrets.GITHUB_TOKEN }}
    # Jira configuration
    jira_base_url: https://yourcompany.atlassian.net
    jira_user_email: ${{ secrets.JIRA_EMAIL }}
    jira_api_token: ${{ secrets.JIRA_API_TOKEN }}
    jira_update_fix_version: 'true'</code></pre></p><p>これは詳細な問題情報を表示します：</p><pre><code class="language-markdown">### Jira Issues in this Release</p><p>| Key | Summary | Type | Status |
|-----|---------|------|--------|
| <a href="https://..." target="_blank" rel="noopener noreferrer">PROJ-123</a> | Fix login bug | Bug | Done |
| <a href="https://..." target="_blank" rel="noopener noreferrer">PROJ-456</a> | Add dark mode | Feature | In Progress |</code></pre></p><p><strong>モードの比較：</strong></p><p>| モード | 認証必要 | 機能 |
|--------|-----------|-------|
| リンクのみ | いいえ | クリック可能なリンクとしてキーを発行 |
| フル | はい | リンク＋概要、ステータス、タイプの絵文字、Fix Versionの更新 |</p><p><strong>Jiraの出力：</strong></p><pre><code class="language-yaml">- name: Use Jira Outputs
  run: |
    echo "Issues: ${{ steps.approval.outputs.jira_issues }}"
    # Output: PROJ-123,PROJ-456</p><p>    echo "Details: ${{ steps.approval.outputs.jira_issues_json }}"
    # Output: [{"key":"PROJ-123","summary":"Fix login bug",...}]</code></pre></p><h3>デプロイメントトラッキング</h3></p><p>GitHubのデプロイメントダッシュボードでの可視性のためにGitHubデプロイメントを作成します。これはワークフロ―YAMLの</code>environment:<code>キーとは独立して動作します。</p><pre><code class="language-yaml">- uses: jamengual/enterprise-approval-engine@v1
  id: approval
  with:
    action: request
    workflow: production-deploy
    version: v1.2.0
    token: ${{ secrets.GITHUB_TOKEN }}
    # Deployment tracking
    create_deployment: 'true'
    deployment_environment: production
    deployment_environment_url: https://myapp.example.com</p><ul><li>name: Update Deployment Status</li>
  </ul>if: steps.approval.outputs.status == 'approved'
  run: |
    # Use the deployment_id to update status after actual deployment
    echo "Deployment ID: ${{ steps.approval.outputs.deployment_id }}"</code></pre></p><p><strong>デプロイメントが表示される場所：</strong></p><ul><li>リポジトリの<strong>Deployments</strong>タブ</li>
<li>リポジトリページの環境ステータスバッジ</li>
<li>GitHub for Jira連携（設定されている場合）</li>
<li>CI/CDツール向けのGitHub API</li></p><p></ul><strong>注意：</strong> これはGitHubのネイティブなEnvironment Protection Rulesとは別のGitHub Deployments APIを通じてデプロイメントを作成します。両方を併用することも、独立して使用することも可能です。</p><h3>外部設定リポジトリ</h3></p><p>承認設定を共有リポジトリに保存し、ポリシー管理を集中化します：</p><pre><code class="language-yaml">- uses: jamengual/enterprise-approval-engine@v1
  with:
    action: request
    workflow: production-deploy
    token: ${{ secrets.GITHUB_TOKEN }}
    config_repo: myorg/.github  # Shared config repo</code></pre></p><p><strong>設定解決順序：</strong></p><ul><li>外部リポジトリ内の </code>{repo-name}_approvals.yml<code>（例：</code>myapp_approvals.yml<code>）</li>
<li>外部リポジトリ内の </code>approvals.yml<code>（共有デフォルト）</li>
<li>現在のリポジトリ内の </code>.github/approvals.yml<code>（ローカルフォールバック）</li></p><p></ul><strong>組織構造の例：</strong></p><pre><code class="language-text">myorg/.github/
├── myapp_approvals.yml      # App-specific config
├── backend_approvals.yml    # Backend repos config
└── approvals.yml            # Default for all repos</code></pre></p><h3>承認のブロック</h3></p><p>進行前に承認を待つ必要があるワークフローの場合:</p><pre><code class="language-yaml">name: Deploy with Blocking Approval</p><p>on:
  workflow_dispatch:
    inputs:
      version:
        required: true
        type: string</p><p>jobs:
  request-approval:
    runs-on: ubuntu-latest
    outputs:
      issue_number: ${{ steps.request.outputs.issue_number }}
    steps:
      <ul><li>uses: actions/checkout@v4</li>
      <li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>id: request
        with:
          action: request
          workflow: production-deploy
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}</p><p>  wait-for-approval:
    needs: request-approval
    runs-on: ubuntu-latest
    outputs:
      status: ${{ steps.check.outputs.status }}
      tag: ${{ steps.check.outputs.tag }}
    steps:
      <ul><li>uses: actions/checkout@v4</li>
      <li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>id: check
        with:
          action: check
          issue_number: ${{ needs.request-approval.outputs.issue_number }}
          wait: 'true'           # Poll until approved/denied
          timeout: '4h'          # Max wait time
          token: ${{ secrets.GITHUB_TOKEN }}</p><p>  deploy:
    needs: [request-approval, wait-for-approval]
    if: needs.wait-for-approval.outputs.status == 'approved'
    runs-on: ubuntu-latest
    steps:
      <ul><li>name: Deploy</li>
        </ul>run: |
          echo "Deploying ${{ needs.wait-for-approval.outputs.tag }}"</code></pre></p><p><strong>注意:</strong> ブロッキングワークフローはランナーをアクティブに保つため、GitHub Actionsの実行時間を消費します。コストを重視する場合は、イベント駆動型アプローチ（別の</code>process-comment<code>ワークフロー）を使用してください。</p><h3>イシュークローズ時のタグ削除</h3></p><p>承認イシューが手動でクローズされたときにタグを削除することができます。</p><pre><code class="language-yaml">workflows:
  dev-deploy:
    on_closed:
      delete_tag: true   # Delete tag when issue is closed
      comment: "Cancelled. Tag {{tag}} deleted."</p><p>  production-deploy:
    on_closed:
      delete_tag: false  # NEVER delete production tags</code></pre></p><p><strong>クローズイベントの処理:</strong></p><pre><code class="language-yaml"># .github/workflows/handle-close.yml
name: Handle Issue Close</p><p>on:
  issues:
    types: [closed]</p><p>jobs:
  handle:
    if: contains(github.event.issue.labels.*.name, 'approval-required')
    runs-on: ubuntu-latest
    steps:
      <ul><li>uses: actions/checkout@v4</li>
      <li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>id: close
        with:
          action: close-issue
          issue_number: ${{ github.event.issue.number }}
          issue_action: ${{ github.event.action }}
          token: ${{ secrets.GITHUB_TOKEN }}</p><ul><li>name: Report</li>
        </ul>run: |
          echo "Status: ${{ steps.close.outputs.status }}"
          echo "Deleted tag: ${{ steps.close.outputs.tag_deleted }}"</code></pre></p><hr></p><h2>Complete Examples</h2></p><h3>Full-Featured Request Workflow</h3></p><pre><code class="language-yaml">name: Request Production Deployment</p><p>on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to deploy'
        required: true
        type: string
      environment:
        description: 'Target environment'
        required: true
        type: choice
        options: [staging, production]</p><p>permissions:
  contents: write
  issues: write
  deployments: write</p><p>jobs:
  request:
    runs-on: ubuntu-latest
    outputs:
      issue_number: ${{ steps.approval.outputs.issue_number }}
      issue_url: ${{ steps.approval.outputs.issue_url }}
      deployment_id: ${{ steps.approval.outputs.deployment_id }}
      jira_issues: ${{ steps.approval.outputs.jira_issues }}
    steps:
      <ul><li>uses: actions/checkout@v4</li>
        </ul>with:
          fetch-depth: 0  # Needed for commit comparison</p><ul><li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>id: approval
        with:
          action: request
          workflow: ${{ inputs.environment }}-deploy
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}
          # Jira integration
          jira_base_url: https://mycompany.atlassian.net
          jira_user_email: ${{ secrets.JIRA_EMAIL }}
          jira_api_token: ${{ secrets.JIRA_API_TOKEN }}
          # Deployment tracking
          create_deployment: 'true'
          deployment_environment: ${{ inputs.environment }}
          deployment_environment_url: https://${{ inputs.environment }}.myapp.com</p><ul><li>name: Summary</li>
        </ul>run: |
          echo "## Approval Request Created" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- <strong>Issue:</strong> #${{ steps.approval.outputs.issue_number }}" >> $GITHUB_STEP_SUMMARY
          echo "- <strong>URL:</strong> ${{ steps.approval.outputs.issue_url }}" >> $GITHUB_STEP_SUMMARY
          echo "- <strong>Jira Issues:</strong> ${{ steps.approval.outputs.jira_issues }}" >> $GITHUB_STEP_SUMMARY
          echo "- <strong>Commits:</strong> ${{ steps.approval.outputs.commits_count }}" >> $GITHUB_STEP_SUMMARY</code></pre></p><h3>チームサポートによるコメントの処理</h3></p><pre><code class="language-yaml">name: Handle Approval Comments</p><p>on:
  issue_comment:
    types: [created]</p><p>permissions:
  contents: write
  issues: write</p><p>jobs:
  process:
    if: |
      github.event.issue.pull_request == null &&
      contains(github.event.issue.labels.*.name, 'approval-required')
    runs-on: ubuntu-latest
    steps:
      <ul><li>uses: actions/checkout@v4</li></p><p>      </ul># Generate GitHub App token for team membership checks
      <ul><li>uses: actions/create-github-app-token@v2</li>
        </ul>id: app-token
        with:
          app-id: ${{ vars.APP_ID }}
          private-key: ${{ secrets.APP_PRIVATE_KEY }}</p><ul><li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>id: process
        with:
          action: process-comment
          issue_number: ${{ github.event.issue.number }}
          token: ${{ steps.app-token.outputs.token }}
          # Jira integration to update Fix Version on approval
          jira_base_url: https://mycompany.atlassian.net
          jira_user_email: ${{ secrets.JIRA_EMAIL }}
          jira_api_token: ${{ secrets.JIRA_API_TOKEN }}</p><ul><li>name: Trigger Deployment</li>
        </ul>if: steps.process.outputs.status == 'approved'
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'deploy.yml',
              ref: 'main',
              inputs: { version: '${{ steps.process.outputs.tag }}' }
            });</code></pre></p><h3>マルチ環境プロモーション</h3></p><pre><code class="language-yaml"># .github/approvals.yml
version: 1</p><p>policies:
  dev-team:
    approvers: [dev1, dev2, dev3]
    min_approvals: 1</p><p>  qa-team:
    approvers: [qa1, qa2]
    min_approvals: 1</p><p>  prod-team:
    approvers: [team:sre, tech-lead]
    min_approvals: 2</p><p>workflows:
  dev-deploy:
    require:
      <ul><li>policy: dev-team</li>
    </ul>on_approved:
      tagging:
        enabled: true
        auto_increment: patch
        env_prefix: "dev-"
      close_issue: true</p><p>  staging-deploy:
    require:
      <ul><li>policy: qa-team</li>
    </ul>on_approved:
      tagging:
        enabled: true
        auto_increment: minor
        env_prefix: "staging-"
      close_issue: true</p><p>  production-deploy:
    require:
      <ul><li>policy: prod-team</li>
    </ul>on_approved:
      create_tag: true
      close_issue: true
    on_closed:
      delete_tag: false  # Never delete production tags</code></pre></p><h3>後続ジョブでの出力の使用</h3></p><pre><code class="language-yaml">name: Deploy with Approval</p><p>on:
  workflow_dispatch:
    inputs:
      version:
        required: true</p><p>jobs:
  approval:
    runs-on: ubuntu-latest
    outputs:
      status: ${{ steps.check.outputs.status }}
      tag: ${{ steps.check.outputs.tag }}
      approvers: ${{ steps.check.outputs.approvers }}
      jira_issues: ${{ steps.request.outputs.jira_issues }}
    steps:
      <ul><li>uses: actions/checkout@v4</li></p><p>      <li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>id: request
        with:
          action: request
          workflow: production-deploy
          version: ${{ inputs.version }}
          token: ${{ secrets.GITHUB_TOKEN }}
          jira_base_url: https://mycompany.atlassian.net</p><ul><li>uses: jamengual/enterprise-approval-engine@v1</li>
        </ul>id: check
        with:
          action: check
          issue_number: ${{ steps.request.outputs.issue_number }}
          wait: 'true'
          timeout: '2h'
          token: ${{ secrets.GITHUB_TOKEN }}</p><p>  deploy:
    needs: approval
    if: needs.approval.outputs.status == 'approved'
    runs-on: ubuntu-latest
    environment: production
    steps:
      <ul><li>name: Deploy</li>
        </ul>run: |
          echo "Deploying ${{ needs.approval.outputs.tag }}"
          echo "Approved by: ${{ needs.approval.outputs.approvers }}"
          echo "Jira Issues: ${{ needs.approval.outputs.jira_issues }}"</p><p>  notify:
    needs: [approval, deploy]
    if: always()
    runs-on: ubuntu-latest
    steps:
      <ul><li>name: Notify Slack</li>
        </ul>run: |
          if [ "${{ needs.approval.outputs.status }}" == "approved" ]; then
            echo "Deployment of ${{ needs.approval.outputs.tag }} completed!"
          else
            echo "Deployment was ${{ needs.approval.outputs.status }}"
          fi</code></pre></p><hr></p><h2>Schema Validation</h2></p><p>Validate your configuration using the JSON schema:</p><pre><code class="language-yaml"># .github/approvals.yml
<h1>yaml-language-server: $schema=https://raw.githubusercontent.com/jamengual/enterprise-approval-engine/main/schema.json</h1></p><p>version: 1</p><p>policies:
  # ... your config</code></pre></p><p>または CI で検証します:</p><pre><code class="language-yaml">- name: Validate Config
  run: |
    npm install -g ajv-cli
    ajv validate -s schema.json -d .github/approvals.yml</code></pre></p><hr></p><h2>GitHub Enterprise Server</h2></p><p>このアクションはGitHub Enterprise Serverを完全にサポートしています。</code>GITHUB_SERVER_URL<code>および</code>GITHUB_API_URL`環境変数を使用してGHES環境を自動的に検出します。</p><p>追加の設定は不要で、アクションは自動的に正しいAPIエンドポイントを使用します。</p><p><strong>レート制限：</strong></p><p>このアクションにはレート制限エラーに対する指数的バックオフを用いた自動リトライ機能が含まれています。設定内容：</p><ul><li>初期遅延：1秒</li>
<li>最大遅延：60秒</li>
<li>最大リトライ回数：5回</li>
<li>ジッター：雷鳴効果防止のため0〜500msのランダム加算</li></p><p></ul>---</p><h2>ライセンス</h2></p><p>MITライセンス</p><p>
---

Tranlated By <a href="https://github.com/OpenAiTx/OpenAiTx" target="_blank" rel="noopener noreferrer">Open Ai Tx</a> | Last indexed: 2025-12-22

---</p>
        </div>
        
        <div class="original-link">
            <strong>Original README:</strong> <a href="https://raw.githubusercontent.com/jamengual/enterprise-approval-engine/main/README.md" target="_blank" rel="noopener noreferrer">View on GitHub</a>
        </div>
    </div>
    
    <div class="footer">
        <p>Translated by <a href="https://github.com/OpenAiTx/OpenAiTx" target="_blank" rel="noopener noreferrer">OpenAiTx</a> | 
        Last updated: 2025-12-22 
    </div>
    
</body>
</html>