<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapperatorinator - 一個 AI 框架，能夠根據頻譜圖輸入，生成並修改 osu! 各種遊戲模式的譜面。</title>
    <meta name="description" content="一個 AI 框架，能夠根據頻譜圖輸入，生成並修改 osu! 各種遊戲模式的譜面。">
    <meta name="keywords" content="Mapperatorinator, Traditional Chinese, documentation, GitHub, open source">
    <meta name="author" content="OpenAiTx">
    <meta name="robots" content="index, follow">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "Mapperatorinator",
  "description": "一個 AI 框架，能夠根據頻譜圖輸入，生成並修改 osu! 各種遊戲模式的譜面。",
  "author": {
    "@type": "Person",
    "name": "OliBomby"
  },
  "applicationCategory": "DeveloperApplication",
  "operatingSystem": "Any",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "5",
    "ratingCount": 398
  },
  "url": "https://OpenAiTx.github.io/projects/OliBomby/Mapperatorinator/README-zh-TW.html",
  "sameAs": "https://raw.githubusercontent.com/OliBomby/Mapperatorinator/main/README.md",
  "datePublished": "2026-01-24",
  "dateModified": "2026-01-24"
}
    </script>
    
    <!-- GitHub-style CSS -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #24292e;
            background-color: #ffffff;
            max-width: 980px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .container {
            background: #ffffff;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 24px;
            margin-bottom: 20px;
        }
        
        .header {
            border-bottom: 1px solid #e1e4e8;
            padding-bottom: 16px;
            margin-bottom: 24px;
        }
        
        .project-title {
            font-size: 2em;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .project-title a {
            color: #24292e;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: color 0.2s ease;
        }
        
        .project-title a:hover {
            color: #0366d6;
            text-decoration: none;
        }
        
        .project-title .github-icon {
            width: 1em;
            height: 1em;
            fill: currentColor;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }
        
        .project-title a:hover .github-icon {
            opacity: 1;
        }
        
        .project-meta {
            color: #586069;
            font-size: 14px;
            margin-bottom: 16px;
        }
        
        .stars {
            display: inline-block;
            margin-right: 16px;
        }
        
        .language {
            display: inline-block;
            background-color: #f1f8ff;
            color: #0366d6;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .content {
            font-size: 16px;
            line-height: 1.6;
        }
        
        h1, h2, h3, h4, h5, h6 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
            color: #24292e;
        }
        
        h1 { font-size: 2em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        h3 { font-size: 1.25em; }
        
        p {
            margin-bottom: 16px;
        }
        
        code {
            background-color: #f6f8fa;
            border-radius: 3px;
            font-size: 85%;
            margin: 0;
            padding: 0.2em 0.4em;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }
        
        pre {
            background-color: #f6f8fa;
            border-radius: 6px;
            font-size: 85%;
            line-height: 1.45;
            overflow: auto;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        pre code {
            background-color: transparent;
            border: 0;
            display: inline;
            line-height: inherit;
            margin: 0;
            overflow: visible;
            padding: 0;
            word-wrap: normal;
        }
        
        a {
            color: #0366d6;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        ul, ol {
            margin-bottom: 16px;
            padding-left: 2em;
        }
        
        li {
            margin-bottom: 0.25em;
        }
        
        blockquote {
            border-left: 4px solid #dfe2e5;
            color: #6a737d;
            margin: 0 0 16px 0;
            padding: 0 1em;
        }
        
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e1e4e8;
            color: #586069;
            font-size: 14px;
            text-align: center;
        }
        
        .footer a {
            color: #0366d6;
        }
        
        .original-link {
            margin-top: 16px;
            padding: 12px;
            background-color: #f6f8fa;
            border-radius: 6px;
            border: 1px solid #e1e4e8;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 16px;
            }
            
            .project-title {
                font-size: 1.5em;
            }
        }
    </style>
    
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <!-- Bing Count -->
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "sh95yd6uwt");
    </script>        

    <!-- Statcounter -->
    <script type="text/javascript">
        var sc_project = 13142514;
        var sc_invisible = 1;
        var sc_security = "d03a31d8"; 
    </script>
    <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script>
    <noscript>
        <div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img
                    class="statcounter" src="https://c.statcounter.com/13142514/0/d03a31d8/1/" alt="Web Analytics"
                    referrerPolicy="no-referrer-when-downgrade"></a></div>
    </noscript>    
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="project-title">
                <a href="https://github.com/OliBomby/Mapperatorinator" target="_blank" rel="noopener noreferrer">
                    <svg class="github-icon" viewBox="0 0 16 16" aria-hidden="true">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
                    </svg>
                    Mapperatorinator
                </a>
            </h1>
            <div class="project-meta">
                <span class="stars">⭐ 398 stars</span>
                <span class="language">Traditional Chinese</span>
                <span>by OliBomby</span>
            </div>
        </div>
        
        <div class="content">
            <p>
<div align="right">
  <details>
    <summary >🌐 語言</summary>
    <div>
      <div align="center">
        <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=en">English</a>
        | <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=zh-CN">简体中文</a>
        | <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=zh-TW">繁體中文</a>
        | <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=ja">日本語</a>
        | <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=ko">한국어</a>
        | <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=hi">हिन्दी</a>
        | <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=th">ไทย</a>
        | <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=fr">Français</a>
        | <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=de">Deutsch</a>
        | <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=es">Español</a>
        | <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=it">Italiano</a>
        | <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=ru">Русский</a>
        | <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=pt">Português</a>
        | <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=nl">Nederlands</a>
        | <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=pl">Polski</a>
        | <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=ar">العربية</a>
        | <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=fa">فارسی</a>
        | <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=tr">Türkçe</a>
        | <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=vi">Tiếng Việt</a>
        | <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=id">Bahasa Indonesia</a>
        | <a href="https://openaitx.github.io/view.html?user=OliBomby&project=Mapperatorinator&lang=as">অসমীয়া</
      </div>
    </div>
  </details>
</div></p><h1>Mapperatorinator</h1></p><p>您可以在 <a href="https://colab.research.google.com/github/OliBomby/Mapperatorinator/blob/main/colab/mapperatorinator_inference.ipynb" target="_blank" rel="noopener noreferrer">這裡</a> 試用生成模型，或在 <a href="https://colab.research.google.com/github/OliBomby/Mapperatorinator/blob/main/colab/mai_mod_inference.ipynb" target="_blank" rel="noopener noreferrer">這裡</a> 試用 MaiMod。您也可以觀看影片展示 <a href="https://youtu.be/FEr7t1L2EoA" target="_blank" rel="noopener noreferrer">這裡</a>。</p><p>Mapperatorinator 是一個多模型框架，使用聲譜圖作為輸入，能夠生成完整功能的 osu! 所有模式的譜面，並可<a href="#maimod-the-ai-driven-modding-tool" target="_blank" rel="noopener noreferrer">協助譜面修改</a>。
本專案的目標是能自動從任何歌曲生成可排名、品質優良且高度可自訂化的 osu! 譜面。</p><p>本專案建立於 <a href="https://github.com/gyataro/osuT5" target="_blank" rel="noopener noreferrer">osuT5</a> 和 <a href="https://github.com/OliBomby/osu-diffusion" target="_blank" rel="noopener noreferrer">osu-diffusion</a> 之上。開發過程中，我花費約 2500 小時的 GPU 運算時間，總共在我的 4060 Ti 及租用的 vast.ai 4090 伺服器上進行了 142 次訓練。</p><p>#### 請負責任地使用此工具。始終在你的 beatmap 中揭露 AI 的使用。</p><h2>安裝</h2></p><p>以下說明可讓你在本機產生 beatmap，或是選擇使用 <a href="https://colab.research.google.com/github/OliBomby/Mapperatorinator/blob/main/colab/mapperatorinator_inference.ipynb" target="_blank" rel="noopener noreferrer">colab 筆記本</a> 在雲端運行。</p><h3>1. 複製此儲存庫</h3></p><pre><code class="language-sh">git clone https://github.com/OliBomby/Mapperatorinator.git
cd Mapperatorinator</code></pre></p><h3>2.（可選）建立虛擬環境</h3></p><p>請使用 Python 3.10，較新版本可能與相關依賴項不相容。</p><pre><code class="language-sh">python -m venv .venv</p><h1>In cmd.exe</h1>
.venv\Scripts\activate.bat
<h1>In PowerShell</h1>
.venv\Scripts\Activate.ps1
<h1>In Linux or MacOS</h1>
source .venv/bin/activate</code></pre></p><h3>3. 安裝相依套件</h3></p><ul><li>Python 3.10</li>
<li><a href="https://git-scm.com/downloads" target="_blank" rel="noopener noreferrer">Git</a></li>
<li><a href="http://www.ffmpeg.org/" target="_blank" rel="noopener noreferrer">ffmpeg</a></li>
<li><a href="https://developer.nvidia.com/cuda-zone" target="_blank" rel="noopener noreferrer">CUDA</a>（適用於 NVIDIA GPU）或 <a href="https://rocmdocs.amd.com/en/latest/Installation_Guide/Installation-Guide.html" target="_blank" rel="noopener noreferrer">ROCm</a>（適用於 linux 上的 AMD GPU）</li>
<li><a href="https://pytorch.org/get-started/locally/" target="_blank" rel="noopener noreferrer">PyTorch</a>：請確保依照 Get Started 指南安裝具備 GPU 支援的 <code>torch</code> 和 <code>torchaudio</code>，並選擇你在前一步安裝的正確運算平台版本。</li></p><p><li>以及其餘的 Python 相依套件：</li></p><p></ul><pre><code class="language-sh">pip install -r requirements.txt</code></pre></p><h2>網頁圖形介面（推薦）</h2></p><p>為了獲得更友善的使用體驗，建議使用網頁使用者介面。它提供圖形化介面以設定生成參數、啟動流程並監控輸出結果。</p><h3>啟動圖形介面</h3></p><p>請在終端機中導航到已複製的 <code>Mapperatorinator</code> 目錄並執行：</p><pre><code class="language-sh">python web-ui.py</code></pre>
這將啟動一個本地網頁伺服器，並自動在新視窗中開啟使用者介面。</p><h3>使用圖形介面</h3></p><ul><li><strong>設定：</strong> 使用表單欄位和「瀏覽」按鈕設置輸入/輸出路徑。調整產生參數，如遊戲模式、難度、風格（年份、譜師ID、描述詞）、時間、特定功能（打擊音、超級時間點）等，這些都與命令列選項相同。（注意：若提供了 <code>beatmap_path</code>，介面會自動從中判斷 <code>audio_path</code> 和 <code>output_path</code>，因此可將這些欄位留空）</li>
<li><strong>開始：</strong> 點擊「開始推論」按鈕以開始譜面生成。</li>
<li><strong>取消：</strong> 可使用「取消推論」按鈕停止進行中的作業。</li>
<li><strong>開啟輸出：</strong> 完成後，請使用「開啟輸出資料夾」按鈕快速存取產生的檔案。</li></p><p></ul>網頁介面作為 <code>inference.py</code> 腳本的便利包裝。若需進階選項或疑難排解，請參閱命令列指令說明。</p><p><img src="https://github.com/user-attachments/assets/5312a45f-d51c-4b37-9389-da3258ddd0a1" alt="python_u3zyW0S3Vs"></p><h2>命令列推論</h2></p><p>對於偏好命令列操作或需要進階設定的使用者，請依照下方步驟進行。<strong>注意：</strong> 若需更簡易的圖形介面，請參見上方的 <a href="#web-ui-recommended" target="_blank" rel="noopener noreferrer">Web UI（推薦）</a> 章節。</p><p>執行 <code>inference.py</code> 並傳入一些參數以產生譜面。此處請使用 <a href="https://hydra.cc/docs/advanced/override_grammar/basic/" target="_blank" rel="noopener noreferrer">Hydra 覆蓋語法</a>。所有可用參數請參見 <code>configs/inference_v29.yaml</code>。</p><pre><code class="language-">python inference.py \
  audio_path           [Path to input audio] \
  output_path          [Path to output directory] \
  beatmap_path         [Path to .osu file to autofill metadata, and output_path, or use as reference] \
  
  gamemode             [Game mode to generate 0=std, 1=taiko, 2=ctb, 3=mania] \
  difficulty           [Difficulty star rating to generate] \
  mapper_id            [Mapper user ID for style] \
  year                 [Upload year to simulate] \
  hitsounded           [Whether to add hitsounds] \
  slider_multiplier    [Slider velocity multiplier] \
  circle_size          [Circle size] \
  keycount             [Key count for mania] \
  hold_note_ratio      [Hold note ratio for mania 0-1] \
  scroll_speed_ratio   [Scroll speed ratio for mania and ctb 0-1] \
  descriptors          [List of beatmap user tags for style] \
  negative_descriptors [List of beatmap user tags for classifier-free guidance] \
  
  add_to_beatmap       [Whether to add generated content to the reference beatmap instead of making a new beatmap] \
  start_time           [Generation start time in milliseconds] \
  end_time             [Generation end time in milliseconds] \
  in_context           [List of additional context to provide to the model [NONE,TIMING,KIAI,MAP,GD,NO_HS]] \
  output_type          [List of content types to generate] \
  cfg_scale            [Scale of the classifier-free guidance] \
  super_timing         [Whether to use slow accurate variable BPM timing generator] \
  seed                 [Random seed for generation] \</code></pre></p><p>範例：
<pre><code class="language-">python inference.py beatmap_path="'C:\Users\USER\AppData\Local\osu!\Songs\1 Kenji Ninuma - DISCO PRINCE\Kenji Ninuma - DISCOPRINCE (peppy) [Normal].osu'" gamemode=0 difficulty=5.5 year=2023 descriptors="['jump aim','clean']" in_context=[TIMING,KIAI]</code></pre></p><h2>互動式 CLI</h2>
對於偏好終端機工作流程但希望有引導式設定的用戶，互動式 CLI 指令稿是 Web UI 的絕佳替代方案。</p><h3>啟動 CLI</h3>
請移動到已複製的目錄。您可能需要先將指令稿設為可執行檔。</p><pre><code class="language-sh"># Make the script executable (only needs to be done once)
chmod +x cli_inference.sh</code></pre></p><pre><code class="language-sh"># Run the script
./cli_inference.sh</code></pre>
<h3>使用 CLI</h3>
此腳本會引導你通過一系列提示來配置所有生成參數，就像 Web UI 一樣。</p><p>它使用彩色編碼的介面以提高清晰度。
它提供進階的多選選單，可使用方向鍵和空白鍵選擇風格描述詞。
在你回答完所有問題後，它會顯示最終的命令供你審查。
你可以直接確認執行，或取消並複製命令以供手動使用。</p><h2>生成提示</h2></p><ul><li>你可以編輯 <code>configs/inference_v29.yaml</code> 並在其中添加你的參數，而無需每次都在終端機輸入。</li>
<li>所有可用的描述詞可在<a href="https://osu.ppy.sh/wiki/en/Beatmap/Beatmap_tags" target="_blank" rel="noopener noreferrer">這裡</a>找到。</li>
<li>請務必提供 2007 到 2023 年之間的年份參數。如果留空，模型可能會生成風格不一致的結果。</li>
<li>請務必提供難度參數。如果留空，模型可能會生成難度不一致的結果。</li>
<li>提高 <code>cfg_scale</code> 參數可提升 <code>mapper_id</code> 和 <code>descriptors</code> 參數的有效性。</li>
<li>你可以使用 <code>negative_descriptors</code> 參數來引導模型避免某些風格。這僅在 <code>cfg_scale > 1</code> 時有效。請確保負面描述詞的數量與描述詞相等。</li>
<li>如果你的歌曲風格和期望的譜面風格不太相符，模型可能無法按照你的指示生成。例如，對於一首平靜的歌，很難生成高 SR、高 SV 的譜面。</li>
<li>如果你已經為歌曲完成了 timing 和 kiai 時間，則可以將這些資訊提供給模型，大幅提升推理速度與準確性：使用 <code>beatmap_path</code> 和 <code>in_context=[TIMING,KIAI]</code> 參數。</li>
<li>若只想重製譜面的一部分，請使用 <code>beatmap_path</code>、<code>start_time</code>、<code>end_time</code> 和 <code>add_to_beatmap=true</code> 參數。</li>
<li>若要為一個譜面生成來賓難度，請使用 <code>beatmap_path</code> 和 <code>in_context=[GD,TIMING,KIAI]</code> 參數。</li>
<li>若要為譜面生成打擊音，請使用 <code>beatmap_path</code> 和 <code>in_context=[NO_HS,TIMING,KIAI]</code> 參數。</li>
<li>若只想為歌曲生成 timing，請使用 <code>super_timing=true</code> 和 <code>output_type=[TIMING]</code> 參數。</li></p><p></ul><h2>MaiMod：AI 驅動的 Modding 工具</h2></p><p>MaiMod 是一個針對 osu! 譜面的 modding 工具，利用 Mapperatorinator 的預測來發現其他自動化 modding 工具如 <a href="https://github.com/Naxesss/MapsetVerifier" target="_blank" rel="noopener noreferrer">Mapset Verifier</a> 無法偵測的潛在錯誤與不一致之處。
它可以偵測以下問題：
<ul><li>不正確的對齊或節奏型態</li>
<li>不準確的節奏點</li>
<li>不一致的物件位置或新連打組的分配</li>
<li>奇怪的滑條形狀</li>
<li>不一致的打擊音或音量</li></p><p></ul>你可以在<a href="https://colab.research.google.com/github/OliBomby/Mapperatorinator/blob/main/colab/mai_mod_inference.ipynb" target="_blank" rel="noopener noreferrer">這裡</a>試用 MaiMod，或在本地端執行：
若要在本地執行 MaiMod，你需要先安裝 Mapperatorinator。然後運行 <code>mai_mod.py</code> 腳本，並用 <code>beatmap_path</code> 參數指定你的譜面路徑。</p><pre><code class="language-sh">python mai_mod.py beatmap_path="'C:\Users\USER\AppData\Local\osu!\Songs\1 Kenji Ninuma - DISCO PRINCE\Kenji Ninuma - DISCOPRINCE (peppy) [Normal].osu'"</code></pre>
這會將改譜建議列印到主控台，接著你可以手動將其套用到你的譜面上。
建議會依時間順序排列並分門別類。
圓圈內的第一個數值代表「驚異值」，這是模型判斷該問題出乎意料程度的指標，因此你可以優先處理最重要的問題。</p><p>模型可能會出錯，特別是在驚異值較低的問題上，因此在套用建議到你的譜面前，務必再次確認。
主要目的是協助你縮小潛在問題的搜尋範圍，讓你不必手動檢查譜面中的每一個物件。</p><h3>MaiMod 圖形介面</h3>
若要執行 MaiMod Web UI，你需要先安裝 Mapperatorinator。
然後，執行 <code>mai_mod_ui.py</code> 腳本。這會啟動本地網頁伺服器並自動在新視窗開啟 UI：</p><pre><code class="language-sh">python mai_mod_ui.py</code></pre></p><p><img width="850" height="1019" alt="afbeelding" src="https://github.com/user-attachments/assets/67c03a43-a7bd-4265-a5b1-5e4d62aca1fa" /></p><h2>概覽</h2></p><h3>標記化</h3></p><p>Mapperatorinator 會將 osu! 的譜面轉換為中介事件表示，這種表示可以直接轉換為標記，或從標記轉換回來。
它包含擊打物件、擊打音效、滑條速度、新組合、計時點、Kiai 時間，以及太鼓/mania 的滾動速度。</p><p>以下是標記化過程的小範例：</p><p><img src="https://github.com/user-attachments/assets/84efde76-4c27-48a1-b8ce-beceddd9e695" alt="mapperatorinator_parser"></p><p>為了減少詞彙表的大小，時間事件會量化為 10 毫秒間隔，位置座標則量化至 32 像素的網格點。</p><h3>模型架構</h3>
本模型基本上是包裝在 <a href="https://huggingface.co/docs/transformers/en/model_doc/whisper#transformers.WhisperForConditionalGeneration" target="_blank" rel="noopener noreferrer">HF Transformers Whisper</a> 模型之上，並加入自訂的輸入嵌入與損失函數。
模型大小約為 2.19 億個參數。
實驗發現這個模型在此任務上比 T5 更快且更準確。</p><p>模型輸入輸出的高階概覽如下：</p><p><img src="https://user-images.githubusercontent.com/28675590/201044116-1384ad72-c540-44db-a285-7319dd01caad.svg" alt="Picture2"></p><p>模型使用梅爾頻譜圖幀作為編碼器輸入，每個輸入位置一個幀。模型的解碼器在每一步的輸出是針對離散、預先定義事件詞彙表的 softmax 分布。輸出是稀疏的，僅在有擊打物件發生時才需要事件，而不是標註每個音訊幀。</p><h3>多任務訓練格式</h3></p><p><img src="https://github.com/user-attachments/assets/62f490bc-a567-4671-a7ce-dbcc5f9cd6d9" alt="Multitask training format"></p><p>在 SOS 標記前會有額外的標記，用於輔助條件式生成。這些標記包含遊戲模式、難度、譜師 ID、年份及其他中繼資料。
訓練期間，這些標記沒有相應標籤，因此模型永遠不會輸出這些標記。
同時在訓練時，這些中繼資料標記有隨機機率會被「未知」標記取代，因此在推論時我們可以利用這些「未知」標記，減少必須提供給模型的中繼資料量。</p><h3>無縫長序列生成</h3></p><p>模型的上下文長度為 8.192 秒。顯然這不足以生成完整譜面，因此必須將歌曲切分為多個視窗，並分段生成譜面。
為確保生成的譜面在各視窗之間不會有明顯的縫隙，我們使用 90% 的重疊，並依序生成各視窗。
除第一個視窗外，每個生成視窗的解碼器都會預先填入前一視窗中最多 50% 的標記。
我們使用 logit 處理器來確保模型無法生成位於生成窗口前 50% 的時間標記。
此外，生成窗口的最後 40% 保留給下一個窗口。任何在該範圍內生成的時間標記都會被視為 EOS 標記。
這確保每個生成的標記都至少受到前 4 秒標記和後 3.3 秒音訊的條件影響，以便預測未來。</p><p>為了防止長時間生成過程中的偏移漂移，在訓練期間已隨機新增偏移至解碼器中的時間事件。
這迫使模型改以音訊中的起始點來修正時間錯誤，並能持續保持準確的偏移量。</p><h3>使用擴散精緻座標</h3></p><p>解碼器生成的位置座標會被量化到 32 像素的網格點，因此我們之後會利用擴散法去除雜訊以獲得最終座標。
為此，我們訓練了 <a href="https://github.com/OliBomby/osu-diffusion" target="_blank" rel="noopener noreferrer">osu-diffusion</a> 的修改版本，專門用於噪音時間表的最後 10%，且接受 Mapperatorinator 用於條件生成的更進階的中繼資料標記。</p><p>由於 Mapperatorinator 模型會輸出滑條的 SV，所需的滑條長度不論控制點路徑形狀都已固定。
因此，我們會引導擴散過程生成符合所需滑條長度的座標。
我們透過在每一步擴散過程後依據所需長度和當前控制點路徑重新計算滑條終點位置來達成這一點。
這表示擴散過程無法直接控制滑條終點位置，但仍能藉由變更控制點路徑來影響終點位置。</p><h3>後處理</h3></p><p>Mapperatorinator 會執行一些額外的後處理，以提升生成譜面的品質：</p><ul><li>使用擴散精緻位置座標。</li>
<li>使用模型生成的對齊因子將時間事件對齊到最近的節點。</li>
<li>對接近完美的重疊位置進行貼合。</li>
<li>將 mania 欄位事件轉換為 X 座標。</li>
<li>為太鼓滑棒生成滑條路徑。</li>
<li>修正滑條所需長度與控制點路徑長度間的大幅差異。</li></p><p></ul><h3>超級時間生成器</h3></p><p>超級時間生成器是一種演算法，能透過對整首歌推論 20 次時間並取平均來提升生成時間的精度與準確度。
這對於 BPM 變化的歌曲或有 BPM 變換的歌曲特別有用。結果幾乎完美，只有少數段落需要手動調整。</p><h2>訓練</h2></p><p>以下說明將在您的本地機器建立訓練環境。</p><h3>1. 複製儲存庫</h3></p><pre><code class="language-sh">git clone https://github.com/OliBomby/Mapperatorinator.git
cd Mapperatorinator</code></pre></p><h3>2. 建立資料集</h3></p><p>使用 <a href="https://github.com/mappingtools/Mapperator/blob/master/README.md#create-a-high-quality-dataset" target="_blank" rel="noopener noreferrer">Mapperator 主控台應用程式</a> 建立您自己的資料集。此應用程式需要一個 <a href="https://osu.ppy.sh/home/account/edit" target="_blank" rel="noopener noreferrer">osu! OAuth 客戶端權杖</a> 來驗證 beatmap 並取得額外的中繼資料。請將資料集放在與 <code>Mapperatorinator</code> 目錄相鄰的 <code>datasets</code> 目錄中。</p><pre><code class="language-sh">Mapperator.ConsoleApp.exe dataset2 -t "/Mapperatorinator/datasets/beatmap_descriptors.csv" -i "path/to/osz/files" -o "/datasets/cool_dataset"</code></pre></p><h3>3.（可選）設置 Weight & Biases 以進行日誌記錄</h3>
在 <a href="https://wandb.ai/site" target="_blank" rel="noopener noreferrer">Weight & Biases</a> 上創建帳戶，並從帳戶設置中取得您的 API 金鑰。
然後設置 <code>WANDB_API_KEY</code> 環境變數，以便訓練過程知道要記錄到這個金鑰。</p><pre><code class="language-sh">export WANDB_API_KEY=<your_api_key></code></pre></p><h3>4. 建立 Docker 容器</h3>
你也可以在你的 venv 中進行訓練，但我們建議在 WSL 上使用 Docker 以獲得更佳效能。
<pre><code class="language-sh">docker compose up -d --force-recreate
docker attach mapperatorinator_space
cd Mapperatorinator</code></pre></p><h3>5. 配置參數並開始訓練</h3></p><p>所有設定都位於 <code>./configs/train/default.yaml</code>。
請確保將 <code>train_dataset_path</code> 與 <code>test_dataset_path</code> 正確設定為您的資料集路徑，同時設定訓練/測試分割的起始與結束 mapset 索引。
該路徑是相對於 docker 容器的本地路徑，因此如果您將名為 <code>cool_dataset</code> 的資料集放在 <code>datasets</code> 目錄下，則路徑應為 <code>/workspace/datasets/cool_dataset</code>。</p><p>建議您建立自定義的設定檔來覆寫預設設定，這樣可以保留訓練設定以便重現。</p><pre><code class="language-yaml">data:
  train_dataset_path: "/workspace/datasets/cool_dataset"
  test_dataset_path: "/workspace/datasets/cool_dataset"
  train_dataset_start: 0
  train_dataset_end: 90
  test_dataset_start: 90
  test_dataset_end: 100</code></pre></p><p>Begin training by calling <code>python osuT5/train.py</code> or <code>torchrun --nproc_per_node=NUM_GPUS osuT5/train.py</code> for multi-GPU training.</p><pre><code class="language-sh">python osuT5/train.py -cn train_v29 train_dataset_path="/workspace/datasets/cool_dataset" test_dataset_path="/workspace/datasets/cool_dataset" train_dataset_end=90 test_dataset_start=90 test_dataset_end=100</code></pre></p><h3>6. LoRA 微調</h3></p><p>你也可以使用 <a href="https://arxiv.org/abs/2106.09685" target="_blank" rel="noopener noreferrer">LoRA</a> 微調預訓練模型，以適應特定的風格或遊戲模式。
為此，請依照需求調整 <code>configs/train/lora.yaml</code>，然後執行 <code>lora</code> 訓練配置：</p><pre><code class="language-sh">python osuT5/train.py -cn lora train_dataset_path="/workspace/datasets/cool_dataset" test_dataset_path="/workspace/datasets/cool_dataset" train_dataset_end=90 test_dataset_start=90 test_dataset_end=100</code></pre>
重要的 LoRA 參數需考慮：
<ul><li><code>pretrained_path</code>：要微調的基礎模型路徑或 Hugging Face 倉庫。</li>
<li><code>r</code>：LoRA 矩陣的秩。較高的值增加模型容量但同時增加內存用量。</li>
<li><code>lora_alpha</code>：LoRA 更新的縮放因子。</li>
<li><code>total_steps</code>：訓練步數總量。請根據資料集大小進行平衡。</li>
<li><code>enable_lora</code>：是否啟用 LoRA 或全模型微調。</li></p><p></ul>在推論期間，你可以通過 <code>lora_path</code> 參數指定要使用的 LoRA 權重。
這可以是本地路徑或 Hugging Face 倉庫。</p><h2>另見</h2>
<ul><li><a href="https://raw.githubusercontent.com/OliBomby/Mapperatorinator/main/./classifier/README.md" target="_blank" rel="noopener noreferrer">Mapper 分類器</a></li>
<li><a href="https://raw.githubusercontent.com/OliBomby/Mapperatorinator/main/./rcomplexion/README.md" target="_blank" rel="noopener noreferrer">RComplexion</a></li></p><p></ul><h2>鳴謝</h2></p><p>特別感謝：
<ul><li><a href="https://github.com/gyataro/osuT5" target="_blank" rel="noopener noreferrer">osuT5</a> 作者提供訓練程式碼。</li>
<li>Hugging Face 團隊提供的<a href="https://huggingface.co/docs/transformers/index" target="_blank" rel="noopener noreferrer">工具</a>。</li>
<li><a href="https://github.com/jaswon" target="_blank" rel="noopener noreferrer">Jason Won</a> 和 <a href="https://github.com/sedthh" target="_blank" rel="noopener noreferrer">Richard Nagyfi</a> 交流想法。</li>
<li><a href="https://github.com/minetoblend" target="_blank" rel="noopener noreferrer">Marvin</a> 捐贈訓練點數。</li>
<li>osu! 社群提供 beatmap 資源。</li></p><p></ul><h2>相關作品</h2></p><ul><li><a href="https://github.com/Syps/osu_beatmap_generator" target="_blank" rel="noopener noreferrer">osu! Beatmap Generator</a> - Syps (Nick Sypteras) 製作</li>
<li><a href="https://github.com/kotritrona/osumapper" target="_blank" rel="noopener noreferrer">osumapper</a> - kotritrona, jyvden, Yoyolick (Ryan Zmuda) 製作</li>
<li><a href="https://github.com/OliBomby/osu-diffusion" target="_blank" rel="noopener noreferrer">osu-diffusion</a> - OliBomby (Olivier Schipper), NiceAesth (Andrei Baciu) 製作</li>
<li><a href="https://github.com/gyataro/osuT5" target="_blank" rel="noopener noreferrer">osuT5</a> - gyataro (Xiwen Teoh) 製作</li>
<li><a href="https://github.com/sedthh/BeatLearning" target="_blank" rel="noopener noreferrer">Beat Learning</a> - sedthh (Richard Nagyfi) 製作</li>
<li><a href="https://github.com/jaswon/osu-dreamer" target="_blank" rel="noopener noreferrer">osu!dreamer</a> - jaswon (Jason Won) 製作</li></p><p>

</ul>---

Tranlated By <a href="https://github.com/OpenAiTx/OpenAiTx" target="_blank" rel="noopener noreferrer">Open Ai Tx</a> | Last indexed: 2026-01-24

---</p>
        </div>
        
        <div class="original-link">
            <strong>Original README:</strong> <a href="https://raw.githubusercontent.com/OliBomby/Mapperatorinator/main/README.md" target="_blank" rel="noopener noreferrer">View on GitHub</a>
        </div>
    </div>
    
    <div class="footer">
        <p>Translated by <a href="https://github.com/OpenAiTx/OpenAiTx" target="_blank" rel="noopener noreferrer">OpenAiTx</a> | 
        Last updated: 2026-01-24 
    </div>
    
</body>
</html>