<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mirror - Mirror es un paquete elegante de suplantaci&#243;n de usuarios para Laravel. Permite a los administradores iniciar sesi&#243;n como otros usuarios de forma fluida para resolver problemas, brindar soporte o probar experiencias de usuario.</title>
    <meta name="description" content="Mirror es un paquete elegante de suplantaci&#243;n de usuarios para Laravel. Permite a los administradores iniciar sesi&#243;n como otros usuarios de forma fluida para resolver problemas, brindar soporte o probar experiencias de usuario.">
    <meta name="keywords" content="mirror, Spanish, documentation, GitHub, open source">
    <meta name="author" content="OpenAiTx">
    <meta name="robots" content="index, follow">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "mirror",
  "description": "Mirror es un paquete elegante de suplantación de usuarios para Laravel. Permite a los administradores iniciar sesión como otros usuarios de forma fluida para resolver problemas, brindar soporte o probar experiencias de usuario.",
  "author": {
    "@type": "Person",
    "name": "franbarbalopez"
  },
  "applicationCategory": "DeveloperApplication",
  "operatingSystem": "Any",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "5",
    "ratingCount": 73
  },
  "url": "https://OpenAiTx.github.io/projects/franbarbalopez/mirror/README-es.html",
  "sameAs": "https://raw.githubusercontent.com/franbarbalopez/mirror/master/README.md",
  "datePublished": "2025-12-06",
  "dateModified": "2025-12-06"
}
    </script>
    
    <!-- GitHub-style CSS -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #24292e;
            background-color: #ffffff;
            max-width: 980px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .container {
            background: #ffffff;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 24px;
            margin-bottom: 20px;
        }
        
        .header {
            border-bottom: 1px solid #e1e4e8;
            padding-bottom: 16px;
            margin-bottom: 24px;
        }
        
        .project-title {
            font-size: 2em;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .project-title a {
            color: #24292e;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: color 0.2s ease;
        }
        
        .project-title a:hover {
            color: #0366d6;
            text-decoration: none;
        }
        
        .project-title .github-icon {
            width: 1em;
            height: 1em;
            fill: currentColor;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }
        
        .project-title a:hover .github-icon {
            opacity: 1;
        }
        
        .project-meta {
            color: #586069;
            font-size: 14px;
            margin-bottom: 16px;
        }
        
        .stars {
            display: inline-block;
            margin-right: 16px;
        }
        
        .language {
            display: inline-block;
            background-color: #f1f8ff;
            color: #0366d6;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .content {
            font-size: 16px;
            line-height: 1.6;
        }
        
        h1, h2, h3, h4, h5, h6 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
            color: #24292e;
        }
        
        h1 { font-size: 2em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        h3 { font-size: 1.25em; }
        
        p {
            margin-bottom: 16px;
        }
        
        code {
            background-color: #f6f8fa;
            border-radius: 3px;
            font-size: 85%;
            margin: 0;
            padding: 0.2em 0.4em;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }
        
        pre {
            background-color: #f6f8fa;
            border-radius: 6px;
            font-size: 85%;
            line-height: 1.45;
            overflow: auto;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        pre code {
            background-color: transparent;
            border: 0;
            display: inline;
            line-height: inherit;
            margin: 0;
            overflow: visible;
            padding: 0;
            word-wrap: normal;
        }
        
        a {
            color: #0366d6;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        ul, ol {
            margin-bottom: 16px;
            padding-left: 2em;
        }
        
        li {
            margin-bottom: 0.25em;
        }
        
        blockquote {
            border-left: 4px solid #dfe2e5;
            color: #6a737d;
            margin: 0 0 16px 0;
            padding: 0 1em;
        }
        
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e1e4e8;
            color: #586069;
            font-size: 14px;
            text-align: center;
        }
        
        .footer a {
            color: #0366d6;
        }
        
        .original-link {
            margin-top: 16px;
            padding: 12px;
            background-color: #f6f8fa;
            border-radius: 6px;
            border: 1px solid #e1e4e8;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 16px;
            }
            
            .project-title {
                font-size: 1.5em;
            }
        }
    </style>
    
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <!-- Bing Count -->
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "sh95yd6uwt");
    </script>        

    <!-- Statcounter -->
    <script type="text/javascript">
        var sc_project = 13142514;
        var sc_invisible = 1;
        var sc_security = "d03a31d8"; 
    </script>
    <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script>
    <noscript>
        <div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img
                    class="statcounter" src="https://c.statcounter.com/13142514/0/d03a31d8/1/" alt="Web Analytics"
                    referrerPolicy="no-referrer-when-downgrade"></a></div>
    </noscript>    
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="project-title">
                <a href="https://github.com/franbarbalopez/mirror" target="_blank" rel="noopener noreferrer">
                    <svg class="github-icon" viewBox="0 0 16 16" aria-hidden="true">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
                    </svg>
                    mirror
                </a>
            </h1>
            <div class="project-meta">
                <span class="stars">⭐ 73 stars</span>
                <span class="language">Spanish</span>
                <span>by franbarbalopez</span>
            </div>
        </div>
        
        <div class="content">
            <p><img src="https://raw.githubusercontent.com/franbarbalopez/mirror/master/art/logo.png" alt="Mirror Logo"></p><p><div align="center">
    <img alt="Última Versión en Packagist" src="https://img.shields.io/packagist/v/franbarbalopez/mirror.svg">
    <img alt="Estado de Acciones de Pruebas en GitHub" src="https://img.shields.io/github/actions/workflow/status/franbarbalopez/mirror/tests.yml?label=tests">
    <img alt="Descargas Totales" src="https://img.shields.io/packagist/dt/franbarbalopez/mirror.svg">
    <img alt="Licencia" src="https://img.shields.io/packagist/l/franbarbalopez/mirror.svg">
</div></p><h1>Mirror</h1></p><p>Mirror es un paquete elegante de suplantación de usuario para Laravel. Permite a los administradores iniciar sesión como otros usuarios sin problemas para solucionar problemas, brindar soporte o probar experiencias de usuario. Mirror maneja la integridad de la sesión con verificación criptográfica, expiración automática, soporte multi-guard, middleware flexible y eventos de ciclo de vida para el registro de auditoría. Perfecto para aplicaciones en producción que necesitan una suplantación de usuario confiable y segura.</p><h2>Características</h2></p><ul><li>Integridad de sesión HMAC-SHA256 para prevenir manipulaciones</li>
<li>Expiración TTL configurable</li>
<li>Middleware para control de acceso y aplicación de TTL</li>
<li>Soporte multi-guard</li>
<li>Redirección de URL flexible</li>
<li>Eventos de ciclo de vida para registro de auditoría</li></p><p></ul><h2>Requisitos</h2></p><ul><li>PHP 8.2+</li>
<li>Laravel 11+</li></p><p></ul><h2>Instalación</h2></p><pre><code class="language-bash">composer require franbarbalopez/mirror</code></pre>
Opcional - publicar el archivo de configuración:</p><pre><code class="language-bash">php artisan vendor:publish --tag=mirror</code></pre></p><h2>Inicio Rápido</h2></p><h3>1. Agregar Trait al Modelo de Usuario</h3></p><pre><code class="language-php">use Illuminate\Foundation\Auth\User as Authenticatable;
use Mirror\Concerns\Impersonatable;</p><p>class User extends Authenticatable
{
    use Impersonatable;</p><p>    public function canImpersonate(): bool
    {
        return $this->hasRole('admin');
    }</p><p>    public function canBeImpersonated(): bool
    {
        return ! $this->hasRole('super-admin');
    }
}</code></pre></p><p><strong>Importante:</strong> Si no implementas <code>canImpersonate()</code>, todos pueden suplantar a todos. El trait devuelve <code>true</code> por defecto.</p><h3>2. Comenzar a suplantar</h3></p><pre><code class="language-php">use Mirror\Facades\Mirror;</p><p>public function impersonate(User $user)
{
    Mirror::start($user);</p><p>    return redirect()->route('dashboard');
}</code></pre></p><h3>3. Deja de suplantar identidad</h3></p><pre><code class="language-php">public function leave()
{
    Mirror::stop();</p><p>    return redirect()->route('admin.users.index');
}</code></pre></p><h2>Seguridad</h2></p><p>Las sesiones de suplantación están protegidas con hashes HMAC-SHA256 usando la clave de tu aplicación. El hash cubre el ID del suplantador, el nombre del guardia, la hora de inicio y la URL de redirección. En cada llamada a <code>stop()</code>, Mirror verifica este hash; si alguien ha manipulado la sesión, lanza una excepción y borra todo.</p><p>Configura el TTL en <code>config/mirror.php</code> para que las sesiones expiren automáticamente después de un tiempo establecido.</p><h2>Referencia de la API</h2></p><h3>Iniciar Suplantación</h3></p><p>Por instancia de usuario:</p><pre><code class="language-php">Mirror::start($user);</p><p>// With redirect URLs
$redirectUrl = Mirror::start(
    user: $targetUser,
    leaveRedirectUrl: route('admin.users.index'),
    startRedirectUrl: route('dashboard')
);</p><p>return redirect($redirectUrl);</code></pre></p><p>Por clave primaria (funciona con int, UUID, ULID, etc.):</p><pre><code class="language-php">Mirror::startByKey(123);</p><p>Mirror::startByKey('550e8400-e29b-41d4-a716-446655440000');</code></pre></p><p>Por correo electrónico:</p><pre><code class="language-php">Mirror::startByEmail('user@example.com');</code></pre></p><h3>Detener la suplantación</h3></p><pre><code class="language-php">Mirror::stop();</p><p>// Force stop - bypasses TTL check but still verifies integrity
Mirror::forceStop();</code></pre></p><p>Use <code>forceStop()</code> cuando necesite terminar la suplantación desde acciones de administrador o scripts de limpieza - omite la verificación de TTL pero aún lanza un error si la sesión ha sido manipulada.</p><h3>Comprobación del estado</h3></p><pre><code class="language-php">Mirror::isImpersonating(): bool
Mirror::getImpersonator(): ?Authenticatable
Mirror::impersonatorId(): int|string|null
Mirror::getLeaveRedirectUrl(): ?string</code></pre></p><h3>Alias</h3></p><pre><code class="language-php">Mirror::as($user);           // same as start()
Mirror::leave();             // same as stop()
Mirror::impersonating();     // same as isImpersonating()
Mirror::impersonator();      // same as getImpersonator()</code></pre></p><h2>Middleware</h2></p><h3><code>mirror.ttl</code></h3></p><p>Comprueba si la sesión de suplantación ha expirado y llama automáticamente a <code>stop()</code> si es necesario:</p><pre><code class="language-php">Route::middleware('mirror.ttl')->group(function () {
    Route::get('/admin/users', [UserController::class, 'index']);
    Route::get('/admin/users/{user}', [UserController::class, 'show']);
});</code></pre></p><p>Bueno para proteger áreas administrativas sensibles donde deseas que las sesiones expiradas terminen de manera elegante. Ten en cuenta que cuando el TTL expira, este middleware finalizará la suplantación y redirigirá, así que asegúrate de que la limpieza de tu sesión esté configurada correctamente.</p><h3><code>mirror.require</code></h3></p><p>Solo permite el acceso si se está suplantando activamente:</p><pre><code class="language-php">Route::middleware('mirror.require')->group(function () {
    Route::get('/impersonation/banner', function () {
        return view('impersonation.banner');
    });
});</code></pre></p><p>Útil para componentes de UI especiales que solo tienen sentido durante la suplantación, como un banner que muestra a quién estás suplantando.</p><h3><code>mirror.prevent</code></h3></p><p>Bloquea el acceso mientras se está suplantando:</p><pre><code class="language-php">Route::middleware('mirror.prevent')->group(function () {
    Route::post('/admin/users/{user}/delete', [UserController::class, 'destroy']);
    Route::get('/admin/settings', [SettingsController::class, 'edit']);
});</code></pre></p><p>Protege acciones destructivas o configuraciones sensibles que solo deben ser accesibles como el usuario original, no mientras se está suplantando a otra persona.</p><h2>Autorización</h2></p><p>El trait <code>Impersonatable</code> proporciona dos métodos que ambos retornan <code>true</code> por defecto. Sobrescríbelos para agregar tu propia lógica:</p><pre><code class="language-php">use Mirror\Concerns\Impersonatable;</p><p>class User extends Authenticatable
{
    use Impersonatable;</p><p>    public function canImpersonate(): bool
    {
        return $this->hasRole('admin');
    }</p><p>    public function canBeImpersonated(): bool
    {
        return ! $this->hasRole('super-admin');
    }
}</code></pre></p><p>No necesitas el trait: Mirror buscará estos métodos en tu modelo de usuario independientemente:</p><pre><code class="language-php">class User extends Authenticatable
{
    public function canImpersonate(): bool
    {
        return $this->hasPermission('impersonate-users');
    }</p><p>    public function canBeImpersonated(): bool
    {
        return ! $this->is_system_account;
    }
}</code></pre></p><h2>Redirección de URL</h2></p><p>Puedes controlar a dónde van los usuarios al iniciar y detener la suplantación:</p><pre><code class="language-php">public function impersonate(User $user)
{
    $redirectUrl = Mirror::start(
        user: $user,
        leaveRedirectUrl: route('admin.users.index'),  // where to go when they stop
        startRedirectUrl: route('dashboard')            // where to go right now
    );</p><p>    return redirect($redirectUrl);
}</p><p>public function leave()
{
    Mirror::stop();</p><p>    return redirect(Mirror::getLeaveRedirectUrl());
}</code></pre>
Si no especificas <code>leaveRedirectUrl</code>, se usará por defecto la URL actual donde se llamó a <code>start()</code>.</p><h2>Eventos</h2></p><p>Mirror envía dos eventos a los que puedes suscribirte:</p><ul><li><code>Mirror\Events\ImpersonationStarted</code></li>
<li><code>Mirror\Events\ImpersonationStopped</code></li></p><p></ul>Ambos eventos contienen al suplantador, al usuario objetivo y el nombre del guardia. Útil para registros de auditoría o para activar flujos de trabajo.</p><p>Los eventos se envían <strong>después de que la respuesta</strong> se envía al cliente, asegurando que las operaciones críticas de suplantación se completen sin demora. Esto es especialmente importante para middleware como <code>mirror.ttl</code> que puede ejecutarse en cada solicitud.</p><pre><code class="language-php">use Mirror\Events\ImpersonationStarted;</p><p>Event::listen(ImpersonationStarted::class, function (ImpersonationStarted $event) {
    // Log the activity to your audit system of choice
    Log::info('User impersonation started', [
        'impersonator_id' => $event->impersonator->id,
        'impersonated_id' => $event->impersonated->id,
        'guard' => $event->guardName,
    ]);
});</code></pre></p><h2>Rendimiento y Optimización</h2></p><p>Mirror está optimizado para aplicaciones de alto rendimiento:</p><h3>Caché con Ámbito de Solicitud</h3></p><p>El modelo de suplantación se almacena en caché dentro de una única solicitud para evitar consultas redundantes a la base de datos:</p><pre><code class="language-php">// This first call will query the database
$impersonator = Mirror::getImpersonator();</p><p>// Subsequent calls in the same request use the cached instance, therefore this one will not:
$impersonator = Mirror::getImpersonator();</code></pre></p><p>Esto es particularmente beneficioso para middleware como <code>mirror.ttl</code> que se ejecutan en cada solicitud.</p><h3>Despacho Diferido de Eventos</h3></p><p>Los eventos de suplantación se despachan después de que la respuesta se envía al cliente, asegurando que los escuchas de eventos no afecten el tiempo de respuesta. Esto mantiene rápido tu ciclo de solicitud mientras permite el registro de auditorías y otras tareas en segundo plano.</p><h2>Soporte Multi-Guard</h2></p><p>Mirror detecta automáticamente qué guardia estás usando:</p><pre><code class="language-php">Auth::guard('admin')->login($admin);</p><p>Mirror::start($user); // uses 'admin' guard</p><p>Mirror::stop(); // restores to 'admin' guard</code></pre></p><p>No necesitas especificar el guard manualmente: lo determina a partir del contexto de autenticación actual.</p><h2>Directivas de Blade</h2></p><p><strong>@impersonating</strong></p><pre><code class="language-blade">@impersonating
    <div class="alert">
        You're impersonating {{ auth()->user()->name }}.
        <a href="{{ route('impersonation.leave') }}">Exit</a>
    </div>
@endimpersonating</p><p>{{-- Check specific guard --}}
@impersonating('admin')
    <div>Impersonating via admin guard</div>
@endimpersonating</code></pre></p><p><strong>@puedoPersonificar</strong></p><pre><code class="language-blade">@canImpersonate
    <a href="{{ route('admin.users.index') }}">Manage Users</a>
@endcanImpersonate</p><p>{{-- With guard --}}
@canImpersonate('admin')
    <div>Admin tools</div>
@endcanImpersonate</code></pre></p><p><strong>@puedeSerSuplantado</strong></p><pre><code class="language-blade">{{-- Check current user --}}
@canBeImpersonated
    <span>Available for support</span>
@endcanBeImpersonated</p><p>{{-- Check specific user --}}
@canBeImpersonated($user)
    <form method="POST" action="{{ route('impersonation.start', $user) }}">
        @csrf
        <button>Impersonate</button>
    </form>
@endcanBeImpersonated</p><p>{{-- With guard --}}
@canBeImpersonated($user, 'admin')
    <button>Login as this user</button>
@endcanBeImpersonated</code></pre></p><h2>Licencia</h2></p><p>MIT. Ver <a href="https://raw.githubusercontent.com/franbarbalopez/mirror/master/LICENSE.md" target="_blank" rel="noopener noreferrer">LICENSE.md</a>.</p><h2>Créditos</h2></p><p>Desarrollado por <a href="https://github.com/franbarbalopez" target="_blank" rel="noopener noreferrer">franbarbalopez</a>.</p><p>
---

Tranlated By <a href="https://github.com/OpenAiTx/OpenAiTx" target="_blank" rel="noopener noreferrer">Open Ai Tx</a> | Last indexed: 2025-12-06

---</p>
        </div>
        
        <div class="original-link">
            <strong>Original README:</strong> <a href="https://raw.githubusercontent.com/franbarbalopez/mirror/master/README.md" target="_blank" rel="noopener noreferrer">View on GitHub</a>
        </div>
    </div>
    
    <div class="footer">
        <p>Translated by <a href="https://github.com/OpenAiTx/OpenAiTx" target="_blank" rel="noopener noreferrer">OpenAiTx</a> | 
        Last updated: 2025-12-06 
    </div>
    
</body>
</html>