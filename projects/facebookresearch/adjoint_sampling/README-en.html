<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>adjoint_sampling - Read adjoint_sampling documentation in English. This project has 109 stars on GitHub.</title>
    <meta name="description" content="Read adjoint_sampling documentation in English. This project has 109 stars on GitHub.">
    <meta name="keywords" content="adjoint_sampling, English, documentation, GitHub, open source">
    <meta name="author" content="OpenAiTx">
    <meta name="robots" content="index, follow">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "adjoint_sampling",
  "description": "Read adjoint_sampling documentation in English. This project has 109 stars on GitHub.",
  "author": {
    "@type": "Person",
    "name": "facebookresearch"
  },
  "applicationCategory": "DeveloperApplication",
  "operatingSystem": "Any",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "5",
    "ratingCount": 109
  },
  "url": "https://OpenAiTx.github.io/projects/facebookresearch/adjoint_sampling/README-en.html",
  "sameAs": "https://raw.githubusercontent.com/facebookresearch/adjoint_sampling/main/README.md",
  "datePublished": "2025-07-24",
  "dateModified": "2025-07-24"
}
    </script>
    
    <!-- GitHub-style CSS -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #24292e;
            background-color: #ffffff;
            max-width: 980px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .container {
            background: #ffffff;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 24px;
            margin-bottom: 20px;
        }
        
        .header {
            border-bottom: 1px solid #e1e4e8;
            padding-bottom: 16px;
            margin-bottom: 24px;
        }
        
        .project-title {
            font-size: 2em;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .project-title a {
            color: #24292e;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: color 0.2s ease;
        }
        
        .project-title a:hover {
            color: #0366d6;
            text-decoration: none;
        }
        
        .project-title .github-icon {
            width: 1em;
            height: 1em;
            fill: currentColor;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }
        
        .project-title a:hover .github-icon {
            opacity: 1;
        }
        
        .project-meta {
            color: #586069;
            font-size: 14px;
            margin-bottom: 16px;
        }
        
        .stars {
            display: inline-block;
            margin-right: 16px;
        }
        
        .language {
            display: inline-block;
            background-color: #f1f8ff;
            color: #0366d6;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .content {
            font-size: 16px;
            line-height: 1.6;
        }
        
        h1, h2, h3, h4, h5, h6 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
            color: #24292e;
        }
        
        h1 { font-size: 2em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        h3 { font-size: 1.25em; }
        
        p {
            margin-bottom: 16px;
        }
        
        code {
            background-color: #f6f8fa;
            border-radius: 3px;
            font-size: 85%;
            margin: 0;
            padding: 0.2em 0.4em;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }
        
        pre {
            background-color: #f6f8fa;
            border-radius: 6px;
            font-size: 85%;
            line-height: 1.45;
            overflow: auto;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        pre code {
            background-color: transparent;
            border: 0;
            display: inline;
            line-height: inherit;
            margin: 0;
            overflow: visible;
            padding: 0;
            word-wrap: normal;
        }
        
        a {
            color: #0366d6;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        ul, ol {
            margin-bottom: 16px;
            padding-left: 2em;
        }
        
        li {
            margin-bottom: 0.25em;
        }
        
        blockquote {
            border-left: 4px solid #dfe2e5;
            color: #6a737d;
            margin: 0 0 16px 0;
            padding: 0 1em;
        }
        
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e1e4e8;
            color: #586069;
            font-size: 14px;
            text-align: center;
        }
        
        .footer a {
            color: #0366d6;
        }
        
        .original-link {
            margin-top: 16px;
            padding: 12px;
            background-color: #f6f8fa;
            border-radius: 6px;
            border: 1px solid #e1e4e8;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 16px;
            }
            
            .project-title {
                font-size: 1.5em;
            }
        }
    </style>
    
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <!-- Bing Count -->
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "sh95yd6uwt");
    </script>        

    <!-- Statcounter -->
    <script type="text/javascript">
        var sc_project = 13142514;
        var sc_invisible = 1;
        var sc_security = "d03a31d8"; 
    </script>
    <script type="text/javascript" src="https://www.statcounter.com/counter/counter.js" async></script>
    <noscript>
        <div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img
                    class="statcounter" src="https://c.statcounter.com/13142514/0/d03a31d8/1/" alt="Web Analytics"
                    referrerPolicy="no-referrer-when-downgrade"></a></div>
    </noscript>    
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="project-title">
                <a href="https://github.com/facebookresearch/adjoint_sampling" target="_blank" rel="noopener noreferrer">
                    <svg class="github-icon" viewBox="0 0 16 16" aria-hidden="true">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
                    </svg>
                    adjoint_sampling
                </a>
            </h1>
            <div class="project-meta">
                <span class="stars">⭐ 109 stars</span>
                <span class="language">English</span>
                <span>by facebookresearch</span>
            </div>
        </div>
        
        <div class="content">
            <h1>Adjoint Sampling</h1></p><p>This repository contains the official implementation and experiments for Adjoint Sampling: Highly Scalable Diffusion
Samplers via Adjoint Matching.</p><p>Adjoint Sampling is a highly scalable diffusion-based sampling framework that learns to sample from unnormalized densities without any reference data. Adjoint Sampling is scalable with respect to the complexity of both the generative model and the energy function, allowing the use of state-of-the-art neural energy functions.</p><p><strong><a href="https://arxiv.org/abs/2504.11713" target="_blank" rel="noopener noreferrer">Arxiv</a> (Accepted in ICML 2025)</strong>  
<em>Authors: _Aaron Havens, Benjamin Kurt Miller, Bing Yan, Carles Domingo-Enrich, Anuroop Sriram, Brandon Wood, Daniel Levine, Bin Hu, Brandon Amos, Brian Karrer, Xiang Fu, Guan-Horng Liu, Ricky T. Q. Chen_</em></p><p><img src="https://raw.githubusercontent.com/facebookresearch/adjoint_sampling/main/./assets/molecule_progression.png" alt=""></p><p>We evaluate Adjoint Sampling on a new amortized conformer generation task using eSEN energy function and SPICE: A large-scale dataset of organic, drug-like molecules that provides molecular graph information—including atomic species and bond structure.</p><h2>Installation</h2></p><p>Install dependencies.
<pre><code class="language-bash">micromamba env create -f environment.yml
micromamba activate adjoint_sampling</code></pre>
To train against an energy model, you will need the <a href="https://arxiv.org/abs/2502.12147" target="_blank" rel="noopener noreferrer">eSEN</a> checkpoint in our <a href="https://huggingface.co/facebook/adjoint_sampling" target="_blank" rel="noopener noreferrer">Hugging Face repository</a>. This will download automatically as you run the code, as long as you provide the <code>huggingface-cli</code> with a <a href="https://huggingface.co/settings/tokens" target="_blank" rel="noopener noreferrer">token</a>. You must first <a href="https://huggingface.co/facebook/adjoint_sampling" target="_blank" rel="noopener noreferrer">apply for access to the repo</a> before the token will work.</p><pre><code class="language-bash">huggingface-cli login</code></pre>
<h2>Data</h2></p><p>The molecules are organized into rows in <code>data/{drugs_test,spice_test,spice_train}.txt</code> with three columns: Number of rotatable bonds, SMILES string, and hash. Finding the <a href="https://github.com/crest-lab/crest" target="_blank" rel="noopener noreferrer">CREST</a> conformers for a molecule requires the hash. For a <code>{drugs,spice}</code> molecule with a <code>${hash}</code>, the conformers are written as concatenated <code>.xyz</code> blocks in a single text file below the directory <code>data/{drugs,spice}_test_conformers/${hash}</code>.</p><p>The conformers in <code>drugs</code> are from <a href="https://github.com/learningmatter-mit/geom" target="_blank" rel="noopener noreferrer">GEOM</a>. The conformers in <code>spice</code> were computed by FAIR Chemistry.</p><h2>Models</h2></p><p>All of our models are hosted on <a href="https://huggingface.co/facebook/adjoint_sampling" target="_blank" rel="noopener noreferrer">Hugging Face</a>. We provide a script to download the files to local directory <code>models</code>. Downloading models requires you to have a <a href="https://huggingface.co/settings/tokens" target="_blank" rel="noopener noreferrer">token</a>. You must first <a href="https://huggingface.co/facebook/adjoint_sampling" target="_blank" rel="noopener noreferrer">apply for access to the repo</a> before downloading.</p><pre><code class="language-bash">python download_models.py</code></pre>
Once the models are downloaded, you can copy the path for use in evaluation or for your own projects. The checkpoints can be identified:</p><pre><code class="language-">Cartesian AdjSampling             -   models/am/checkpoints/checkpoint_4999.pt
Cartesian AdjSampling (+pretrain) -   models/bmam/checkpoints/checkpoint_4999.pt
Torsional AdjSampling             -   models/torsion/checkpoints/checkpoint_3000.pt</p><p>Pretrained Cartesian              -   pretrain_for_bmam/checkpoints/checkpoint_2000.pt</code></pre>
We provide <code>Pretrained Cartesian</code> for the purposes of training <code>Cartesian AdjSampling (+pretrain)</code>.</p><h2>Training on the SPICE dataset</h2></p><p>We trained each model using 8 GPUs over 72 hours. These commands will train the corresponding model.</p><p>Run the following commands on a single node with many CPUs <strong>before</strong> starting training! The second one is only necessary if you would like to train the Torsional AdjSampling model.
<pre><code class="language-bash">python cache_dataset.py
python cache_dataset.py --learn_torsions</code></pre>
Our repository allows distributed training where shared files are put into a shared directory, known in the config as <code>shared_dir</code>. It is set as <code>/home/${oc.env:USER}</code> by default. It evaluates to <code>/home/${USER}</code> for training due to <a href="https://hydra.cc/docs/intro/" target="_blank" rel="noopener noreferrer">hydra</a>'s variable expansion syntax.</p><p>##### Cartesian AdjSampling</p><pre><code class="language-bash">python train.py experiment=spice_cartesian</code></pre>
##### Cartesian AdjSampling (+pretrain)</p><p>This model requires sequential training. First, you must train the "pretrained" model using the first command. Then, you need to direct the second model to initialize from the first model with <code>init_model=...</code> pointing to the initial checkpoint. No error is raised if you fail to point to an <code>init_model</code>, but the model will not be pretrained.</p><pre><code class="language-bash">python train.py experiment=spice_cartesian_pretrain_for_bmam
python train.py experiment=spice_cartesian_bmam init_model=???</code></pre>
##### Torsional AdjSampling</p><pre><code class="language-bash">python train.py experiment=spice_torsion</code></pre>
<h2>Evaluation</h2>
To evaluate the trained model, use <code>eval.py</code>. Reported results set <code>max_n_refs</code> to 512.</p><pre><code class="language-bash">python eval.py \
--test_mols data/spice_test.txt \
--true_confs data/spice_test_conformers \
--save_path results \
--checkpoint_path path/to/checkpoint.pt \
--max_n_refs 512</code></pre>
It is possible to evaluate in a distributed manner as well, check out <code>eval_distributed.sh</code>.</p><h2>📚 Citation</h2></p><p>If you find this code useful in your research or projects, please consider citing our research paper:</p><pre><code class="language-bibtex">@article{adjoint_sampling,
  title={{A}djoint {S}ampling: Highly Scalable Diffusion Samplers via {A}djoint {M}atching},
  author={Havens, Aaron and Miller, Benjamin Kurt and Yan, Bing and Domingo-Enrich, Carles and Sriram, Anuroop and Wood, Brandon and Levine, Daniel and Hu, Bin and Amos, Brandon and Karrer, Brian and Fu, Xiang and Liu, Guan-Horng and Chen, Ricky T. Q.},
  journal={International Conference on Machine Learning},
  year={2025}
}</code></pre>
<h2>License</h2>
This repository is licensed under the
<a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener noreferrer">CC BY-NC 4.0 License</a>.</p><h3>Notice</h3>
The majority of Adjoint Sampling is licensed under CC-BY-NC, however portions of the project are available under separate license terms: <a href="https://github.com/jarridrb/DEM" target="_blank" rel="noopener noreferrer">DEM</a>, <a href="https://github.com/vgsatorras/egnn" target="_blank" rel="noopener noreferrer">EGNN</a>, <a href="https://github.com/gcorso/torsional-diffusion" target="_blank" rel="noopener noreferrer">torsional-diffusion</a>, <a href="https://github.com/FAIR-Chem/fairchem" target="_blank" rel="noopener noreferrer">fairchem</a> are licensed under the MIT license. <a href="https://github.com/openmm/spice-dataset" target="_blank" rel="noopener noreferrer">SPICE</a> and <a href="https://github.com/learningmatter-mit/geom" target="_blank" rel="noopener noreferrer">GEOM</a> are licensed under the CC0 license.</p><p>

---

Tranlated By <a href="https://github.com/OpenAiTx/OpenAiTx" target="_blank" rel="noopener noreferrer">Open Ai Tx</a> | Last indexed: 2025-07-18

---</p>
        </div>
        
        <div class="original-link">
            <strong>Original README:</strong> <a href="https://raw.githubusercontent.com/facebookresearch/adjoint_sampling/main/README.md" target="_blank" rel="noopener noreferrer">View on GitHub</a>
        </div>
    </div>
    
    <div class="footer">
        <p>Translated by <a href="https://github.com/OpenAiTx/OpenAiTx" target="_blank" rel="noopener noreferrer">OpenAiTx</a> | 
        Last updated: 2025-07-24 
    </div>
    
</body>
</html>